<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="robots" content="index, follow">

        <link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2024-2025/Baptiste-Audouin/pok/temps-1/">

        
        

        <meta name="description" content="POK traitant du langage VBA avec une mise en application concr√®te">
        <meta property="og:description" content="POK traitant du langage VBA avec une mise en application concr√®te">
        <meta name="twitter:description" content="POK traitant du langage VBA avec une mise en application concr√®te">

        
            <meta name="author" content="Baptiste Audouin">
        
        <meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, POK, vba, Excel">

        <link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon">
        <link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png">
        <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png">

        <link href="/assets/stylesheets/main.css" rel="stylesheet">

        <meta property="og:title" content="D√©couverte de VBA pour cr√©er un outil de calcul de co√ªts de d√©placements.">

        <meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png">
        <meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2024-2025/Baptiste-Audouin/pok/temps-1/">
        <meta property="og:type" content="website">

        <meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png">
        <meta name="twitter:title" content="D√©couverte de VBA pour cr√©er un outil de calcul de co√ªts de d√©placements.">
        <meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png">
        <meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2024-2025/Baptiste-Audouin/pok/temps-1/">

        <title>D√©couverte de VBA pour cr√©er un outil de calcul de co√ªts de d√©placements.</title>

        <!-- Prismjs imports
                - Prism line numbers
                - Prism toolbar
        -->
        <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">
        <link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <!-- Mermaid import and initialization -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js "></script>

        <script defer="">
        // Check if a theme is stored in localStorage. If so, use it, otherwise fallback to the system preference.
        const storedTheme = localStorage.getItem('theme');
        if (storedTheme) {
            document.documentElement.classList.toggle("dark", storedTheme === "dark");
        } else {
            // Use system color scheme if there is no stored theme preference.
            document.documentElement.classList.toggle("dark", window.matchMedia("(prefers-color-scheme: dark)").matches);
        }

        function loadPrismTheme(isDarkMode) {
            const newTheme = isDarkMode ? 'prism-okaidia.min.css' : 'prism-solarizedlight.min.css';
            const newLink = document.createElement('link');
            newLink.rel = 'stylesheet';
            newLink.id = 'prism-theme';
            newLink.href = `https://cdn.jsdelivr.net/npm/prismjs/themes/${newTheme}`;

            newLink.onload = () => {
                // Reapply highlighting after the new theme loads
                Prism.highlightAll();
            };

            const existingLink = document.getElementById('prism-theme');
            if (existingLink) {
                document.head.replaceChild(newLink, existingLink);
            } else {
                document.head.appendChild(newLink);
            }
        }

        function setMermaidTheme(isDarkMode) {
            const theme = isDarkMode ? 'dark' : 'forest';
            mermaid.initialize({
                securityLevel: 'loose',
                theme,
                startOnLoad: true,
            });
        }

        // Toggle dark and light mode and update localStorage accordingly.
        function toggleDarkMode() {
            const dark = document.documentElement.classList.contains("dark");
            const newTheme = dark ? "light" : "dark";
            localStorage.setItem('theme', newTheme);
            document.documentElement.classList.toggle("dark", !dark);
            loadPrismTheme(!dark);
            setMermaidTheme(!dark);
        }

        // On initial load, ensure that Prism and Mermaid are initialized using the current theme.
        const isDark = document.documentElement.classList.contains("dark");
        loadPrismTheme(isDark);
        setMermaidTheme(isDark);
        </script>

    </head>

    <body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50">
        <header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-between items-center">
                    <a class="mx-2" href="/">Home</a>
                    <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current">
                            <circle cx="12" cy="12" r="5"></circle>
                            <path d="M12 2V4" stroke-linecap="round"></path>
                            <path d="M12 20V22" stroke-linecap="round"></path>
                            <path d="M4 12L2 12" stroke-linecap="round"></path>
                            <path d="M22 12L20 12" stroke-linecap="round"></path>
                            <path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path>
                            <path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path>
                            <path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path>
                            <path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path>
                        </svg>
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block">
                            <path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                    <div class="flex items-center gap-4 sm:gap-6 ">
                        <a class="" href="/cs">CS</a>
                        <a class="" href="/pok">POK</a>
                        <a class="" href="/mon">MON</a>
                        <a class="" href="/projets">Projets</a>
                        <a class="hidden sm:block" href="/promos">Promos</a>
                        <a href="/search">
                            <svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                            </svg>
                        </a>
                        <a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank">
                            <svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">D√©couverte de VBA pour cr√©er un outil de calcul de co√ªts de d√©placements.</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Tags : </div>
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">POK</li>
                
                    <li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">vba</li>
                
                    <li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">Excel</li>
                

            </ul>

            
            <div class="hidden" data-pagefind-meta="Type" aria-hidden="true">
                
                    
                        <span data-pagefind-filter="Type">POK</span>
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteur : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Baptiste Audouin</li>
                
            </ul>
        </div>
    

    
        <div class="absolute top-0 right-0">
            <span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">
                2024-2025
            </span>
        </div>
    
</div>

<p class="mb-4 text-lg">POK traitant du langage VBA avec une mise en application concr√®te</p>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/promos/2024-2025/Baptiste-Audouin/">Baptiste Audouin</a><span class="px-1">/</span><a href="/promos/2024-2025/Baptiste-Audouin/pok/">POK de Baptiste Audouin</a><span class="px-1">/</span><a href="/promos/2024-2025/Baptiste-Audouin/pok/temps-1/">D√©couverte de VBA pour cr√©er un outil de calcul de co√ªts de d√©placements.</a>

</div>
</div>




<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100 dark:border-pink-800 dark:bg-pink-950">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-pink-500 dark:stroke-pink-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><b>Pr√©requis</b></p>
</div><div class="pl-8 mr-8">
<ul>
<li>Connaissances de base en Excel</li>
<li>Ce POK est tr√®s peu compatible avec les mac</li>
</ul>
</div>
</div>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100 dark:border-emerald-800 dark:bg-emerald-950">
<svg class="absolute w-6 h-6 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-emerald-500 dark:stroke-emerald-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><b>Liens</b></p>
</div><div class="pl-8 mr-8">
<p><a href="https://excel-pratique.com">Excel pratique</a>
<a href="https://voiture.car2db.com">Bases de donn√©es v√©hiculaires</a>
<a href="https://www.data.gouv.fr/fr/datasets/villes-de-france/#/resources">Bases de donn√©es g√©ographiques</a>
<a href="https://openrouteservice.org">API Open Route Service</a></p>
</div>
</div>
<p>J'aimerai √† travers se POK me former au langage VBA qui est tr√®s souvent utilis√© en entreprise.
En mise en application j'aimerai cr√©er un outil permettant aux commerciaux d'une entreprise de calculer les co√ªts de leurs d√©placements afin de cr√©er des notes de frais.</p>
<h2 id="t%C3%A2ches" tabindex="-1"><a class="header-anchor" href="#t%C3%A2ches"></a> T√¢ches</h2>
<h5 id="sprint-1-%3A" tabindex="-1"><a class="header-anchor" href="#sprint-1-%3A"></a> Sprint 1 :</h5>
<ul>
<li>[ ] D√©couvrir et me former en VBA <em>(Temps estim√© : 4h)</em></li>
<li>[ ] D√©finir le visuel et les fonctionnalit√©s du rendu final <em>(Temps estim√© : 1h)</em></li>
<li>[ ] Ecrire une premi√®re version du code avec les √©l√©ments de base <em>(Temps estim√© : 4h)</em></li>
<li>[ ] Tester les fonctionnalit√©s et r√©fl√©chir √† des am√©liorations √† r√©aliser lors du second sprint <em>(Temps estim√© : 1h)</em></li>
</ul>
<h5 id="sprint-2-%3A" tabindex="-1"><a class="header-anchor" href="#sprint-2-%3A"></a> Sprint 2 :</h5>
<ul>
<li>[ ] D√©finir les am√©liorations √† impl√©menter <em>(Temps estim√© : 1h)</em></li>
<li>[ ] Am√©liorer et compl√©ter l'outil avec les am√©liorations d√©finies <em>(Temps estim√© : 2h30)</em></li>
<li>[ ] Appliquer les connaissances acquises lors du MON 1 avec une connexion API REST <em>(Temps estim√© : 5h)</em></li>
<li>[ ] Documenter le projet et pr√©parer la pr√©sentation finale <em>(Temps estim√© : 1h30)</em></li>
</ul>
<h2 id="premier-sprint-%3A-d%C3%A9couverte-de-vba-et-premi%C3%A8re-version-de-l'outil" tabindex="-1"><a class="header-anchor" href="#premier-sprint-%3A-d%C3%A9couverte-de-vba-et-premi%C3%A8re-version-de-l'outil"></a> Premier Sprint : d√©couverte de VBA et premi√®re version de l'outil</h2>
<h3 id="horodatage-%3A" tabindex="-1"><a class="header-anchor" href="#horodatage-%3A"></a> Horodatage  :</h3>
<p>Dans ce premier sprint j'ai pu r√©aliser toutes les t√¢ches pr√©vues pour une dur√©e d'environ dix heures :</p>
<table>
<thead>
<tr>
<th>T√¢ches</th>
<th>Heures pass√©es</th>
<th>Heures pr√©vues</th>
</tr>
</thead>
<tbody>
<tr>
<td>D√©couvrir et me former en VBA</td>
<td>4h</td>
<td>4h</td>
</tr>
<tr>
<td>D√©finir le visuel et les fonctionnalit√©s du rendu final</td>
<td>2h</td>
<td>1h</td>
</tr>
<tr>
<td>Ecrire une premi√®re version du code avec les √©l√©ments de base</td>
<td>3h30</td>
<td>4h</td>
</tr>
<tr>
<td>Tester les fonctionnalit√©s et r√©fl√©chir √† des am√©liorations √† r√©aliser lors du second sprint</td>
<td>45min</td>
<td>1h</td>
</tr>
</tbody>
</table>
<h3 id="1.-formation-vba" tabindex="-1"><a class="header-anchor" href="#1.-formation-vba"></a> 1. Formation VBA</h3>
<p>J'ai commenc√© ce sprint par me documenter et me former en VBA. J'avais d√©j√† utilis√© des fichiers Excel avec des macro mais sans coder et apprendre ce langage. J'ai donc suivi les cours du site <a href="https://excel-pratique.com">Excel pratique</a> sur les <a href="https://excel-pratique.com/fr/vba/variables">variables</a>, les <a href="https://excel-pratique.com/fr/vba/boucles">boucles</a> mais aussi sur les <a href="https://excel-pratique.com/fr/formation/creation_userform">UserForm</a> avant de d√©couvrir que ceux-ci n'√©taient pas disponible sur mac...</p>
<h3 id="2.-d%C3%A9finitions-des-fonctionnalit%C3%A9s-de-la-premiere-version" tabindex="-1"><a class="header-anchor" href="#2.-d%C3%A9finitions-des-fonctionnalit%C3%A9s-de-la-premiere-version"></a> 2. D√©finitions des fonctionnalit√©s de la premiere version</h3>
<p>Voici les diff√©rents points que j'ai retenu durant cette seconde t√¢che pour d√©finir les premi√®res fonctionnalit√©s :</p>
<ul>
<li>Formulaire avec les champs nom, pr√©nom, date, ville de d√©part, ville d'arriv√©e, v√©hicule.</li>
<li>Utilisation de deux bases de donn√©es :
<ul>
<li>V√©hicules : utilisation de cette <a href="https://voiture.car2db.com">base de donn√©es</a> qui permet de r√©pertorier plus d'une centaine de v√©hicules avec leur type de carburant ainsi que leur consommation en vue des calculs de frais de d√©placements.</li>
<li>Villes de France avec les coordonn√©es : utilisation des <a href="https://www.data.gouv.fr/fr/datasets/villes-de-france/#/resources">donn√©es</a> disponibles sur le site du gouvernement.</li>
</ul>
</li>
</ul>
<h3 id="3.-premi%C3%A8re-version" tabindex="-1"><a class="header-anchor" href="#3.-premi%C3%A8re-version"></a> 3. Premi√®re version</h3>
<p>La premi√®re version de l'outil utilise deux feuilles Excel, une feuille <em>D√©placements</em> o√π l'utilisateur remplis ses d√©placements et une seconde feuille <em>R√©cap</em> qui r√©capitule tous les d√©placements :</p>
<div>
  <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2024-2025/refs/heads/main//Baptiste-Audouin/pok/temps-1/Deplacements_V1.png">
  <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2024-2025/refs/heads/main//Baptiste-Audouin/pok/temps-1/Recap_V1.png">
</div>
<p>Le bouton <em>Enregistrer</em>fait r√©f√©rence √† la premi√®re macro du projet qui, lors d'un clique, va remplir le tableau sur la page R√©cap en ajoutant une ligne et en la remplissant suivant les donn√©es entr√©es dans le formulaire.
Voici une explication d√©taill√©e du code VBA en utilisant un format Markdown :
Ce code est copos√© d'une macro principale <code>new_drive</code> qui utilise √©galement une autre macro que j'ai cr√©√© <code>add_empty_row</code>.</p>
<h4 id="sub-add_empty_row()" tabindex="-1"><a class="header-anchor" href="#sub-add_empty_row()"></a> <code>Sub add_empty_row()</code></h4>
<p>Ce code ajoute une ligne vide en dessous de la derni√®re ligne non-vide dans le tableau de la feuille <code>R√©cap</code>.</p>
<ul>
<li><strong>D√©claration des variables</strong> :
<ul>
<li><code>ligne</code> est un entier long qui permet de parcourir les lignes de la feuille.</li>
<li><code>feuille</code> est un objet repr√©sentant la feuille <code>R√©cap</code>.</li>
<li><code>r_min</code> stocke la premi√®re ligne vide trouv√©e.</li>
</ul>
</li>
</ul>
<pre class="language-vba line-numbers"><code>

Dim ligne As Long
Dim feuille As Worksheet
Dim r_min As Long
Set feuille = Sheets("R√©cap")


</code></pre><ul>
<li><strong>Insertion d'une nouvelle ligne en bas de tableau'</strong> :
Le programme parcourt le tableau de la feuille <code>R√©cap</code> en cherchant le derni√®re ligne non-vide avant d'en ajouter une en dessous.</li>
</ul>
<pre class="language-vba line-numbers"><code>

For ligne = 3 To feuille.Rows.Count
    If IsEmpty(feuille.Cells(ligne, 2).Value) Then
        r_min = ligne
        Exit For
    End If
Next ligne
feuille.Rows(r_min).Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove


</code></pre><h4 id="sub-new_drive()" tabindex="-1"><a class="header-anchor" href="#sub-new_drive()"></a> <code>Sub new_drive()</code></h4>
<p>Une fois la macro <code>add_empty_row</code> cr√©√©e, on peut code la macro g√©n√©rale <code>new_drive</code>.</p>
<ul>
<li><strong>D√©finition des feuilles</strong> :
Les objets <code>sourceFeuille</code> et <code>destinationFeuille</code> sont assign√©s aux feuilles respectives.</li>
</ul>
<pre class="language-vba line-numbers"><code>

Set sourceFeuille = Sheets("D√©placements")
Set destinationFeuille = Sheets("R√©cap")


</code></pre><ul>
<li><strong>Initialisation de la variable <code>ligne</code></strong> :
Le programme commence √† chercher une ligne vide √† partir de la ligne 5 dans la feuille <code>R√©cap</code>.
La proc√©dure <code>add_empty_row</code> est appel√©e pour ajouter une ligne vide.</li>
</ul>
<pre class="language-vba line-numbers"><code>

ligne = 4
Call add_empty_row


</code></pre><ul>
<li><strong>Boucle de recherche de la premi√®re ligne vide</strong> :
Cette boucle v√©rifie la colonne B √† partir de la ligne 5 pour trouver la premi√®re cellule vide, puis stocke le num√©ro de cette ligne.</li>
</ul>
<pre class="language-vba line-numbers"><code>

Do While destinationFeuille.Range("b" & ligne) <> ""
    ligne = ligne + 1
Loop


</code></pre><ul>
<li><strong>Copie des valeurs</strong> :
Le programme copie les valeurs des cellules D6, D8, D10, etc. de la feuille <code>D√©placements</code> vers les colonnes B, C, D, etc. de la feuille <code>R√©cap</code>, √† la ligne trouv√©e.</li>
</ul>
<pre class="language-vba line-numbers"><code>

destinationFeuille.Range("b" & ligne) = sourceFeuille.Range("D6").Value
destinationFeuille.Range("c" & ligne) = sourceFeuille.Range("D8").Value
...


</code></pre><ul>
<li><strong>Nettoyage des donn√©es sources</strong> :
Apr√®s avoir copi√© les donn√©es, le contenu des cellules D6, D8, D10, etc. de la feuille <code>D√©placements</code> est effac√© pour les pr√©parer √† de nouvelles entr√©es.</li>
</ul>
<pre class="language-vba line-numbers"><code>

sourceFeuille.Range("D6").ClearContents
sourceFeuille.Range("D8").ClearContents
...


</code></pre><p>Ainsi, cette macro permet d'envoyer les informations du formulaire dans le tableau r√©capitulatif.</p>
<h3 id="4.-am%C3%A9liorations-pour-le-second-sprint" tabindex="-1"><a class="header-anchor" href="#4.-am%C3%A9liorations-pour-le-second-sprint"></a> 4. Am√©liorations pour le second sprint</h3>
<p>Comme pr√©vue lors de la d√©finition des t√¢ches de mon POK j'avais pr√©vu un temps de relecture et de r√©flexion pour les futures am√©liorations envisag√©es dans le second sprint :</p>
<ul>
<li>Revoir le visuel de l'outil</li>
<li>Int√©grer une API pour avoir le calcul d'itin√©raire</li>
<li>Recherche d'une API pour avoir le prix du carburant actualis√©</li>
<li>Calcul du co√ªt de d√©placement</li>
<li>Int√©grer un envoie automatique de mail</li>
</ul>
<h2 id="second-sprint-%3A-int%C3%A9gration-d'api-et-automatisation-d'envoie-de-mail-en-vba" tabindex="-1"><a class="header-anchor" href="#second-sprint-%3A-int%C3%A9gration-d'api-et-automatisation-d'envoie-de-mail-en-vba"></a> Second Sprint : Int√©gration d'API et automatisation d'envoie de mail en VBA</h2>
<h3 id="horodatage-%3A-1" tabindex="-1"><a class="header-anchor" href="#horodatage-%3A-1"></a> Horodatage  :</h3>
<p>Dans ce second sprint j'ai √©t√© √©norm√©ment ralenti par l'incompatibilit√© entre mac et Excel qui bloque l'utilisation d'API et l'envoie de mail. J'ai tout de m√™me r√©ussi √† avancer en utilisant un autre ordinateur :</p>
<table>
<thead>
<tr>
<th>T√¢ches</th>
<th>Heures pass√©es</th>
<th>Heures pr√©vues</th>
</tr>
</thead>
<tbody>
<tr>
<td>Int√©grer une API pour avoir le calcul d'itin√©raire</td>
<td>3h</td>
<td>4h</td>
</tr>
<tr>
<td>Int√©grer un envoi automatique de mail</td>
<td>3h</td>
<td>5h</td>
</tr>
<tr>
<td>Calcul du co√ªt de d√©placement</td>
<td>1h</td>
<td>45min</td>
</tr>
<tr>
<td>Recherche et int√©gration d'une API pour obtenir le prix du carburant actualis√©</td>
<td>3h</td>
<td>x</td>
</tr>
<tr>
<td>Revoir le visuel de l'outil</td>
<td>1h</td>
<td>x</td>
</tr>
<tr>
<td>R√©daction</td>
<td>1h</td>
<td>1h</td>
</tr>
</tbody>
</table>
<h3 id="1.-int%C3%A9gration-d'une-api" tabindex="-1"><a class="header-anchor" href="#1.-int%C3%A9gration-d'une-api"></a> 1. Int√©gration d'une API</h3>
<p>Comme √©voqu√© pr√©c√©demment, cette partie m'a pris beaucoup plus de temps que pr√©vu mais, en utilisant un autre ordinateur j'ai pu la r√©aliser.
Apr√®s quelques recherches j'ai choisi l'API <a href="https://openrouteservice.org">Open Route Service</a> qui permet de faire des requ√™tes de navigation et donc de donner la distance en km d'un itin√©raire entre deux villes et non de la distance √† vol d'oiseau comme calcul√©e jusque l√†.
Voici le code correspondant √† cette requ√™te o√π la fonction <code>GetDirections</code>prend en argument une ligne et renvoie la distance entre les deux villes entr√©es dans les cellules de cette ligne. Cette fonction sera appel√©e dans notre fonction <code>new_drive</code> et appliqu√©e √† la ligne qui vient d'√™tre ajout√©e dans le tableau de la feuille <code>Recap</code> afin d'afficher la distance du trajet.</p>
<pre class="language-vba line-numbers"><code>

Sub GetDirections(ligne As Integer)
    'Definition des coordonnees
    Dim startcoord As String
    Dim endcoord As String

    'Attribution des coordonn√©es
    startcoord = Application.WorksheetFunction.Index(Sheets("Villes").Range("L:L"), Application.WorksheetFunction.Match(Sheets("Recap").Range("e" & ligne).Value, Sheets("Villes").Range("D:D"), 0))
    endcoord = Application.WorksheetFunction.Index(Sheets("Villes").Range("L:L"), Application.WorksheetFunction.Match(Sheets("Recap").Range("f" & ligne).Value, Sheets("Villes").Range("D:D"), 0))
    ' Creer la requete HTTP vers l'API OpenRouteService
    Dim request As Object
    Set request = CreateObject("MSXML2.ServerXMLHTTP.6.0")
    request.Open "GET", "https://api.openrouteservice.org/v2/directions/driving-car?api_key=5b3ce3597851110001cf624851d78afb034647d69ce565d480d3b168&start=&startcoord&&end=&endcoord&", False
    ' Definir les en-tetes de la requete
    request.setRequestHeader "Accept", "application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8"

    ' Envoyer la requete
    request.Send
    ' Recuperer et traiter la reponse
    Dim responseContent As String
    responseContent = request.responseText

    ThisWorkbook.Sheets("Parametres").Range("F6").Value = responseContent
End Sub


</code></pre><h3 id="2.-int%C3%A9grer-l'envoie-automatique-de-mail" tabindex="-1"><a class="header-anchor" href="#2.-int%C3%A9grer-l'envoie-automatique-de-mail"></a> 2. Int√©grer l'envoie automatique de mail</h3>
<p>D'apr√®s mes recherches lors de la fin du sprint 1, il est possible d'automatiser l'envoie de mail avec des macros en utilisant l'application <strong>Outlook</strong> de <strong>Microsoft</strong>. Cependant, la configuration d'Outlook ainsi que l'√©laboration du code m'ont pris beaucoup plus de temps que ce que j'avais envisag√©.
Le code suivant permet d'envoyer par mail le tableau de la feuille <code>recap</code> apr√®s avoir cliqu√© sur le bouton envoyer pr√©sent sur cette m√™me page :</p>
<pre class="language-vba line-numbers"><code>

  Sub EnvoyerMailAvecTableau(tableau As Range)
      Dim OutlookApp As Object
      Dim OutlookMail As Object
      Dim Feuille As Workshee
      Dim CorpsMessage As String
      Dim i As Integer, j As Integer
      ' Initialiser la feuille et le tableau
      Set Feuille = ThisWorkbook.Sheets("Recap")
      Set tableau = Feuille.Range(tableau)
      ' Creer un nouveau mail
      Set OutlookMail = OutlookApp.CreateItem(0)
      ' on int√®gre le tableau au corps du mail
      CorpsMessage = "<html><body><table border="1" cellspacing="0" cellpadding="3">"
      For i = 1 To tableau.Rows.Count
          CorpsMessage = CorpsMessage & "<tr>"
          For j = 1 To tableau.Columns.Count
              CorpsMessage = CorpsMessage & "<td>" & tableau.Cells(i, j).Value & "</td>"
          Next j
          CorpsMessage = CorpsMessage & "</tr>"
      Next i
      CorpsMessage = CorpsMessage & "</table></body></html>"
      ' Configurer les proprietes du mail
      With OutlookMail
          .To = "baptisteaudouin.ba@gmail.com" '
          .CC = ""
          .BCC = ""
          .Subject = "Note de frais"
          .Send
      End With
      ' Nettoyage des objets
      Set OutlookMail = Nothing
      Set OutlookApp = Nothing
      MsgBox "E-mail evoy√© avec succ√®s  !"
  End Sub


</code></pre><h3 id="3.-calcul-du-co%C3%BBt-de-d%C3%A9placement" tabindex="-1"><a class="header-anchor" href="#3.-calcul-du-co%C3%BBt-de-d%C3%A9placement"></a> 3. Calcul du co√ªt de d√©placement</h3>
<p>Il √©tait pr√©vu d'utiliser √©galement une API afin d'avoir le prix du carburant actualis√© en temps r√©el mais en vu du temps restant j'ai choisi de prendre un prix fixe (celui du 13/10/2024) et privil√©gier le calcul du prix du trajet qui est le but m√™me de ce projet.
Voici la formule que j'applique dans la cellule correspondant au co√ªt du trajet √† l'aide de la macro :</p>
<pre class="language-vba line-numbers"><code>

destinationFeuille.Range("i" & ligne).Formula = "= (INDEX(Parametres!$H$2:$H$4, MATCH(INDEX(V√©hicules!AT:AT, MATCH(Recap!G" & ligne & ", V√©hicules!C:C, 0)), Parametres!$G$2:$G$4, 0)) * Recap!H" & ligne & " / 100) * INDEX(V√©hicules!AW:AW, MATCH(Recap!G" & ligne & ", V√©hicules!C:C, 0))"


</code></pre><p>Voici quelques explications concernant cette formule :</p>
<ul>
<li><code>INDEX(V√©hicules!AT:AT, MATCH(Recap!G&quot; &amp; ligne &amp; &quot;, V√©hicules!C:C, 0))</code> : Cette s√©quence permet d'obtenir le type du carburant utilis√©</li>
<li><code>INDEX(Parametres!$H$2:$H$4, MATCH(INDEX(V√©hicules!AT:AT, MATCH(Recap!G&quot; &amp; ligne &amp; &quot;, V√©hicules!C:C, 0)), Parametres!$G$2:$G$4, 0))</code>: Ici on r√©utulise la formule pr√©c√©dente pour obtenir le prix du Litre de carburant.</li>
<li><code>INDEX(V√©hicules!AW:AW, MATCH(Recap!G&quot; &amp; ligne &amp; &quot;, V√©hicules!C:C, 0))</code>: Cette derni√®re partie permet d'avoir la consomation du v√©hicule pour 100km.</li>
<li><code>Recap!H&quot; &amp; ligne &amp; &quot; / 100</code> : Enfin on mutiplie par la distance parcourue divis√© par 100 pour homog√©n√©is√©e la formule et avoir le r√©sultat souhait√©.
Notre tableau est donc finalement compl√©t√© automatiquement √† chaque fois que l'utilisateur entre un d√©placement dans le formulaire de la feuille du m√™me nom.</li>
</ul>
<h3 id="4.-int%C3%A9gration-des-nouvelles-fonctions-dans-new_drive()" tabindex="-1"><a class="header-anchor" href="#4.-int%C3%A9gration-des-nouvelles-fonctions-dans-new_drive()"></a> 4. Int√©gration des nouvelles fonctions dans <code>new_drive()</code></h3>
<p>Maintenant que toutes nos fonctionnalit√©s ont √©t√© impl√©menter, on peut appeler les nouvelles fonctions et obtenir le code final qui s'execute √† chaque clique sur le bouton <code>Enregistrer</code>:</p>
<pre class="language-vba line-numbers"><code>

Sub new_drive()
    Dim ligne As Integer
    Dim sourceFeuille As Worksheet
    Dim destinationFeuille As Worksheet

    ' D√©finir la feuille source (Deplacements)
    Set sourceFeuille = Sheets("Deplacements")

    ' D√©finir la feuille de destination (Recap)
    Set destinationFeuille = Sheets("Recap")

    ' Commencer √† la ligne 5
    ligne = 4
    'Ajout d'une ligne vide
    Call add_empty_row
    ' Boucle pour trouver la premi√®re ligne vide dans la colonne F de la feuille R√©cap
    Do While destinationFeuille.Range("b" & ligne) <> ""
        ligne = ligne + 1
    Loop

    ' Copier les valeurs depuis la feuille Sheet1 et les coller dans la feuille R√©cap
    destinationFeuille.Range("b" & ligne) = sourceFeuille.Range("D6").Value
    destinationFeuille.Range("c" & ligne) = sourceFeuille.Range("D8").Value
    destinationFeuille.Range("d" & ligne) = sourceFeuille.Range("D10").Value
    destinationFeuille.Range("e" & ligne) = sourceFeuille.Range("D12").Value
    destinationFeuille.Range("f" & ligne) = sourceFeuille.Range("D14").Value
    destinationFeuille.Range("g" & ligne) = sourceFeuille.Range("D16").Value

    'Vide les valeurs du formulaire

    sourceFeuille.Range("D6").ClearContents
    sourceFeuille.Range("D8").ClearContents
    sourceFeuille.Range("D10").ClearContents
    sourceFeuille.Range("D12").ClearContents
    sourceFeuille.Range("D14").ClearContents
    sourceFeuille.Range("D16").ClearContents

    'Appel de l'API pour calculer la distance

    Call GetDirections(ligne)

    destinationFeuille.Range("h" & ligne) = Sheets("Parametres").Range("F12").Value
    destinationFeuille.Range("i" & ligne).Formula = "= (INDEX(Parametres!$H$2:$H$4, MATCH(INDEX(V√©hicules!AT:AT, MATCH(Recap!G" & ligne & ", V√©hicules!C:C, 0)), Parametres!$G$2:$G$4, 0)) * Recap!H" & ligne & " / 100) * INDEX(V√©hicules!AW:AW, MATCH(Recap!G" & ligne & ", V√©hicules!C:C, 0))"

End Sub


</code></pre><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"></a> Conclusion</h2>
<p>Apr√®s un premier sprint concluant avec toutes les t√¢ches r√©alis√©es sans r√©elles difficult√©s, le second fut plus compliqu√© notamment √† cause des probl√®mes d'incompatibilit√©s entre mac et Excel que je n'avais pas anticip√©. Cependant, si on r√©capitule les fonctionnalit√©s de l'outil, elles sont en accord avec la d√©finition du projet :</p>
<ul>
<li>
<p><strong>1. Feuille <code>Deplacements</code></strong> : L'utilisateur entre son d√©placement avec l'aide des bases de donn√©es <code>Villes</code> et <code>V√©hicules</code> puis le valide avec le bouton <code>Enregistrer</code>.</p>
</li>
<li>
<p><strong>2. Feuille <code>Recap</code></strong> : Apr√®s que l'utilisateur ait enregistrer un d√©placement, une nouvelle ligne apparait dans le tableau avec la distance de l'itin√©raire calcul√©e √† l'aide d'une requ√™te API REST ainsi que le calcul complet du co√ªt du trajet gr√¢ce aux param√®tres du v√©hicule utilis√© pr√©sent dans la base de donn√©e <code>V√©hicules</code>.</p>
</li>
<li>
<p><strong>3. Feuille <code>Recap</code></strong> : Une fois ces deux derni√®res √©tapes r√©alis√©es autant de fois que l'utilisateur a de trajets √† entrer, le bouton <code>Envoyer</code> permet d'envoyer le tableau r√©capitulatif de tous les trajets par mail.</p>
</li>
</ul>



</article>

        </main>

        <footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        ¬©2025 <b><span style="font-family: Consolas, sans-serif;">Do-<span style="color: #4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT
                    </p>
                </div>
            </div>
        </footer>

        <!-- MathJax import and initialization -->
        <script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']], // Delimiters for inline math
                    displayMath: [['$$', '$$'], ['\\[', '\\]']] // Delimiters for block math
                },
                svg: {
                    fontCache: 'global' // Use global font cache for SVG output
                }
            };
            document.addEventListener('DOMContentLoaded', () => {
                MathJax.typeset(); // Ensures MathJax processes the content after the page loads
            });
        </script>

        <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">
            Prism.plugins.NormalizeWhitespace.setDefaults({
                'remove-trailing': true,
                'remove-indent': true,
                'left-trim': true,
                'right-trim': true,
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script>
    </body>
</html>
