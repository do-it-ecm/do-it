<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="index, follow"><link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2024-2025/Baptiste-Audouin/pok/temps-3/"><meta name="description" content="Ce projet a pour objectif de d√©velopper un syst√®me de recommandation de films en utilisant le mod√®le de machine learning ALS (Alternating Least Squares) de PySpark, librairie d&#39;analyse de donn√©es et de machine learning."><meta property="og:description" content="Ce projet a pour objectif de d√©velopper un syst√®me de recommandation de films en utilisant le mod√®le de machine learning ALS (Alternating Least Squares) de PySpark, librairie d&#39;analyse de donn√©es et de machine learning."><meta name="twitter:description" content="Ce projet a pour objectif de d√©velopper un syst√®me de recommandation de films en utilisant le mod√®le de machine learning ALS (Alternating Least Squares) de PySpark, librairie d&#39;analyse de donn√©es et de machine learning."><meta name="author" content="Baptiste Audouin"><meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, POK"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png"><link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png"><link href="/assets/stylesheets/main.css" rel="stylesheet"><meta property="og:title" content="Recomandation de films avec Pyspark"><meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2024-2025/Baptiste-Audouin/pok/temps-3/"><meta property="og:type" content="website"><meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:title" content="Recomandation de films avec Pyspark"><meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2024-2025/Baptiste-Audouin/pok/temps-3/"><title>Recomandation de films avec Pyspark</title><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet"><link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script defer="">const storedTheme=localStorage.getItem("theme");function loadPrismTheme(e){const t=e?"prism-okaidia.min.css":"prism-solarizedlight.min.css",s=document.createElement("link");s.rel="stylesheet",s.id="prism-theme",s.href=`https://cdn.jsdelivr.net/npm/prismjs/themes/${t}`,s.onload=()=>{Prism.highlightAll()};const m=document.getElementById("prism-theme");m?document.head.replaceChild(s,m):document.head.appendChild(s)}function setMermaidTheme(e){const t=e?"dark":"forest";mermaid.initialize({securityLevel:"loose",theme:t,startOnLoad:!0})}function toggleDarkMode(){const e=document.documentElement.classList.contains("dark"),t=e?"light":"dark";localStorage.setItem("theme",t),document.documentElement.classList.toggle("dark",!e),loadPrismTheme(!e),setMermaidTheme(!e)}storedTheme?document.documentElement.classList.toggle("dark","dark"===storedTheme):document.documentElement.classList.toggle("dark",window.matchMedia("(prefers-color-scheme: dark)").matches);const isDark=document.documentElement.classList.contains("dark");loadPrismTheme(isDark),setMermaidTheme(isDark)</script></head><body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50"><header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-between items-center"><a class="mx-2" href="/">Home</a> <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current"><circle cx="12" cy="12" r="5"></circle><path d="M12 2V4" stroke-linecap="round"></path><path d="M12 20V22" stroke-linecap="round"></path><path d="M4 12L2 12" stroke-linecap="round"></path><path d="M22 12L20 12" stroke-linecap="round"></path><path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path><path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path><path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path><path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path></svg> <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block"><path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="flex items-center gap-4 sm:gap-6"><a class="" href="/cs">CS</a> <a class="" href="/pok">POK</a> <a class="" href="/mon">MON</a> <a class="" href="/projets">Projets</a> <a class="hidden sm:block" href="/promos">Promos</a> <a href="/search"><svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg> </a><a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank"><svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div></header><main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body=""><article class="relative"><h1 class="mb-1">Recomandation de films avec Pyspark</h1><div class="mb-4"><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Tag :</div><ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags"><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">POK</li></ul><div class="hidden" data-pagefind-meta="Type" aria-hidden="true"><span data-pagefind-filter="Type">POK</span></div></div><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Auteur :</div><ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs"><li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Baptiste Audouin</li></ul></div><div class="absolute top-0 right-0"><span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">2024-2025</span></div></div><p class="mb-4 text-lg">Ce projet a pour objectif de d√©velopper un syst√®me de recommandation de films en utilisant le mod√®le de machine learning ALS (Alternating Least Squares) de PySpark, librairie d'analyse de donn√©es et de machine learning.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path></svg><div class="pl-8 mr-8"><a href="/promos/2024-2025/Baptiste-Audouin/">Baptiste Audouin</a><span class="px-1">/</span><a href="/promos/2024-2025/Baptiste-Audouin/pok/">POK de Baptiste Audouin</a><span class="px-1">/</span><a href="/promos/2024-2025/Baptiste-Audouin/pok/temps-3/">Recomandation de films avec Pyspark</a></div></div><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100 dark:border-pink-800 dark:bg-pink-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-pink-500 dark:stroke-pink-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Pr√©requis</b></p></div><div class="pl-8 mr-8"><ul><li>Bases en python</li></ul></div></div><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100 dark:border-emerald-800 dark:bg-emerald-950"><svg class="absolute w-6 h-6 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-emerald-500 dark:stroke-emerald-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Liens</b></p></div><div class="pl-8 mr-8"><ul><li><a href="https://nightlies.apache.org/flink/flink-docs-release-1.4/dev/libs/ml/als.html">Th√©orie du mod√®le ALS sur le site flink</a></li><li><a href="https://www.kaggle.com/datasets/grouplens/movielens-20m-dataset?select=rating.csv">Dataset MovieLens sur kaggle</a></li><li><a href="https://spark.apache.org/docs/latest/api/python/index.html">Documentation PySpark</a></li></ul></div></div><p>Au cours de mon cursus j'ai d√©j√† eu l'occasion de travailler sur des mod√®les de Machine Learning comme kNN (k-Nearest Neighbors) ou Matrix Factorization (SVD - Singular Value Decomposition) de la librairie <em>scikit-learn</em>. Dans ce POK je voudrais travailler avec PySpark qui est une biblioth√®que Python qui permet de traiter de grandes quantit√©s de donn√©es rapidement en utilisant Apache Spark. Tr√®s utilis√© en data science, il aide √† analyser et manipuler des donn√©es massives de mani√®re efficace. Je souhaite appliquer le mod√®le ALS (Alternating Least Squares) √† un dataset de notation de films afin de faire un syst√®mede recommandation.</p><h2 id="cadrage" tabindex="-1"><a class="header-anchor" href="#cadrage"></a> Cadrage</h2><h3 id="objectifs-principaux" tabindex="-1"><a class="header-anchor" href="#objectifs-principaux"></a> Objectifs principaux</h3><ol><li>Comprendre la th√©orie du mod√®le ALS.</li><li>Pr√©parer les donn√©es</li><li>Impl√©menter le mod√®le de recommandation</li><li>√âvaluer les performances</li></ol><h3 id="sprints" tabindex="-1"><a class="header-anchor" href="#sprints"></a> Sprints</h3><h4 id="sprint-1" tabindex="-1"><a class="header-anchor" href="#sprint-1"></a> Sprint 1</h4><ul><li>[x] Documentation sur la th√©orie du mod√®le ALS (2h)</li><li>[x] Recherche et s√©lection du dataset (1h30)</li><li>[x] D√©couverte de Pyspark (1h30)</li><li>[x] Pr√©paration de l'environnement PySpark (1h)</li><li>[x] Exploration initiale des donn√©es (analyse des colonnes et visualisation) (2h)</li><li>[x] Nettoyage et transformation des donn√©es (gestion des valeurs manquantes, typage) (1h)</li></ul><h4 id="sprint-2" tabindex="-1"><a class="header-anchor" href="#sprint-2"></a> Sprint 2</h4><ul><li>[x] Impl√©mentation du mod√®le de recommandation avec ALS (Alternating Least Squares) (4h)</li><li>[x] Optimisation des hyperparam√®tres du mod√®le (3h)</li><li>[x] Analyse du mod√®le optimis√© (1h)</li><li>[x] G√©n√©ration de recommandations pour les utilisateurs (1h)</li><li>[x] Documentation finale (1h)</li></ul><h3 id="horodatage" tabindex="-1"><a class="header-anchor" href="#horodatage"></a> Horodatage</h3><table><thead><tr><th>Date</th><th>Heures pass√©es</th><th>Indications</th></tr></thead><tbody><tr><td>Jeudi 23/01</td><td>2h</td><td>Cadrage et documentation sur le mod√®le ALS</td></tr><tr><td>Jeudi 23/01</td><td>1h30</td><td>Recherche et s√©lection du dataset</td></tr><tr><td>Samedi 25/01</td><td>2h</td><td>D√©couverte de Pyspark</td></tr><tr><td>Samedi 25/01</td><td>30min</td><td>Pr√©paration de l'environnement PySpark</td></tr><tr><td>Dimanche 26/01</td><td>2h</td><td>Exploration initiale des donn√©es (analyse des colonnes et visualisation)</td></tr><tr><td>Dimanche 26/01</td><td>1h</td><td>Nettoyage et transformation des donn√©es (gestion des valeurs manquantes, typage)</td></tr><tr><td>Dimanche 26/01</td><td>1h</td><td>R√©daction</td></tr><tr><td>Mardi 25/02</td><td>3h</td><td>Impl√©mentation du mod√®le de recommandation avec ALS</td></tr><tr><td>Mercredi 26/02 matin</td><td>2h</td><td>Optimisation des hyperparam√®tres du mod√®le</td></tr><tr><td>Mercredi 26/02 soir</td><td>2h</td><td>Optimisation des hyperparam√®tres du mod√®le</td></tr><tr><td>Mercredi 26/02 soir</td><td>1h</td><td>Analyse du mod√®le optimis√©</td></tr><tr><td>Vendredi 07/03</td><td>1h</td><td>G√©n√©ration de recommandations pour les utilisateurs</td></tr><tr><td>Vendredi 07/03</td><td>1h</td><td>Documentation finale</td></tr></tbody></table><h2 id="contenu" tabindex="-1"><a class="header-anchor" href="#contenu"></a> Contenu</h2><h3 id="premier-sprint" tabindex="-1"><a class="header-anchor" href="#premier-sprint"></a> Premier Sprint</h3><h4 id="le-mod%C3%A8le-als-(alternating-least-squares)" tabindex="-1"><a class="header-anchor" href="#le-mod%C3%A8le-als-(alternating-least-squares)"></a> Le mod√®le ALS (Alternating Least Squares)</h4><p>Le mod√®le <strong>ALS (Alternating Least Squares)</strong> est utilis√© pour les syst√®mes de recommandation. Il cherche √† d√©composer une matrice \( R \), qui repr√©sente les interactions entre utilisateurs et √©l√©ments (comme les notes attribu√©es √† des films pour ce POK), en deux matrices plus petites :</p><ul><li>\( U \) : matrice des pr√©f√©rences des utilisateurs.</li><li>\( M \) : matrice des caract√©ristiques des √©l√©ments (comme les films).</li></ul><p>L'approximation se fait avec la relation suivante : $$ R \approx U \cdot M^T $$</p><p>L'objectif est de minimiser l'erreur entre les valeurs pr√©dites \( U_u^T \cdot M_i \) et les notes r√©elles \( R_{ui} \) tout en ajoutant une r√©gularisation pour √©viter le surapprentissage. La fonction d'optimisation est‚ÄØ:</p><p>$$ \min_{U, M} \sum_{(u, i) \in R} \left( R_{ui} - U_u^T M_i \right)^2 + \lambda \left( ||U_u||^2 + ||M_i||^2 \right) $$</p><p><strong>O√π :</strong></p><ul><li>\(lambda\) : param√®tre de r√©gularisation pour limiter les valeurs extr√™mes dans \( U \) et \( M \).</li><li>\( ||U_u||^2 \) et \( ||M_i||^2 \) : normes des vecteurs utilisateur et √©l√©ment.</li></ul><h4 id="fonctionnement-d'als" tabindex="-1"><a class="header-anchor" href="#fonctionnement-d'als"></a> Fonctionnement d'ALS</h4><ol><li>Fixer la matrice \( M \) et calculer \( U \).</li><li>Fixer la matrice \( U \) et calculer \( M \).</li></ol><p>Le processus alterne entre ces deux √©tapes jusqu'√† ce que l'erreur soit suffisamment basse.</p><h4 id="exemple-simple" tabindex="-1"><a class="header-anchor" href="#exemple-simple"></a> Exemple simple</h4><p>Supposons une matrice \( R \) comme celle-ci (notes donn√©es par des utilisateurs) :</p><table><thead><tr><th>Utilisateur / Film</th><th>Film 1</th><th>Film 2</th><th>Film 3</th></tr></thead><tbody><tr><td>Utilisateur 1</td><td>5</td><td>?</td><td>3</td></tr><tr><td>Utilisateur 2</td><td>?</td><td>4</td><td>?</td></tr><tr><td>Utilisateur 3</td><td>1</td><td>?</td><td>2</td></tr></tbody></table><p>Le mod√®le utilise \( U \) et \( M \) pour pr√©dire les notes manquantes (not√©es &quot;?&quot;). En ajustant it√©rativement \( U \) et \( M \), ALS minimise l'erreur entre les pr√©dictions et les notes r√©elles.</p><h4 id="choix-du-dataset" tabindex="-1"><a class="header-anchor" href="#choix-du-dataset"></a> Choix du Dataset</h4><p>Pour ce projet , j'ai choisi le dataset <strong>MovieLens</strong> disponible sur Kaggle, un des datasets les plus populaires pour les syst√®mes de recommandation. Ce dataset contient des millions de notes attribu√©es √† des films par des utilisateurs. Il inclut plusieurs fichiers, dont les principaux sont :</p><ul><li><strong>movies.csv</strong> : Contient les informations sur les films, notamment l'ID du film, le titre et les genres associ√©s.</li><li><strong>ratings.csv</strong> : Contient les √©valuations des utilisateurs pour les films, avec l'ID de l'utilisateur, l'ID du film, la note attribu√©e et la date de l'√©valuation.</li><li><strong>tags.csv</strong> : Contient des informations sur les tags associ√©s aux films, qui peuvent √™tre utiles pour l'analyse des pr√©f√©rences.</li></ul><p>Dans la suite du projet je ne suis pas certains d'utiliser toutes ces donn√©es, je vais dans un premier temps travailler avec le dataset <strong>ratings.csv</strong>.</p><h4 id="pr%C3%A9paration-de-l'environnement-pyspark" tabindex="-1"><a class="header-anchor" href="#pr%C3%A9paration-de-l'environnement-pyspark"></a> Pr√©paration de l'environnement PySpark</h4><p>Avant de pouvoir analyser les donn√©es, il est n√©cessaire de configurer un environnement pour travailler avec PySpark. Suite √† me documentation sur le site <a href="https://spark.apache.org/docs/latest/api/python/index.html">PySpark</a> voici les √©tapes principales de la configuration de PySpark :</p><p><strong>√âtapes principales :</strong></p><ol><li>Installer PySpark :<pre class="language-bash line-numbers"><code>

pip install pyspark


</code></pre></li><li>Configurer une SparkSession dans le code. Exemple minimal :<pre class="language-python line-numbers"><code>

from pyspark.sql import SparkSession

spark = SparkSession.builder \
    .appName("Recommandation de films") \
    .getOrCreate()


</code></pre></li></ol><p><strong>Test de connexion avec les donn√©es :</strong> Une fois l‚Äôenvironnement configur√©, on peut charger quelques lignes du fichier <code>ratings.csv</code>‚ÄØ:</p><pre class="language-python line-numbers"><code>

df = spark.read.csv("ratings.csv", header=True, inferSchema=True)
df.show(5)


</code></pre><h4 id="exploration-initiale-des-donn%C3%A9es" tabindex="-1"><a class="header-anchor" href="#exploration-initiale-des-donn%C3%A9es"></a> Exploration initiale des donn√©es</h4><p>Une fois l‚Äôenvironnement pr√™t, nous pouvons d‚Äôexplorer les donn√©es pour mieux comprendre leur structure. Cette exploration se concentre sur‚ÄØ:</p><ul><li><p><strong>Colonnes principales</strong> :</p><ul><li><code>userId</code> : identifiant unique des utilisateurs.</li><li><code>movieId</code> : identifiant unique des films.</li><li><code>rating</code> : note attribu√©e (√©chelle de 0.5 √† 5, par pas de 0.5).</li><li><code>timestamp</code> : date et heure de l‚Äô√©valuation.</li></ul></li><li><p><strong>Statistiques descriptives‚ÄØ:</strong></p><ul><li>Nombre total de lignes dans le dataset : 20 millions.</li><li>Nombre d‚Äôutilisateurs uniques : 138‚ÄØ493.</li><li>Nombre de films uniques : 26‚ÄØ744.</li></ul></li></ul><div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950"><details class="group"><summary class="list-none py-0.5"><svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg> <svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg><div class="pl-8 font-bold inline-block group-open:select-text"><p>Notes</p></div><svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path></svg></summary><div class="mx-8 pb-2 cursor-auto select-text"><p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2024-2025/refs/heads/main//Baptiste-Audouin/pok/temps-3/images/distribution_notes-2.png" alt="R√©partition des notes"></p></div></details></div><h4 id="nettoyage-et-transformation-des-donn%C3%A9es" tabindex="-1"><a class="header-anchor" href="#nettoyage-et-transformation-des-donn%C3%A9es"></a> Nettoyage et transformation des donn√©es</h4><p>Pour garantir une exploitation optimale des donn√©es, des v√©rifications ont √©t√© r√©alis√©es‚ÄØ:</p><ol><li><p><strong>Gestion des valeurs manquantes</strong> Une analyse des colonnes a confirm√© l'absence de valeurs nulles dans le dataset. Aucun nettoyage suppl√©mentaire n'√©tait requis.</p></li><li><p><strong>Transformation du timestamp</strong> La colonne <code>timestamp</code> a √©t√© convertie en une date lisible pour faciliter les analyses temporelles :</p><pre class="language-python line-numbers"><code>

from pyspark.sql.functions import from_unixtime

df = df.withColumn("date", from_unixtime(f.col("timestamp")))


</code></pre></li><li><p><strong>Typage des donn√©es</strong> Les types de colonnes (<code>userId</code>, <code>movieId</code>, <code>rating</code>, <code>timestamp</code>) ont √©t√© valid√©s comme appropri√©s pour les traitements envisag√©s.</p></li></ol><p>Les donn√©es sont d√©sormais pr√™tes pour la cr√©ation des matrices utilisateurs-films et l‚Äôimpl√©mentation du mod√®le.</p><h3 id="second-sprint" tabindex="-1"><a class="header-anchor" href="#second-sprint"></a> Second Sprint</h3><h4 id="impl%C3%A9mentation-du-mod%C3%A8le-de-recommandation-avec-als" tabindex="-1"><a class="header-anchor" href="#impl%C3%A9mentation-du-mod%C3%A8le-de-recommandation-avec-als"></a> Impl√©mentation du mod√®le de recommandation avec ALS</h4><p>Apr√®s avoir compris la th√©orie du mod√®le ALS, cr√©√© l'environnement pyspark, import√©, nettoy√© et explor√© les donn√©es de MovieLens nous pouvons impl√©menter une premi√®re fois le mod√®le ALS.</p><p>La premi√®re √©tape √† r√©aliser est de diviser notre dataset <strong>ratings</strong> en deux dataset, un dataset d'entrainement et un dataset de test. Comme il est coutume de le faire pour ce type de sujet, nous allons prendre al√©atoirement 80% des lignes du dataset pour constituer le dataset d'entrainement et 20% pour le dataset de test. Le mod√®le va donc √™tre appliqu√© sur le set d'entrainement et calculer de la m√™me fa√ßon que d√©finit dans la partie 1 du premier sprint les matrices \( U \) et \( M \).</p><div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950"><details class="group"><summary class="list-none py-0.5"><svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg> <svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg><div class="pl-8 font-bold inline-block group-open:select-text"><p>Le code</p></div><svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path></svg></summary><div class="mx-8 pb-2 cursor-auto select-text"><pre class="language-python line-numbers"><code>

from pyspark.ml.recommendation import ALS
from pyspark.ml.evaluation import RegressionEvaluator

rating = rating.select("userId", "movieId", "rating")
train, test = rating.randomSplit([0.8, 0.2], seed=42)

als = ALS(
    userCol="userId",
    itemCol="movieId",
    ratingCol="rating",
    coldStartStrategy="drop"
)

model = als.fit(train)


</code></pre></div></details></div><p>Pour √©valuer notre mod√®le, on va l'appliquer au set de test et calculer l'erreur quatratique moyenne RMSE (Root Mean Squared Error) qui est une m√©trique d'√©valuation qui mesure l'√©cart moyen entre les pr√©dictions du mod√®le et les valeurs r√©elles. Plus la valeur de RMSE est proche de 0, plus la pr√©diction est bonne. Le calcul de la valeur du RMSE pour cette premi√®re application du mod√®le nous donne <strong>RMSE = 0.84</strong>. Ce qui signifie que, en moyenne, l'√©cart entre la note pr√©dite et la note r√©elle est de 0.84 points.</p><p>Pour mieux visualiser la performance de cette premi√®re appliquation du mod√®le, voici un histogramme montrant les √©carts entre les notes pr√©dites et les notes r√©elles :</p><div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950"><details class="group"><summary class="list-none py-0.5"><svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg> <svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg><div class="pl-8 font-bold inline-block group-open:select-text"><p>Histogramme des √©carts</p></div><svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path></svg></summary><div class="mx-8 pb-2 cursor-auto select-text"><p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2024-2025/refs/heads/main//Baptiste-Audouin/pok/temps-3/images/hist_ecarts-1.png" alt="Ecarts"></p></div></details></div><p>Le syst√®me semble √™tre globalement performant, cependant il existe certains param√®tres appel√©s hyperparam√®tres cl√©s. Un hyperparam√®tre est une valeur d√©finie avant l'entra√Ænement d‚Äôun mod√®le de machine learning. Contrairement aux param√®tres (qui sont appris par le mod√®le), les hyperparam√®tres contr√¥lent la mani√®re dont le mod√®le apprend et se g√©n√©ralise. Dans la partie qui suit, nous allons explorer ces diff√©rents param√®tres et en modifier certains afin de voir s'il est possible de faire diminuer la valeur de RMSE.</p><h4 id="optimisation-des-hyperparam%C3%A8tres-du-mod%C3%A8le" tabindex="-1"><a class="header-anchor" href="#optimisation-des-hyperparam%C3%A8tres-du-mod%C3%A8le"></a> Optimisation des hyperparam√®tres du mod√®le</h4><p>Apr√®s avoir essayer d'agrandir le set d'entrainement (90% du set total), l'erreur n'est diminu√©e de fa√ßon significative. De plus, le set de test doit √™tre suffisamment grand afin de pouvoir correctement tester notre mod√®le. Cherchons maintenant quels hyperparam√®tres changer afin de potentiellement r√©duire l'erreur.</p><p>Voici les principaux param√®tres ajustables dans le mod√®le ALS de pyspark :</p><ol><li><strong>rank :</strong><ul><li>D√©finit le nombre de facteurs latents dans la factorisation de la matrice utilisateur-item.</li><li>Valeurs typiques : entre 10 et 50.</li></ul></li><li><strong>maxIter :</strong><ul><li>Nombre maximum d'it√©rations pour la convergence de l'algorithme.</li><li>Valeurs typiques : 10 √† 20.</li></ul></li><li><strong>regParam :</strong><ul><li>Param√®tre de r√©gularisation (L2) pour √©viter le surajustement.</li><li>Valeurs typiques : 0.01 √† 0.1.</li></ul></li><li><strong>alpha (uniquement si implicitPrefs=True) :</strong><ul><li>Contr√¥le l'importance des pr√©f√©rences implicites.</li><li>Valeurs typiques : 10 √† 40.</li></ul></li></ol><p>Apr√®s avoir recherch√© les valeurs optimales pour chacuns de ces param√®tres par dichotomie, voici les valeurs que nous avons trouv√© :</p><table><thead><tr><th>Param√®tres</th><th>Valeurs</th></tr></thead><tbody><tr><td><strong>rank</strong></td><td>16</td></tr><tr><td><strong>maxIter</strong></td><td>15</td></tr><tr><td><strong>regParam</strong></td><td>0.055</td></tr><tr><td><strong>alpha</strong></td><td>25</td></tr></tbody></table><h4 id="choix-du-mod%C3%A8le-finale" tabindex="-1"><a class="header-anchor" href="#choix-du-mod%C3%A8le-finale"></a> Choix du mod√®le finale</h4><p>Apr√®s avoir test√© l‚Äôensemble des hyperparam√®tres optimaux trouv√©s par dichotomie (rank=16, maxIter=15, regParam=0.055, alpha=25), nous avons constat√© une forte augmentation de l‚Äôerreur RMSE (sup√©rieur √† 3). Ce ph√©nom√®ne est un signe de surentra√Ænement (ou overfitting), ce qui signifie que le mod√®le s'est trop ajust√© aux donn√©es d'entra√Ænement et ne g√©n√©ralise plus bien aux nouvelles donn√©es du test. En ne gardant que rank=16 et regParam=0.055, nous avons observ√© une l√©g√®re diminution de l'erreur RMSE par rapport √† notre premi√®re tentative avec les param√®tres par d√©faut. Nous utiliserons donc ces param√®tres pour la derni√®re partie.</p><h4 id="recommandation-avec-l'algorithme" tabindex="-1"><a class="header-anchor" href="#recommandation-avec-l'algorithme"></a> Recommandation avec l'algorithme</h4><p>Le but de cette derni√®re partie est de cr√©er une fonction qui prend en argument l'id d'un utilisateur et qui renvoie les 5 films les plus recommand√©s par notre algorithme parmis ceux qu'il n'a pas vu.</p><div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950"><details class="group"><summary class="list-none py-0.5"><svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg> <svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg><div class="pl-8 font-bold inline-block group-open:select-text"><p>La fonction</p></div><svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path></svg></summary><div class="mx-8 pb-2 cursor-auto select-text"><pre class="language-python line-numbers"><code>

from pyspark.sql.functions import col

def recommend_movies(user_id, nb_reco=5):
    seen_movies = rating.filter(col("userId") == user_id).select("movieId")
    unseen_movies = movie.select("movieId").subtract(seen_movies)
    user_unseen_movies = unseen_movies.withColumn("userId", col("movieId") * 0 + user_id)
    recommendations = model.transform(user_unseen_movies)
    top_movies = recommendations.orderBy(col("prediction").desc()).limit(nb_reco)
    final_recommendations = top_movies.join(movie, "movieId").select("title")

    return final_recommendations


</code></pre></div></details></div><p>Cette fonction nous renvoie donc le titre et la date des films les plus recommand√©s pour l'utilisateur.</p></article></main><footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-center items-center"><p class="text-center">¬©2025 <b><span style="font-family:Consolas,sans-serif">Do-<span style="color:#4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT</p></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},document.addEventListener("DOMContentLoaded",(()=>{MathJax.typeset()}))</script><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0})</script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script></body></html>