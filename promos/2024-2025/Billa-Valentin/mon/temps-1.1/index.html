<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="index, follow"><link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2024-2025/Billa-Valentin/mon/temps-1.1/"><meta name="description" content="Apprentissage de fonctionnalit√©s avanc√©es SQL"><meta property="og:description" content="Apprentissage de fonctionnalit√©s avanc√©es SQL"><meta name="twitter:description" content="Apprentissage de fonctionnalit√©s avanc√©es SQL"><meta name="author" content="Valentin Billa"><meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, MON, vert, avanc√©, sql"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png"><link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png"><link href="/assets/stylesheets/main.css" rel="stylesheet"><meta property="og:title" content="SQL Avanc√©"><meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2024-2025/Billa-Valentin/mon/temps-1.1/"><meta property="og:type" content="website"><meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:title" content="SQL Avanc√©"><meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2024-2025/Billa-Valentin/mon/temps-1.1/"><title>SQL Avanc√©</title><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet"><link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script defer="">const storedTheme=localStorage.getItem("theme");function loadPrismTheme(e){const t=e?"prism-okaidia.min.css":"prism-solarizedlight.min.css",s=document.createElement("link");s.rel="stylesheet",s.id="prism-theme",s.href=`https://cdn.jsdelivr.net/npm/prismjs/themes/${t}`,s.onload=()=>{Prism.highlightAll()};const m=document.getElementById("prism-theme");m?document.head.replaceChild(s,m):document.head.appendChild(s)}function setMermaidTheme(e){const t=e?"dark":"forest";mermaid.initialize({securityLevel:"loose",theme:t,startOnLoad:!0})}function toggleDarkMode(){const e=document.documentElement.classList.contains("dark"),t=e?"light":"dark";localStorage.setItem("theme",t),document.documentElement.classList.toggle("dark",!e),loadPrismTheme(!e),setMermaidTheme(!e)}storedTheme?document.documentElement.classList.toggle("dark","dark"===storedTheme):document.documentElement.classList.toggle("dark",window.matchMedia("(prefers-color-scheme: dark)").matches);const isDark=document.documentElement.classList.contains("dark");loadPrismTheme(isDark),setMermaidTheme(isDark)</script></head><body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50"><header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-between items-center"><a class="mx-2" href="/">Home</a> <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current"><circle cx="12" cy="12" r="5"></circle><path d="M12 2V4" stroke-linecap="round"></path><path d="M12 20V22" stroke-linecap="round"></path><path d="M4 12L2 12" stroke-linecap="round"></path><path d="M22 12L20 12" stroke-linecap="round"></path><path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path><path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path><path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path><path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path></svg> <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block"><path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="flex items-center gap-4 sm:gap-6"><a class="" href="/cs">CS</a> <a class="" href="/pok">POK</a> <a class="" href="/mon">MON</a> <a class="" href="/projets">Projets</a> <a class="hidden sm:block" href="/promos">Promos</a> <a href="/search"><svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg> </a><a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank"><svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div></header><main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body=""><article class="relative"><h1 class="mb-1">SQL Avanc√©</h1><div class="mb-4"><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Tags :</div><ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags"><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">MON</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">vert</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">avanc√©</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">sql</li></ul><div class="hidden" data-pagefind-meta="Type" aria-hidden="true"><span data-pagefind-filter="Type">MON</span></div></div><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Auteur :</div><ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs"><li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Valentin Billa</li></ul></div><div class="absolute top-0 right-0"><span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">2024-2025</span></div></div><p class="mb-4 text-lg">Apprentissage de fonctionnalit√©s avanc√©es SQL</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path></svg><div class="pl-8 mr-8"><a href="/promos/2024-2025/Billa-Valentin/">Valentin Billa</a><span class="px-1">/</span><a href="/promos/2024-2025/Billa-Valentin/mon/">MONs Valentin Billa</a><span class="px-1">/</span><a href="/promos/2024-2025/Billa-Valentin/mon/temps-1.1/">SQL Avanc√©</a></div></div><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100 dark:border-pink-800 dark:bg-pink-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-pink-500 dark:stroke-pink-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg><div class="pl-8 mb-2 mr-8"><p><strong>Pr√©requis :</strong></p></div><div class="pl-8 mr-8"><ul><li>Vocabulaire de base solide en SQL (colonne, table, query...)</li><li>SQL Basique (SELECT, FROM, WHERE...)</li></ul></div></div><h2 id="objectifs" tabindex="-1"><a class="header-anchor" href="#objectifs"></a> Objectifs</h2><p>Ayant une attirance particuli√®re pour le back, SQL me fait de l'≈ìil ! C'est pourquoi je souhaite me former √† ses fonctions les plus avanc√©es, √† minima pour savoir qu'elles existent le jour o√π j'en aurais besoin.</p><p>Ce MON sera plut√¥t orient√© MySQL (car j'aime bien leur doc) mais je tenterais de faire des parall√®les avec d'autres SGBD (Syst√®me de Gestion de Base de Donn√©es) comme SQLite, PostgresSQL</p><h2 id="optimization-en-g%C3%A9n%C3%A9ral" tabindex="-1"><a class="header-anchor" href="#optimization-en-g%C3%A9n%C3%A9ral"></a> Optimization en G√©n√©ral</h2><h3 id="sql" tabindex="-1"><a class="header-anchor" href="#sql"></a> SQL</h3><p>Une particularit√© de SQL qu'il est important de garder en t√™te est qu'il ne s'agit pas r√©ellement d'un langage de programmation au sens traditionnel, mais plut√¥t d'un langage d√©claratif. Lorsque nous √©crivons une requ√™te SQL, nous ne donnons pas d'instructions d√©taill√©es sur la fa√ßon d'obtenir les donn√©es, mais nous d√©crivons plut√¥t le r√©sultat souhait√©. C'est au SGBD de d√©terminer le meilleur moyen d'obtenir ce r√©sultat.</p><p>Pour optimiser les requ√™tes SQL, il est crucial de comprendre comment le moteur de base de donn√©es interpr√®te et ex√©cute ces requ√™tes. Une des m√©thodes essentielles pour obtenir y arriver est l'utilisation de la commande <code>EXPLAIN</code>.</p><h3 id="la-commande-explain" tabindex="-1"><a class="header-anchor" href="#la-commande-explain"></a> La commande <code>EXPLAIN</code></h3><p>La commande <code>EXPLAIN</code> permet de voir comment le SGBD interpr√®te une requ√™te SQL. Elle fournit des informations d√©taill√©es sur le plan d'ex√©cution d'une requ√™te, ce qui peut aider √† identifier les parties de la requ√™te qui pourraient √™tre optimis√©es pour am√©liorer les performances.</p><p>Pour utiliser <code>EXPLAIN</code>, il suffit de la pr√©c√©der √† une requ√™te SQL :</p><pre class="language-sql line-numbers"><code>

EXPLAIN SELECT * FROM users WHERE age > 25;


</code></pre><p>Le r√©sultat de <code>EXPLAIN</code> comprend plusieurs colonnes importantes, notamment :</p><ul><li><strong>id</strong> : l'identifiant unique de l'√©tape de requ√™te.</li><li><strong>select_type</strong> : le type de requ√™te SQL principale.</li><li><strong>table</strong> : la table √† laquelle la requ√™te acc√®de.</li><li><strong>possible_keys</strong> : les index qui peuvent √™tre utilis√©s pour acc√©l√©rer la requ√™te.</li><li><strong>key</strong> : l'index effectivement utilis√©.</li><li><strong>rows</strong> : le nombre estim√© de lignes que le SGBD doit parcourir pour satisfaire cette √©tape de la requ√™te.</li><li><strong>Extra</strong> : des informations suppl√©mentaires sur l'ex√©cution de la requ√™te.</li></ul><div class="quote relative drop-shadow py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100 dark:border-amber-800 dark:bg-amber-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-amber-800 dark:stroke-amber-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Note</b></p></div><div class="pl-8 mr-8"><p>La commande <code>EXPLAIN</code> renvoie un r√©sultat honn√™tement difficile √† aborder les premi√®res fois. Avec le temps, on comprend de mieux en mieux les particularit√©s √† prendre en compte eg. les diff√©rents types de <strong>select_type</strong> et en l'occurrence ceux qui sont symptomatiques d'une query qui va √™tre lente.</p></div></div><p>Par exemple, pour la requ√™te pr√©c√©dente, le r√©sultat de <code>EXPLAIN</code> pourrait ressembler √† ceci :</p><pre class="language-text line-numbers"><code>

> EXPLAIN EXPLAIN SELECT * FROM users WHERE age > 25;
+----+-------------+-------+---------------+---------+---------+------+---------+-------------+
| id | select_type | table | possible_keys | key     | key_len | ref  | rows    | Extra       |
+----+-------------+-------+---------------+---------+---------+------+---------+-------------+
|  1 | SIMPLE      | users | NULL          | NULL    | NULL    | NULL | 1000000 | Using where |
+----+-------------+-------+---------------+---------+---------+------+---------+-------------+


</code></pre><p>Dans cet exemple, on voit que la table <code>users</code> est analys√©e sans utiliser d'index (NULL), et que la requ√™te estime devoir parcourir un million de lignes pour trouver les r√©sultats. Cette estimation n'est pas anodyne, le SGBD fait des statistiques au fur et √† mesure des requ√™tes faites en bases de donn√©es et s'en sert pour mieux adapter le plan d'ex√©cution, il est important que ces estimations ne soient pas trop loin du compte.</p><p>Une autre utilit√© d'<code>EXPLAIN</code> est de d√©terminer si deux requ√™tes SQL sont strictement √©quivalentes lors de leur ex√©cution. √áa peut √™tre utile quand on essaie de r√©√©crire une requ√™te pour qu'elle soit plus lisible.</p><p>Par exemple</p><pre class="language-sql line-numbers"><code>

-- requ√™te 1 (on parlera du mot cl√©s WITH en dessous)
EXPLAIN WITH filtered_users AS (
    SELECT * FROM users WHERE age > 25
)
SELECT f.*, orders.*
FROM filtered_users f
JOIN orders ON f.user_id = orders.user_id;

-- requ√™te 2
EXPLAIN SELECT u.*, o.*
FROM users u, orders o
WHERE u.age > 25 AND u.user_id = o.user_id;


</code></pre><p>Les plans d'ex√©cution pour ces deux requ√™tes sont identiques, car elles accomplissent essentiellement la m√™me t√¢che.</p><pre class="language-text line-numbers"><code>

+----+-------------+-------+---------------+---------+---------+------+---------+--------------------------------+
| id | select_type | table | possible_keys | key     | key_len | ref  | rows    | Extra                          |
+----+-------------+-------+---------------+---------+---------+------+---------+--------------------------------+
|  1 | SIMPLE      | users | NULL          | NULL    | NULL    | NULL | 1000000 | Using where; Using join buffer |
|  1 | SIMPLE      | orders| NULL          | NULL    | NULL    | NULL | 1000000 |                                |
+----+-------------+-------+---------------+---------+---------+------+---------+--------------------------------+


</code></pre><div class="quote relative drop-shadow py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100 dark:border-amber-800 dark:bg-amber-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-amber-800 dark:stroke-amber-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Note</b></p></div><div class="pl-8 mr-8"><p>Attention n√©anmoins, il faut toujours garder en t√™te que m√™me si deux requ√™tes font la m√™me chose, elles peuvent mener √† un plan d'ex√©cution diff√©rent. En effet, le SQBD est libre d'interpr√©ter le SQL comme il le souhaite la seule garantie est qu'il renverra les r√©sultats qu'on lui a demand√©s.</p></div></div><h3 id="la-commande-analyze" tabindex="-1"><a class="header-anchor" href="#la-commande-analyze"></a> La commande <code>ANALYZE</code></h3><p>La commande <code>ANALYZE</code> est utilis√©e pour analyser et stocker les informations cl√© pour une table. Elle permet d'explicitement demander au SGBD de collecter des statistiques sur la distribution des donn√©es dans une table. Comme on l'a vu dans la partie <code>EXPLAIN</code> elle peut √™tre tr√®s utile pour corriger des erreurs d'estimations.</p><pre class="language-sql line-numbers"><code>

ANALYZE TABLE users;


</code></pre><h3 id="la-commande-optimize" tabindex="-1"><a class="header-anchor" href="#la-commande-optimize"></a> La commande <code>OPTIMIZE</code></h3><p>La commande <code>OPTIMIZE</code> est utilis√©e pour optimiser les tables dans des bases de donn√©es comme MySQL. Elle est utile pour r√©cup√©rer l'espace inutilis√© et pour am√©liorer les performances des requ√™tes. Apr√®s de nombreuses op√©rations d'insertion, de mise √† jour et de suppression, les tables peuvent devenir fragment√©es. Utiliser la commande <code>OPTIMIZE</code> aide √† d√©fragmenter les tables et √† r√©organiser les donn√©es sur le disque pour une performance optimale.</p><pre class="language-sql line-numbers"><code>

OPTIMIZE TABLE users;


</code></pre><p>Lorsque la commande est ex√©cut√©e, le SGBD effectue les √©tapes suivantes:</p><ul><li>D√©fragmente la table et lib√®re l'espace inutilis√©.</li><li>R√©arrange les tables et les index.</li><li>Actualise les statistiques des tables.</li></ul><p><code>OPTIMIZE</code> tout comme <code>ANALYZE</code> est une op√©ration lourde qui doit √™tre utilis√©e √† bon escient, ie. par avant chaque requ√™te, ce serait contre productif.</p><h2 id="indexes" tabindex="-1"><a class="header-anchor" href="#indexes"></a> Indexes</h2><p>Les <strong>indexes</strong> sont des structures de donn√©es associ√©es aux tables d'une base de donn√©es. Ils permettent d'acc√©l√©rer consid√©rablement les op√©rations de recherche en fournissant un acc√®s rapide aux lignes de la table en fonction des valeurs des colonnes index√©es.</p><p>Ils permettent des optimisations de deux fa√ßons :</p><ul><li><strong>Am√©lioration des performances des requ√™tes</strong> : Les indexes r√©duisent le temps de recherche des donn√©es. Par exemple, une recherche d'une ligne sp√©cifique bas√©e sur une colonne index√©e sera beaucoup plus rapide qu'une recherche sans index.</li><li><strong>Optimisation des tris et des jointures</strong> : Les indexes peuvent √™tre utilis√©s pour acc√©l√©rer les op√©rations de tri ( ORDER BY) et de jointure (JOIN), car les donn√©es sont souvent organis√©es de mani√®re pr√©-optimis√©e.</li></ul><p>Cependant, les indexes ont un <strong>co√ªt spatial</strong> non n√©gligeable. En effet, ils occupent de l'espace disque suppl√©mentaire qui peut devenir significatif, surtout si plusieurs colonnes d'une table sont index√©es. Les indexes doivent √©galement √™tre mis √† jour chaque fois que les donn√©es de la table sont modifi√©es (insertions, suppressions, mises √† jour), ce qui peut ajouter un surco√ªt en termes de temps de traitement.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100 dark:border-cyan-800 dark:bg-cyan-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-cyan-500 dark:stroke-cyan-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Information</b></p></div><div class="pl-8 mr-8"><p>Une bonne pratique est de prioriser l'indexage des colones que l'on utilise beaucoup pour faire des tris ou filtres.</p></div></div><p>Voici un exemple de cr√©ation d'index pour la colonne <code>age</code> de la table <code>users</code> :</p><pre class="language-sql line-numbers"><code>

CREATE INDEX idx_users_age ON users (age);


</code></pre><p>Ce code cr√©e un index sur la colonne <code>age</code> de la table <code>users</code>, ce qui peut am√©liorer la performance des requ√™tes qui filtrent ou trient par la colonne <code>age</code>.</p><p>L'impact de cet index peut √™tre observ√© dans le tableau <code>EXPLAIN</code> pr√©c√©dent :</p><pre class="language-text line-numbers"><code>

> EXPLAIN EXPLAIN SELECT * FROM users WHERE age > 25;
+----+-------------+-------+---------------+---------------+---------+------+---------+--------------------------+
| id | select_type | table | possible_keys | key           | key_len | ref  | rows    | Extra                    |
+----+-------------+-------+---------------+---------------+---------+------+---------+--------------------------+
|  1 | SIMPLE      | users | idx_users_age | idx_users_age | 5       | NULL | 1000000 | Using where; Using index |
+----+-------------+-------+---------------+---------------+---------+------+---------+--------------------------+


</code></pre><p>Avec l'index <code>idx_users_age</code>, le SGBD (Syst√®me de Gestion de Base de Donn√©es) peut utiliser cet index pour optimiser l'acc√®s aux lignes de la table <code>users</code> en fonction de la colonne <code>age</code>, r√©duisant ainsi le temps de traitement des requ√™tes.</p><h3 id="indexes-spatiaux" tabindex="-1"><a class="header-anchor" href="#indexes-spatiaux"></a> Indexes spatiaux</h3><p>Il existe aussi des <strong>indexes spatiaux</strong> (comme les R-trees dans PostGIS pour PostgreSQL) qui sont tr√®s utiles pour les op√©rations g√©ospatiales impliquant des centaines de millions de points. J'ai utilis√© ces indexes dans un projet PostGIS pour optimiser les requ√™tes g√©ospatiales, telles que les recherches de proximit√© et les calculs d'intersection, qui seraient autrement tr√®s co√ªteux en termes de temps de traitement (surtout avec des dizaines de millions de coordonn√©es).</p><p>Voici un exemple d'utilisation d'un index spatial pour optimiser une requ√™te :</p><pre class="language-sql line-numbers"><code>

CREATE INDEX idx_spatial_users_location ON users USING GIST (location);

EXPLAIN ANALYZE
SELECT * FROM users
WHERE ST_DWithin(location, ST_MakePoint(-73.9866, 40.7306)::geography, 5000);


</code></pre><p>Cr√©er un index spatial sur la colonne <code>location</code> permet au SGBD de traiter beaucoup plus rapidement les requ√™tes impliquant des op√©rations g√©ospatiales complexes.</p><div class="quote relative drop-shadow py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100 dark:border-amber-800 dark:bg-amber-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-amber-800 dark:stroke-amber-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Note</b></p></div><div class="pl-8 mr-8"><p>Pour la suite du MON, j'ai explor√© diff√©rents concepts sans forc√©ment chercher √† faire des liens entre eux. Ce sont des mots cl√©s, options, possibilit√©s utiles individuellement.</p></div></div><h2 id="vues" tabindex="-1"><a class="header-anchor" href="#vues"></a> Vues</h2><p>Les <strong>vues</strong> (mot cl√© <code>VIEW</code>) sont des objets de la base de donn√©es qui permettent de sauvegarder des requ√™tes sous la forme d'une table virtuelle. Elles permettent de simplifier l'√©criture de requ√™te, souvent en encapsulant des jointures complexes. Voici un exemple de cr√©ation de vue :</p><pre class="language-sql line-numbers"><code>

CREATE VIEW users_over_25 AS
SELECT *
FROM users
WHERE age > 25;


</code></pre><p>Cette vue <code>users_over_25</code> peut ensuite √™tre utilis√©e comme une table normale :</p><pre class="language-sql line-numbers"><code>

SELECT *
FROM users_over_25;


</code></pre><p>Les vues peuvent √©galement √™tre mises √† jour si elles satisfont certaines conditions, notamment si elles r√©f√©rencent une seule table.</p><div class="quote relative drop-shadow py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100 dark:border-amber-800 dark:bg-amber-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-amber-800 dark:stroke-amber-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Note</b></p></div><div class="pl-8 mr-8"><p>Il ne faut cependant pas se faire avoir, les jointures complexes ou conditions d√©finies dans la vue ne sont <strong>pas</strong> calcul√©es en avance, mais plut√¥t int√©gr√©es lors de l'ex√©cution de la requ√™te. De ce fait, l'utilisation de vue fait gagner en lisibilit√© sans gain de performance.</p></div></div><h3 id="les-mots-cl%C3%A9s-with" tabindex="-1"><a class="header-anchor" href="#les-mots-cl%C3%A9s-with"></a> Les mots cl√©s <code>WITH</code></h3><p>Le mot cl√© <code>WITH</code> est utilis√© pour introduire une clause <code>Common Table Expressions</code> (CTE) qui permet de d√©finir des tables temporaires dont la port√©e est limit√©e √† la requ√™te dans laquelle elles sont d√©finies. Cela peut entra√Æner une meilleure lisibilit√© et r√©utilisation des requ√™tes complexes. Voici un exemple de CTE :</p><pre class="language-sql line-numbers"><code>

WITH UsersOver25 AS (
    SELECT *
    FROM users
    WHERE age > 25
)
SELECT *
FROM UsersOver25
WHERE name LIKE 'A%';


</code></pre><p>Dans cet exemple, la CTE <code>UsersOver25</code> est d√©finie et utilis√©e dans la m√™me requ√™te pour filtrer les utilisateurs dont le nom commence par 'A'.</p><p>Les CTE peuvent √©galement √™tre r√©cursives. Voici un exemple de CTE r√©cursive :</p><pre class="language-sql line-numbers"><code>

WITH RECURSIVE EmployeeHierarchy AS (
    SELECT employee_id, manager_id, name
    FROM employees
    WHERE manager_id IS NULL
UNION ALL
    SELECT e.employee_id, e.manager_id, e.name
    FROM employees e
    INNER JOIN EmployeeHierarchy eh ON e.manager_id = eh.employee_id
)
SELECT *
FROM EmployeeHierarchy;


</code></pre><p>Ce code permet de cr√©er une hi√©rarchie de l'organisation des employ√©s o√π chaque employ√© est reli√© √† son manager.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100 dark:border-emerald-800 dark:bg-emerald-950"><svg class="absolute w-6 h-6 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-emerald-500 dark:stroke-emerald-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Liens</b></p></div><div class="pl-8 mr-8"><p>La feature est int√©ressante, mais pas facile √† comprendre, la meilleure explication que j'ai trouv√©e pour l'instant est dans une <a href="https://stackoverflow.com/a/18660789">r√©ponse StackOverflow</a>.</p></div></div><h2 id="proc%C3%A9dures-stock%C3%A9es" tabindex="-1"><a class="header-anchor" href="#proc%C3%A9dures-stock%C3%A9es"></a> Proc√©dures stock√©es</h2><p>Les <strong>proc√©dures stock√©es</strong> sont des sous-programmes stock√©s dans la base de donn√©es. Elles permettent d'ex√©cuter des suites d'instructions de mani√®re r√©utilisable et optimis√©e. Cette fonctionnalit√© n'est pas standardis√©e c'est pourquoi nous allons devoir faire une disjonction de cas en fonction du SGBD.</p><h3 id="sqlite" tabindex="-1"><a class="header-anchor" href="#sqlite"></a> SQLite</h3><p>SQLite ne supporte pas directement les proc√©dures stock√©es. Il est plut√¥t encourag√© de cr√©er lesdites proc√©dures directement dans le programme appellant en cr√©ant des scripts.</p><h3 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql"></a> MySQL</h3><p>La syntaxe pour cr√©er une proc√©dure stock√©e en MySQL est la suivante :</p><pre class="language-sql line-numbers"><code>

DELIMITER $$

CREATE PROCEDURE AjouterUtilisateur(IN nom VARCHAR(255), IN age INT)
BEGIN
    INSERT INTO users (name, age) VALUES (nom, age);
END$$

DELIMITER ;


</code></pre><p>Vous pouvez appeler cette proc√©dure comme suit :</p><pre class="language-sql line-numbers"><code>

CALL AjouterUtilisateur('John Doe', 30);


</code></pre><p>Les proc√©dures stock√©es peuvent accepter des param√®tres d'entr√©e (<code>IN</code>), de sortie (<code>OUT</code>), ou des param√®tres d'entr√©e/sortie (<code>INOUT</code>).</p><h3 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql"></a> PostgreSQL</h3><p>Pour cr√©er une proc√©dure stock√©e en PostgresSQL, on peut utiliser deux syntaxes :</p><ol><li><code>CREATE FUNCTION</code></li></ol><pre class="language-sql line-numbers"><code>

CREATE FUNCTION AjouterUtilisateur(nom VARCHAR, age INTEGER)
RETURNS VOID AS $$
BEGIN
    INSERT INTO users (name, age) VALUES (nom, age);
END;
$$ LANGUAGE plpgsql;


</code></pre><ol start="2"><li><code>CREATE PROCEDURE</code> <em>introduite √† partir de la version 11</em></li></ol><pre class="language-sql line-numbers"><code>

CREATE PROCEDURE AjouterUtilisateur(nom VARCHAR, age INTEGER)
LANGUAGE SQL
AS $$
INSERT INTO users (name, age) VALUES (nom, age);
$$;


</code></pre><p>Pour appeler cette fonction, on utilise :</p><pre class="language-sql line-numbers"><code>

SELECT AjouterUtilisateur('Jane Doe', 25);


</code></pre><p>Les fonctions peuvent retourner diff√©rentes valeurs types (par exemple, <code>VOID</code>, <code>TABLE</code>, etc.) et prennent en charge un large √©ventail de langages de programmation via des langages proc√©duraux comme <code>plpgsql</code>.</p><h2 id="bibliographie" tabindex="-1"><a class="header-anchor" href="#bibliographie"></a> Bibliographie</h2><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100 dark:border-emerald-800 dark:bg-emerald-950"><svg class="absolute w-6 h-6 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-emerald-500 dark:stroke-emerald-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Liens</b></p></div><div class="pl-8 mr-8"><ul><li><a href="https://www.w3schools.com/sql/sql_quickref.asp">W3Schools SQL Quickref</a> <em>documentation plut√¥t d√©taill√©e de tout un tas de fonctionnalit√©s SQL</em></li><li><a href="https://www.geeksforgeeks.org">GeeksForGeeks</a> <em>bon site regroupant tutoriels et explications (pas seulement pour SQL)</em></li><li><a href="https://dev.mysql.com/doc/refman/9.0/en/">Doc MySQL 9.0</a> <em>je la trouve plus facile √† naviguer que les deux autres</em></li><li><a href="https://www.sqlite.org/docs.html">Doc SQLite</a></li><li><a href="https://www.postgresql.org/docs/current/index.html">Doc PostgresSQL 16.4</a></li><li><a href="https://www.youtube.com/watch?v=5Pc18ge9ohI">Writing My Own Database From Scratch - Tony Saro</a> <em>vid√©o extr√™mement enrichissante sur les d√©tails techniques des SGBD</em></li></ul></div></div><h2 id="concepts-%C3%A0-approfondir" tabindex="-1"><a class="header-anchor" href="#concepts-%C3%A0-approfondir"></a> Concepts √† approfondir</h2><ul><li><a href="https://dev.mysql.com/doc/refman/8.4/en/window-functions-usage.html">Window Functions</a></li><li><a href="https://sqlspreads.com/blog/temporal-tables-in-sql-server/">Temporal Tables (SQL Server)</a> <em>J'en ai entendu parler lors de mon premier stage, le concept a l'air sacr√©ment utile</em></li><li><a href="https://dev.mysql.com/doc/refman/8.4/en/fulltext-search.html">FULLTEXT Search</a> <em>Permet de cr√©er un index sur des donn√©es textuelles pour faire de la recherche rapide</em></li></ul></article></main><footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-center items-center"><p class="text-center">¬©2025 <b><span style="font-family:Consolas,sans-serif">Do-<span style="color:#4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT</p></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},document.addEventListener("DOMContentLoaded",(()=>{MathJax.typeset()}))</script><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0})</script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script></body></html>