<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="index, follow"><link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2022-2023/Bilgi-Tuncay/pok/temps-3/"><meta name="description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta property="og:description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta name="twitter:description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta name="author" content="Tuncay Bilgi"><meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, POK, CI/CD, jenkins, docker, TDD, nextjs, react, CMS"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png"><link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png"><link href="/assets/stylesheets/main.css" rel="stylesheet"><meta property="og:title" content="CI/CD : D√©ploiement et Integration continues"><meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2022-2023/Bilgi-Tuncay/pok/temps-3/"><meta property="og:type" content="website"><meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:title" content="CI/CD : D√©ploiement et Integration continues"><meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2022-2023/Bilgi-Tuncay/pok/temps-3/"><title>CI/CD : D√©ploiement et Integration continues</title><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet"><link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script defer="">const storedTheme=localStorage.getItem("theme");function loadPrismTheme(e){const t=e?"prism-okaidia.min.css":"prism-solarizedlight.min.css",s=document.createElement("link");s.rel="stylesheet",s.id="prism-theme",s.href=`https://cdn.jsdelivr.net/npm/prismjs/themes/${t}`,s.onload=()=>{Prism.highlightAll()};const m=document.getElementById("prism-theme");m?document.head.replaceChild(s,m):document.head.appendChild(s)}function setMermaidTheme(e){const t=e?"dark":"forest";mermaid.initialize({securityLevel:"loose",theme:t,startOnLoad:!0})}function toggleDarkMode(){const e=document.documentElement.classList.contains("dark"),t=e?"light":"dark";localStorage.setItem("theme",t),document.documentElement.classList.toggle("dark",!e),loadPrismTheme(!e),setMermaidTheme(!e)}storedTheme?document.documentElement.classList.toggle("dark","dark"===storedTheme):document.documentElement.classList.toggle("dark",window.matchMedia("(prefers-color-scheme: dark)").matches);const isDark=document.documentElement.classList.contains("dark");loadPrismTheme(isDark),setMermaidTheme(isDark)</script></head><body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50"><header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-between items-center"><a class="mx-2" href="/">Home</a> <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current"><circle cx="12" cy="12" r="5"></circle><path d="M12 2V4" stroke-linecap="round"></path><path d="M12 20V22" stroke-linecap="round"></path><path d="M4 12L2 12" stroke-linecap="round"></path><path d="M22 12L20 12" stroke-linecap="round"></path><path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path><path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path><path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path><path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path></svg> <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block"><path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="flex items-center gap-4 sm:gap-6"><a class="" href="/cs">CS</a> <a class="" href="/pok">POK</a> <a class="" href="/mon">MON</a> <a class="" href="/projets">Projets</a> <a class="hidden sm:block" href="/promos">Promos</a> <a href="/search"><svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg> </a><a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank"><svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div></header><main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body=""><article class="relative"><h1 class="mb-1">CI/CD : D√©ploiement et Integration continues</h1><div class="mb-4"><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Tags :</div><ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags"><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">POK</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">CI/CD</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">jenkins</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">docker</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">TDD</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">nextjs</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">react</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">CMS</li></ul><div class="hidden" data-pagefind-meta="Type" aria-hidden="true"><span data-pagefind-filter="Type">POK</span></div></div><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Auteur :</div><ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs"><li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Tuncay Bilgi</li></ul></div><div class="absolute top-0 right-0"><span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">2022-2023</span></div></div><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path></svg><div class="pl-8 mr-8"><a href="/promos/2022-2023/Bilgi-Tuncay/">Tuncay Bilgi</a><span class="px-1">/</span><a href="/promos/2022-2023/Bilgi-Tuncay/pok/">POK de Tuncay</a><span class="px-1">/</span><a href="/promos/2022-2023/Bilgi-Tuncay/pok/temps-3/">CI/CD : D√©ploiement et Integration continues</a></div></div><p>Dans ce POK, nous allons am√©liorer mon projet pr√©c√©dent : l'Artblog, en lui ajoutant de nouvelles pages et en cr√©ant un environnement d'int√©gration et de d√©ploiement continue.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100 dark:border-pink-800 dark:bg-pink-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-pink-500 dark:stroke-pink-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg><div class="pl-8 mb-2 mr-8"><p>Niveau avanc√©</p></div><div class="pl-8 mr-8"><p>C'est un POK avanc√© car il met en relation plusieurs technologies diff√©rentes qu'il faut donc conna√Ætre, il demande de solides bases en :</p><ul><li>Linux et shell</li><li>D√©veloppement web fullstack</li><li>Docker</li><li>Jenkins</li><li>Programmation par les tests</li></ul></div></div><div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950"><details class="group"><summary class="list-none py-0.5"><svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg> <svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg><div class="pl-8 font-bold inline-block group-open:select-text"><p>Ce POK ce base sur plusieurs MON et POK qui ont pr√©c√©d√©s, voici la liste des projets dont j'ai eu besoin.</p></div><svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path></svg></summary><div class="mx-8 pb-2 cursor-auto select-text"><ul><li>Le projet sur lequel ce POK se base : Artblog - <a href="https://do-it.aioli.ec-m.fr/pok/un-site-chez-moi/TBi/Artblog/">Dev du Blog</a> | <a href="https://do-it.aioli.ec-m.fr/pok/un-site-chez-moi/TBi/ServeurDistant/">Mise sur Site distant</a></li><li>Le MON introduisant <a href="https://do-it.aioli.ec-m.fr/mon/TBi/MON/Docker/">Docker</a></li><li>Le Mon introduisant <a href="https://do-it.aioli.ec-m.fr/mon/TBi/MON/Jenkins/">Jenkins</a></li></ul></div></details></div><p>Enfin, voici le lien du <a href="https://github.com/TuncayBilgi/artblog">repository GitHub</a> o√π vous pourrez trouver tous le code.</p><h2 id="introduction-%3A" tabindex="-1"><a class="header-anchor" href="#introduction-%3A"></a> Introduction :</h2><h3 id="point-de-d%C3%A9part-%3A" tabindex="-1"><a class="header-anchor" href="#point-de-d%C3%A9part-%3A"></a> Point de d√©part :</h3><p>Le Artblog est un projet de blog que j'ai men√© toute l'ann√©e scolaire. Voici un r√©sum√© de ce qui √† √©t√© fait jusqu'ici :</p><ul><li>D√©veloppement du site en suivant un tuto YouTube.</li><li>D√©ploiement du site sur le serveur ovh1 de Do-It.</li><li>Conteneurisation du projet.</li><li>Ajout d'un script de d√©ploiement qui permet de mettre le site √† jour en ligne automatiquement.</li><li>Ajout d'une instance Jenkins pour, plus tard, automatiser la production.</li></ul><h3 id="ce-qu'il-reste-%C3%A0-faire-%3A" tabindex="-1"><a class="header-anchor" href="#ce-qu'il-reste-%C3%A0-faire-%3A"></a> Ce qu'il reste √† faire :</h3><p>Nous allons finir de mettre en place l'automatisation autour du projet. Le but final est d'avoir un site disponible sur internet. Quand un d√©veloppeur ajoute une fonctionnalit√© ou corrige un bug, un serveur d√©tecte automatiquement qu'il y des changements qui ne sont pas sur internet. A ce moment, il effectue une batterie de tests sur le code source, si les tests passent, le serveur d√©ploie automatiquement la nouvelle version sur le net.</p><p>Techniquement cela veut dire qu'au premier sprint nous allons :</p><ul><li>Mettre en place Jest pour incorporer des tests dans l'application.</li><li>Coder une nouvelle fonctionnalit√© en TDD.</li></ul><p>Au second sprint :</p><ul><li>Mettre en place le script Jenkins.</li><li>Tester l'int√©gration de bout en bout.</li></ul><h3 id="r%C3%A9alisation-des-sprints-%3A" tabindex="-1"><a class="header-anchor" href="#r%C3%A9alisation-des-sprints-%3A"></a> R√©alisation des sprints :</h3><p>La Todo des sprints √©tait volontairement vague car le temps manque trop en fin d'ann√©e et il est bon de se concentrer sur l'essentiel des t√¢ches et ajouter des d√©tails si on a du temps en trop, ce qui n'a pas √©t√© mon cas. J'ai n√©anmoins pus atteindre mes objectifs fix√©s.</p><p>Le r√©sultat est un blog qui fonctionne bien, quoiqu'avec parfois trop de latence. C'est surtout un site que l'on peut maintenir correctement et en √©quipe.</p><h2 id="premier-sprint-%3A" tabindex="-1"><a class="header-anchor" href="#premier-sprint-%3A"></a> Premier Sprint :</h2><h3 id="ajout-de-jest-%3A" tabindex="-1"><a class="header-anchor" href="#ajout-de-jest-%3A"></a> Ajout de Jest :</h3><p>On installe Jest pour pouvoir cr√©er des tests unitaires :</p><p><code>npm install --save-dev jest</code></p><p>Jest est tr√®s pratique, il permet de lancer tous les tests contenues dans les fichiers pr√©sents dans le r√©pertoire &quot;<strong>tests</strong>&quot;</p><p>La batterie de tests se lance avec <code>npx jest</code>, que l'on eut ajouter dans le config.json pour utiliser <code>npm run test</code>. le fichier config.json ressemble alors √† cela :</p><pre class="language-json line-numbers"><code>

{"scripts": {
    "test" : "npx jest",
    "dev": "next dev",
    "build": "next build",
    "start": "next start -p 10438"
  }}


</code></pre><p>Ensuite on cr√©er un dossier <strong>tests</strong> √† la racine et on y cr√©er le fichier &quot;categoriepage.js&quot; qui contiendra tous les tests li√©s √† la fonctionnalit√© du site que l'on va ajouter.</p><p>Jest utilise des m√©thodes built-in pour tester pleins de choses diff√©rentes, allez voir la documentation sur internet pour savoir lesquelles utiliser.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100 dark:border-red-800 dark:bg-red-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-red-500 dark:stroke-red-800 stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Attention</b></p></div><div class="pl-8 mr-8"><p>Par d√©faut Jest utilise la syntaxe <code>const a = require('./module')</code> qui n'est pas compatible avec le reste du projet qui lui est en ES6 et donc utilise la syntaxe suivante <code>import {a} from module</code></p></div></div><p>Pour pallier ce probl√®me, on cr√©er un fichier de configuration jest qui vient supplant√© la configuration par d√©faut et qui demande √† jest d'utiliser ES6 : config.jest</p><pre class="language-js line-numbers"><code>

const nextJest = require("next/jest");
const createJestConfig = nextJest({
  dir: "./",
});
const customJestConfig = {
  moduleDirectories: ["node_modules", "<rootdir>/"],
};
module.exports = createJestConfig(customJestConfig);


</rootdir></code></pre><p>Nous voil√† pr√™t pour la TDD!</p><h3 id="tdd%3A-ajout-d'une-page-dans-mon-site." tabindex="-1"><a class="header-anchor" href="#tdd%3A-ajout-d'une-page-dans-mon-site."></a> TDD: Ajout d'une page dans mon site.</h3><p>Je veux ajouter une s√©rie de pages dynamiques. On clique sur une cat√©gorie de publication, cela nous redirige vers une page qui liste tous les posts poss√©dant cette cat√©gorie.</p><p>Pour ce faire, on commence par √©crire les tests qui devront √™tre valid√©s par le code de la nouvelle fonctionnalit√© :</p><pre class="language-js line-numbers"><code>

import { getCategories,getPostsByCat } from "../services"

test(
    'CategoriesProps are fetched', async() =>{
        const categories = await getCategories();
        expect(categories).toContainEqual({name :'Sculpture',slug:'sculpture'})
    }
)


</code></pre><p>Ce test s'assure que les informations fetcher sont sous le bon format et qu'elle sont bien coh√©rentes.</p><p>Maintenant, il faut impl√©menter le code qui valide le test, ici il nous faut une fonction qui renvoie les donn√©es demander, c'est un fetch.:</p><ul><li>Impl√©mentation minimale :</li></ul><pre class="language-js line-numbers"><code>

function getCategories() {
  return {name :'Sculpture',slug:'sculpture'}
}


</code></pre><p>Cette impl√©mentation para√Æt d√©bile, mais si vous coder en √©quipe, elle permet de valider le test ET de laisser √† vous coll√®gue la possibilit√© de coder le front en ayant une id√©e de la structure de donn√©es √† laquelle le code doit s'attendre.</p><ul><li>Impl√©mentation finale : C'est une requ√™te graphQL il n'y √† pas d‚Äôint√©r√™t √† la coller ici.</li></ul><p>Apr√®s √ßa, on code le front, allez voir le premier POK ou des MON Reacts pour des tutos d√©taill√©s sur comment faire. Voici les r√©sultats :</p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bilgi-Tuncay/pok/images/artblog-cat1.png" alt="page de sculpture" style="height:250px;width:600px;margin:0 auto"> <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bilgi-Tuncay/pok/images/artblog-cat2.png" alt="page de sculpture" style="height:250px;width:500px;margin:0 auto"><h3 id="conclusion-premier-sprint-%3A" tabindex="-1"><a class="header-anchor" href="#conclusion-premier-sprint-%3A"></a> Conclusion Premier sprint :</h3><p>La partie facile de ce POK est termin√©e. Tout c'est bien pass√©, on pourrait continuer en :</p><ul><li>Impl√©mentant des tests unitaires pour toutes les fonctionnalit√©s du projet.</li><li>Impl√©mentant des tests de bout en bout.</li><li>Impl√©mentant des snapshots qui permettent de tester le front.</li></ul><p>Mais je n'ai pas le temps pour ces options, on passe √† la suite.</p><h2 id="second-sprint-%3A" tabindex="-1"><a class="header-anchor" href="#second-sprint-%3A"></a> Second sprint :</h2><h3 id="jenkins-%3A" tabindex="-1"><a class="header-anchor" href="#jenkins-%3A"></a> Jenkins :</h3><p>La mise en place de Jenkins dans un container peut √™tre vu dans le MON sur Jenkins. N√©anmoins, cette mise en place poss√®de plusieurs probl√®me :</p><ul><li>Jenkins ne poss√®de m√™me pas les librairies n√©cessaires pour faire tourner le projet.</li><li>Jenkins ne poss√®de pas les droits et les cl√©s n√©cessaires pour faire quoi que ce soit.</li><li>Il faut cr√©er le script d'automatisation.</li></ul><p>On y va dans l'ordre.</p><h4 id="l'installation-propre-%3A" tabindex="-1"><a class="header-anchor" href="#l'installation-propre-%3A"></a> L'installation propre :</h4><p>Jenkins √† besoin de node, de git,de ssh etc... pour faire tourner le projet. Dans le MON Jenkins on avait cr√©er un conteneur Jenkins en prenant simplement l'image officielle. Ici, nous allons utiliser l'image officielle alpine (bas√©e sur Linux alpine) a laquelle j'ajoute node et tmux (je n'ai pas eu besoin de tmux).</p><p>Voici le dockerfile :</p><pre class="language-dockerfile line-numbers"><code>

FROM jenkins/jenkins:lts-alpine-jdk11

USER root

RUN apk update && apk add nodejs npm
RUN apk add tmux

USER jenkins



</code></pre><p>et le docker-compose qui s'occupe des connexions :</p><pre class="language-yml line-numbers"><code>

version: '3'
services:
  jenkins:
    build: .
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - jenkins_home:/var/jenkins_home
    environment:
      JAVA_OPTS: "-Djenkins.install.runSetupWizard=false"

volumes:
  jenkins_home:


</code></pre><p>Gr√¢ce √† cela on √† un conteneur qui contient Jenkins et qui enregistre ces donn√©es entre deux lancements.</p><h4 id="les-secrets-%3A" tabindex="-1"><a class="header-anchor" href="#les-secrets-%3A"></a> Les secrets :</h4><p>Tous d'abord on donne √† Jenkins, dans la partie <strong>manage credentials</strong> les cl√©s n√©cessaires √† faire fonctionner et √† d√©ployer le projet.</p><p>Je lui donne alors ma cl√© d'API et une cl√© ssh qui poss√®de les acc√®s au serveur ovh1, o√π je d√©ploie le site (la mise en place de ce d√©ploiement ce fait dans mon deuxi√®me POK).</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100 dark:border-red-800 dark:bg-red-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-red-500 dark:stroke-red-800 stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Attention</b></p></div><div class="pl-8 mr-8"><p>Ces informations, qu'on appelle √† juste titre des <strong>secrets</strong>, sont hautement confidentielles. Il ne faut surtout pas les mettre sur serveur qui peuvent √™tre compromis, c'est √† dire tous les serveurs qui ne vous appartiennent pas et qui ont acc√®s √† internet. Ainsi il ne faut pas stocker vos cl√©s ssh sur ovh1, ni sur github, au risque de vous la voir voler, et que quelqu'un ach√®te des armes avec votre carte bleu au march√© noir.</p></div></div><p>Jenkins est en local, si il est acc√©d√© par l'ext√©rieur c'est que quelqu'un √† d√©j√† le contr√¥le sur votre pc. Aussi, les secrets qui y sont stock√©s sont crypt√©s, on peut donc y mettre de fa√ßon s√ªre la cl√© ssh priv√©e qui va d√©ploy√© sur ovh1, ainsi que les variables d'environnement de votre application. Je recommande cependant de cr√©er une cl√© ssh uniquement pour Jenkins et de ne pas mettre la votre, si elle est compromise il suffira de bloquer les acc√®s √† cette unique cl√©.</p><p>Ne donnez pas non plus acc√®s √† ovh1 √† votre repository github!</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100 dark:border-cyan-800 dark:bg-cyan-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-cyan-500 dark:stroke-cyan-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Information</b></p></div><div class="pl-8 mr-8"><p>Ces secrets sont accessible depuis le Jenkinsfile gr√¢ce aux m√©thodes withcredentials() et on peut communiquer en ssh avec le ssh-agent, je vous invite √† lire la doc Jenkins, m√™me si elle est parfois lunaire.</p></div></div><ul><li>R√©sultats : <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bilgi-Tuncay/pok/images/jenkins-cred.png" alt="credentials"></li></ul><h4 id="le-jenkinsfile-%3A" tabindex="-1"><a class="header-anchor" href="#le-jenkinsfile-%3A"></a> Le jenkinsfile :</h4><p>Le <a href="https://github.com/TuncayBilgi/artblog/blob/main/Jenkinsfile">jenkinsfile</a> est le fichier dont va se servir Jenkins pour executer votre Pipeline, voir le MON Jenkins si jamais vous ne l'avez pas encore fait. Je ne d√©taille pas le code, il est disponible sur le repository de mon projet sur Github.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100 dark:border-red-800 dark:bg-red-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-red-500 dark:stroke-red-800 stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Attention</b></p></div><div class="pl-8 mr-8"><p>Jenkins est une machine √† gaz tr√®s capricieuse. Avec des milliers de plugins, et plus d'une dizaine ann√©e d‚Äôexistence, il existe des millions de mani√®res diff√©rentes de faire la m√™me chose, et quand vous en choisissez une, √ßa ne marche pas. √âvitez les interactions complexes entre Jenkins et d'autres site. Si vous voulez faire quelque chose qui existe utilisez ce qui existe d√©j√†, et sinon bon courage.</p></div></div><p>Ici, on choisit la m√©thode suivante :</p><ul><li>Toutes les heures le job de Jenkins d√©marre.</li><li>Jenkins poss√®de une liste qui contient les hash des commits de mon projet.</li><li>Il pull la derni√®re version du main du Github mon Projet.</li><li>Il regarde le hash du dernier commit sur main.</li><li>Si ce hash n'est pas dans la liste, cela veut dire que le projet n'est pas d√©ploy√©, il r√©alises doc plusieurs t√¢ches :<ul><li>Il lance 'npx jest' pour tester la derni√®re version du projet.</li><li>Si les tests passent, il d√©ploie le projet gr√¢ce √† mon script qui date du POK d'avant sur ovh1 en se connectant par ssh.</li><li>si le d√©ploiement c'est d√©roul√© sans encombre, il ajoute le hash du dernier commit dans sa liste.</li></ul></li><li>Si ce hash est d√©j√† dans la liste, Jenkins ne fait rien, il n'y a rien besoin de faire.</li></ul><p>On met en place tout √ßa et voici les r√©sultat :</p><div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr))"><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bilgi-Tuncay/pok/temps-3/jenkins-hour1.png" alt="page d'index" style="grid-column:1;grid-row:1"> <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bilgi-Tuncay/pok/temps-3/jenkins-hour2.png" alt="pipeline log" style="grid-column:2;grid-row:1"> <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bilgi-Tuncay/pok/temps-3/jenkins-hour3.png" alt="deploy list" style="grid-column:3;grid-row:1"></div><p>On peut voir, de gauche √† droite, que Jenkins rep√®re les diff√©rents commits, ensuite il execute la pipeline o√π il lance des tests et o√π il build et enfin, la pipeline est ex√©cut√©e p√©riodiquement.</p><h3 id="conclusions-sprint-2-%3A" tabindex="-1"><a class="header-anchor" href="#conclusions-sprint-2-%3A"></a> Conclusions sprint 2 :</h3><p>l‚Äôutilisation de jenkins n'est pas une chose ais√©e, et je vous √©pargne toutes les autres solutions que j'ai test√© avant d'arriver √† celle-ci qui est juste convenable. Cependant, une bonne partie de ceci serait plus simple si jenkins √©tait un serveur ayant acc√®s √† un r√©seau, comme √ßa devrait √™tre le cas normalement. J'ai pris le temps de r√©aliser l'essentiel de ce que je voulais, on pourrai aller plus loin en :</p><ul><li>Mettant en place une messagerie qui envoie un mail si la pipeline est cass√©e.</li><li>Mettant en place une seconde pipeline qui s'occupe seulement de verifier que le site est disponible sur internet et qui le red√©ploie sinon, sans build (c'est possible facilement gr√¢ce √† l'impl√©mentation de mon script).</li></ul><h2 id="conclusion-pok-1%2C2-et-3-%3A" tabindex="-1"><a class="header-anchor" href="#conclusion-pok-1%2C2-et-3-%3A"></a> Conclusion POK 1,2 et 3 :</h2><p>Ces trois POK m'ont permis de m'initier au d√©veloppement web. J'ai commenc√© l'ann√©e en tant que d√©butant ne connaissant que html,css et bootstrap. Aujourd'hui, je suis capable de coder un site (simple) de bout en bout, j'ai des notions d'architecture syst√®me, j'ai connaissances de certaines best practices et surtout j'ai d√©couvert le pan Dev-ops du d√©veloppement web.</p><p>Finalement, j'ai une site fonctionnel qui m'a permis de beaucoup apprendre, les efforts en valaient la peine et je suis satisfait du r√©sultat.</p></article></main><footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-center items-center"><p class="text-center">¬©2025 <b><span style="font-family:Consolas,sans-serif">Do-<span style="color:#4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT</p></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},document.addEventListener("DOMContentLoaded",(()=>{MathJax.typeset()}))</script><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0})</script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script></body></html>