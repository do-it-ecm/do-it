<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="index, follow"><link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2022-2023/Bermond-Timothee/pok/temps-2/"><meta name="description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta property="og:description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta name="twitter:description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta name="author" content="Timoth√©e Bermond"><meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, "><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png"><link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png"><link href="/assets/stylesheets/main.css" rel="stylesheet"><meta property="og:title" content="Serveur Distant"><meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2022-2023/Bermond-Timothee/pok/temps-2/"><meta property="og:type" content="website"><meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:title" content="Serveur Distant"><meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2022-2023/Bermond-Timothee/pok/temps-2/"><title>Serveur Distant</title><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet"><link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script defer="">const storedTheme=localStorage.getItem("theme");function loadPrismTheme(e){const t=e?"prism-okaidia.min.css":"prism-solarizedlight.min.css",s=document.createElement("link");s.rel="stylesheet",s.id="prism-theme",s.href=`https://cdn.jsdelivr.net/npm/prismjs/themes/${t}`,s.onload=()=>{Prism.highlightAll()};const m=document.getElementById("prism-theme");m?document.head.replaceChild(s,m):document.head.appendChild(s)}function setMermaidTheme(e){const t=e?"dark":"forest";mermaid.initialize({securityLevel:"loose",theme:t,startOnLoad:!0})}function toggleDarkMode(){const e=document.documentElement.classList.contains("dark"),t=e?"light":"dark";localStorage.setItem("theme",t),document.documentElement.classList.toggle("dark",!e),loadPrismTheme(!e),setMermaidTheme(!e)}storedTheme?document.documentElement.classList.toggle("dark","dark"===storedTheme):document.documentElement.classList.toggle("dark",window.matchMedia("(prefers-color-scheme: dark)").matches);const isDark=document.documentElement.classList.contains("dark");loadPrismTheme(isDark),setMermaidTheme(isDark)</script></head><body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50"><header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-between items-center"><a class="mx-2" href="/">Home</a> <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current"><circle cx="12" cy="12" r="5"></circle><path d="M12 2V4" stroke-linecap="round"></path><path d="M12 20V22" stroke-linecap="round"></path><path d="M4 12L2 12" stroke-linecap="round"></path><path d="M22 12L20 12" stroke-linecap="round"></path><path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path><path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path><path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path><path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path></svg> <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block"><path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="flex items-center gap-4 sm:gap-6"><a class="" href="/cs">CS</a> <a class="" href="/pok">POK</a> <a class="" href="/mon">MON</a> <a class="" href="/projets">Projets</a> <a class="hidden sm:block" href="/promos">Promos</a> <a href="/search"><svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg> </a><a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank"><svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div></header><main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body=""><article class="relative"><h1 class="mb-1">Serveur Distant</h1><div class="mb-4"><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Auteur :</div><ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs"><li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Timoth√©e Bermond</li></ul></div></div><p>Je vais cr√©er un site qui permet de compter les points au Yams. Il est disponible <a href="https://github.com/Timothee-Bermond/yams">ici</a></p><h2 id="liste-des-th%C3%A2ches" tabindex="-1"><a class="header-anchor" href="#liste-des-th%C3%A2ches"></a> Liste des th√¢ches</h2><ul><li>Cr√©ation du front</li><li>Suivi du cours de Mr. Brucker en MON2.1</li><li>Cr√©ation d'un compte sur evh</li><li>Cr√©ation du back avec node</li><li>G√©n√©ration de cookies</li><li>Cr√©ation BD</li><li>Lien back et front</li><li>Lien back et BD : routes + API</li></ul><h2 id="sprint-1" tabindex="-1"><a class="header-anchor" href="#sprint-1"></a> Sprint 1</h2><p>Durant le sprint 1 (25/11 - 7/12), je pr√©vois :</p><ul><li>Tout d'abord de cr√©er la partie front de mon site</li><li>D'avoir enti√®rement suivi le cours dispens√© en 2e ann√©e afin d'avoir les comp√©tences pour d√©ployer mon site sur un serveur distant.</li><li>D'aller voir Mr. Brucker pour me cr√©er un compte sur l'evh</li></ul><p>Durant ce print j'ai eu le temps de cr√©er toute ma partie front. <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bermond-Timothee/pok/temps-2/yams.jpg"> J'ai rencontr√© plusieurs difficult√©s : je voulais notamment ajouter un input avec une liste d√©roulante et une zone de texte. J'ai eu du mal √† trouver comment faire, la solution √©tait toute simple : utilis√© une datalist qui en plus peut-√™tre r√©utilisable pour plusieurs input. <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bermond-Timothee/pok/temps-2/datalist.jpg"> Une autre difficult√© a √©t√© la cr√©ation d'indication au survol d'une image. Je me suis pris la t√™te avec des <em>:hoover</em> alors qu'il suffisait d'utiliser la propri√©t√© title. <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Bermond-Timothee/pok/temps-2/indication.jpg"> J'ai √©galement tent√© d'impl√©menter une boucle for dans le fichier javascrpit afin de traiter les scores de tous les joueurs d'un seul coup ce qui m'aurait permis de cr√©er facilement d'autres joueurs. Mais cette m√©thode n'a pas fonctionn√© et je n'ai pas eu le temps de chercher une m√©thode alternative. Pour toute la partie CSS je me suis r√©f√©r√© √† mon <a href="../../../../mon/TB/Mes_MON/CSS">MON1.2</a>. Il y a juste la fonctionnalit√© <em>:before</em> que j'ai utilis√© afin d'ajouter un fond d'√©cran partiellement opaque.</p><p>J'ai ensuite suivi la <a href="https://francoisbrucker.github.io/cours_informatique/enseignements/ecm/2A/option-web/">formation</a> de Mr. Brucker, notamment le Projet Num√©rologie, afin de me former sur les serveurs web. Je n'ai pas eu le temps de tout parcourir mais je finirais √ßa d'ici la fin de la semaine.</p><p>Pour ce qui est du dernier point de ce sprint : la cr√©ation du compte sur l'evh, je m'y suis pris un peu tard et n'ai pas eu le temps de le faire.</p><p>J'ai √©galement pour id√©e d'ajouter une fonctionnalit√© qui permet de cr√©er des groupes, par exemple des gens avec qui vous jouez souvent, et lorsque vous vous connecterez les noms des joueurs seront entr√©s automatiquement et vous aurez acc√®s aux nombres de parties gagn√©es de chacun et potentiellement d'autres statistiques.</p><h2 id="sprint-2" tabindex="-1"><a class="header-anchor" href="#sprint-2"></a> Sprint 2</h2><p>Pour le sprint 2 je pr√©vois de :</p><ul><li>Cr√©er le back avec node</li><li>G√©n√©rer les cookies</li><li>Cr√©er la BD</li><li>Mettre en place le lien back et front</li><li>Ainsi que le lien back et BD : routes + API</li><li>Faire en sorte que 2 joueurs puissent remplir les scores en m√™me temps</li></ul><p>Durant ce 2√®me sprint, je me suis, tout d'abord, occup√© de mettre en place node et express.</p><p>Pour cela, j'ai r√©organis√© mes fichiers en cr√©ant un dossier <em>static</em>.</p><p>De plus, j'ai s√©par√© la partie cr√©ation de la partie et d√©roul√©e de la partie, car un de mes objectifs est de faire en sorte que 2 joueurs puissent remplir les scores en m√™me temps.</p><p>Puis j'ai initialiser le projet et install√© le package express.</p><p>J'ai ensuite cr√©√© le fichier <em>server.js</em> qui contiendra les routes et un dossier <em>back</em> pour les calculs.</p><p>J'arrive donc √† cette architecture :</p><p>__ back |__ calcul.js __ node_module __ static |__ Images |__ index.html |__ index.js |__ yams.css |__ yams.css |__ yams.html |__ yams.js __ package-lock.json __ package.json __ server.js</p><p>Puis j'ai mis en place ma base de donn√©es. Pour cela, j'ai utilis√© SQlite et sequelize.</p><p>Tout d'abord, je fais le lien avec la base de donn√©es SQlite:</p><pre class="language-javascript line-numbers"><code>

  const sequelize = new Sequelize({
    dialect: 'sqlite',
    storage: path.join(__dirname, 'db.sqlite')
  });


</code></pre><p>Puis je cr√©√© mon mod√®le :</p><pre class="language-javascript line-numbers"><code>

  const Partie = sequelize.define('Partie',{
    nombreJoueurs: {
        type: DataTypes.INTEGER,
        allowNull: false,
        defaultValue:1
    },
    nameJ1 : {
        type: DataTypes.STRING,
        allowNull: false,
        defaultValue:'Joueur 1'
    },
    nombre1J1: {
        type: DataTypes.INTEGER,
        allowNull: false,
        defaultValue:0
    },
    ...
    chanceJ4: {
        type: DataTypes.INTEGER,
        allowNull: false,
        defaultValue:0
    },
    totalJ4: {
        type: DataTypes.INTEGER,
        allowNull: false,
        defaultValue:0
    }
  })


</code></pre><p>Je n'ai affich√© qu'une partie car le mod√®le est tr√®s loin puisque je stock les points de tous les joueurs. Je me suis demand√© si il √©tait possible de cr√©er un mod√®le <em>player</em> puis de l'invoquer 4 fois dans mon mod√®le <em>partie</em> mais je n'ai pas trouv√© la r√©ponse.</p><p>Ensuite j'ai mis en place ma premi√®re route qui permet de cr√©er la partie. Lorsque l'utilisateur clique sur le bouton suivant, une nouvelle partie est cr√©√©e dans la base de donn√©es et les noms des joueurs sont r√©cup√©r√©s dans les <em>headers</em> de la requ√™te et enregistr√© dans la partie, puis un cookie est cr√©√© contenant l'id de la partie. J'ai cependant un probl√®me avec cela car des fois le cookie ne s'envoie pas et je reste donc bloqu√© dans la partie pr√©c√©dente.</p><p>index.js :</p><pre class="language-javascript line-numbers"><code>

  document.getElementById("bouton_suivant").addEventListener("click", () => {
    players = {
      nbrPlayers: nbr_players,
      player1: document.getElementById('text_choix1').value,
      player2: document.getElementById('text_choix2').value,
      player3: document.getElementById('text_choix3').value,
      player4: document.getElementById('text_choix4').value
    };
    fetch('/create',{
      method:'POST',
      headers:{
        'Content-Type': 'application/json',
        'Players':JSON.stringify(players)
      },
    })
    .then(
      window.location.replace('./yams.html')
      )
  })


</code></pre><p>server.js :</p><pre class="language-javascript line-numbers"><code>

  app.use("/create", (req, res) => {
  db.Partie.create({
    }).then((partie) => {
      parametres = req.rawHeaders.toString().split("{")[1].split("}")[0]
      partie.nombreJoueurs = parametres.split(",")[0].split(":")[1]
      partie.nameJ1 = parametres.split(",")[1].split(":")[1]
      partie.nameJ2 = parametres.split(",")[2].split(":")[1]
      partie.nameJ3 = parametres.split(",")[3].split(":")[1]
      partie.nameJ4 = parametres.split(",")[4].split(":")[1]
      res.cookie("id", partie.id)
      partie.save()
      res.end()
    })
  })


</code></pre><p>J'utilise une m√©thode un peu barbare pour r√©cup√©rer les noms des joueurs mais je n'ai pas trouv√© comment faire mieux.</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100 dark:border-yellow-800 dark:bg-yellow-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-yellow-500 dark:stroke-yellow-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Faire</b></p></div><div class="pl-8 mr-8"><p>Update : je suis all√© voir Mr. Brucker et il suffisait d'utiliser le middleware bodyParser afin de r√©cup√©rer les donn√©es dans le body de la requ√™te. Ce qui me donne donc :</p><p>index.js :</p><pre class="language-javascript line-numbers"><code>

  fetch('/create',{
      method:'POST',
      credentials: 'include',
      headers:{
        'Content-Type': 'application/json',
      },
      body:JSON.stringify(players)
    })


</code></pre><p>server.js :</p><pre class="language-javascript line-numbers"><code>

  partie.nombreJoueurs = req.body.nbrPlayers
  partie.nameJ1 = req.body.player1
  partie.nameJ2 = req.body.player2
  partie.nameJ3 = req.body.player3
  partie.nameJ4 = req.body.player4
  partie.save()


</code></pre></div></div><p>Une fois la partie cr√©√©e il faut que j'affiche le nom des joueurs ainsi que leur fiche de points.</p><p>J'ai tout d'abord voulu acc√©der √† la base de donn√©es depuis le fichier <em>yams.js</em> mais je n'ai pas r√©ussi donc j'ai impl√©ment√© une route <em>/initialisation</em> qui r√©cup√®re le nombre de joueurs ainsi que leur nom dans la base de donn√©es et qui les affiche.</p><p>yams.js :</p><pre class="language-javascript line-numbers"><code>

    fetch('/initialisation')
    .then(response => response.json())
    .then(data => {
        console.log(data)
        if(data.nombreJoueurs == 1){
            document.getElementById('nom_j1').textContent = data.nameJ1.split('"')[1]
            document.getElementById('joueur1').classList.remove('hide')
            document.getElementById('btn_new_game').classList.remove('hide')
        }
        else if(data.nombreJoueurs == 2){
            document.getElementById('nom_j1').textContent = data.nameJ1.split('"')[1]
            document.getElementById('joueur1').classList.remove('hide')
            document.getElementById('nom_j2').textContent = data.nameJ2.split('"')[1]
            document.getElementById('joueur2').classList.remove('hide')
            document.getElementById('btn_new_game').classList.remove('hide')
        }
        else if(data.nombreJoueurs == 3){
            document.getElementById('nom_j1').textContent = data.nameJ1.split('"')[1]
            document.getElementById('joueur1').classList.remove('hide')
            document.getElementById('nom_j2').textContent = data.nameJ2.split('"')[1]
            document.getElementById('joueur2').classList.remove('hide')
            document.getElementById('nom_j3').textContent = data.nameJ3.split('"')[1]
            document.getElementById('joueur3').classList.remove('hide')
            document.getElementById('btn_new_game').classList.remove('hide')
        }
        else if(data.nombreJoueurs == 4){
            document.getElementById('nom_j1').textContent = data.nameJ1.split('"')[1]
            document.getElementById('joueur1').classList.remove('hide')
            document.getElementById('nom_j2').textContent = data.nameJ2.split('"')[1]
            document.getElementById('joueur2').classList.remove('hide')
            document.getElementById('nom_j3').textContent = data.nameJ3.split('"')[1]
            document.getElementById('joueur3').classList.remove('hide')
            document.getElementById('nom_j4').textContent = data.nameJ4.split('"')[1]
            document.getElementById('joueur4').classList.remove('hide')
            document.getElementById('btn_new_game').classList.remove('hide')
        }   
    })


</code></pre><p>server.js:</p><pre class="language-javascript line-numbers"><code>

  app.use('/initialisation', (req, res) => {
    id = req.cookies.id
    console.log(id)
    db.Partie.findByPk(id)
    .then((data) => {
      res.json(data)
    })
  })


</code></pre><p>J'utilise le package cookie-parser afin de r√©cup√©rer les cookies, ce qui me permet d'obtenir l'id de la partie en cours.</p><p>J'ai ensuite cr√©√© la route qui permet d'enregistrer les valeurs des nouveaux scores du joueur 1.</p><p>Pour cela, j'utilise la fonction <em>onchange</em> et je r√©cup√®re les valeurs de toutes les combinaisons et je les stock dans un dictionnaire que j'envoie dans les <em>headers</em> de mon fetch.</p><p>Je r√©cup√®re ces donn√©es dans <em>server.js</em>, stock les donn√©es dans la bd puis √† l'aide de <em>calcul.js</em> je calcule la somme et le total des points que j'ajoute √©galement √† la bd.</p><p>J'ai tout d'abord eu des erreurs puisque les combinaisons vides me renvoyait &quot;&quot; et lorsque je calculais la somme j'obtenais donc une chaine de caract√®re. J'ai pour cela, modifi√© mon dictionnaire avec une boucle for afin afin de remplacer les valeurs vides par 0.</p><p>yams.js :</p><pre class="language-javascript line-numbers"><code>

for(const combi of list_total){
    document.getElementById(combi+'j1').onchange = function(){

        ...

        pts_J1 = {
            nombre1J1 : document.getElementById('nombre1j1').value,
            nombre2J1 : document.getElementById('nombre2j1').value,
            nombre3J1 : document.getElementById('nombre3j1').value,
            nombre4J1 : document.getElementById('nombre4j1').value,
            nombre5J1 : document.getElementById('nombre5j1').value,
            nombre6J1 : document.getElementById('nombre6j1').value,
            brelanJ1 : document.getElementById('brelanj1').value,
            carreJ1 : document.getElementById('carrej1').value,
            fullJ1 : pts_fullj1,
            psJ1 : pts_psj1,
            gsJ1 : pts_gsj1,
            yamsJ1 : pts_yamsj1,
            yams2J1 : pts_yams2j1,
            yams3J1 : pts_yams3j1,
            chanceJ1 : document.getElementById('chancej1').value,
        }

        for (const pts in pts_J1){
            if(pts_J1[pts] == ''){
                pts_J1[pts] = 0
            } else if(typeof(pts_J1[pts]) == 'string') {
                pts_J1[pts] = parseInt(pts_J1[pts])
            }
        }
        fetch('/changeJ1',{
                method:'POST',
                headers:{
                  'Content-Type': 'application/json',
                  'Players':JSON.stringify(pts_J1)
                },
            }).then(response => response.json())
            .then(data => {
                document.getElementById('pts_sommej1').textContent = data.sommeJ1
                document.getElementById('pts_totalj1').textContent = data.totalJ1
            })
    }
}


</code></pre><p>server.js:</p><pre class="language-javascript line-numbers"><code>

app.use('/changeJ1', (req, res) => {
  pts_J1 = req.rawHeaders.toString().split("{")[1].split("}")[0]
  id = req.cookies.id
  db.Partie.findByPk(id)
  .then((data) => {
    data.nombre1J1 = parseInt(pts_J1.split(",")[0].split(":")[1])
    data.nombre2J1 = parseInt(pts_J1.split(",")[1].split(":")[1])
    data.nombre3J1 = parseInt(pts_J1.split(",")[2].split(":")[1])
    data.nombre4J1 = parseInt(pts_J1.split(",")[3].split(":")[1])
    data.nombre5J1 = parseInt(pts_J1.split(",")[4].split(":")[1])
    data.nombre6J1 = parseInt(pts_J1.split(",")[5].split(":")[1])
    data.brelanJ1 = parseInt(pts_J1.split(",")[6].split(":")[1])
    data.carreJ1 = parseInt(pts_J1.split(",")[7].split(":")[1])
    data.fullJ1 = parseInt(pts_J1.split(",")[8].split(":")[1])
    data.psJ1 = parseInt(pts_J1.split(",")[9].split(":")[1])
    data.gsJ1 = parseInt(pts_J1.split(",")[10].split(":")[1])
    data.yamsJ1 = parseInt(pts_J1.split(",")[11].split(":")[1])
    data.yams2J1 = parseInt(pts_J1.split(",")[12].split(":")[1])
    data.yams3J1 = parseInt(pts_J1.split(",")[13].split(":")[1])
    data.chanceJ1 = parseInt(pts_J1.split(",")[14].split(":")[1])
    data.sommeJ1 = calcul.somme(data.nombre1J1, data.nombre2J1, data.nombre3J1, data.nombre4J1, data.nombre5J1, data.nombre6J1)
    data.totalJ1 = calcul.total(data.sommeJ1, data.brelanJ1, data. carreJ1, data.fullJ1, data.psJ1, data.gsJ1, data.yamsJ1, data.yams2J1, data.yams3J1, data.chanceJ1)
    data.save()
    res.json(data)
  })

})


</code></pre><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100 dark:border-yellow-800 dark:bg-yellow-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-yellow-500 dark:stroke-yellow-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Faire</b></p></div><div class="pl-8 mr-8"><p>Update : comme pour le nom des joueurs j'envoie les points des joueurs dans le <em>body</em> et non les <em>headers</em> de la requ√™te.</p></div></div><p>J'ai ensuite r√©it√©r√© cela pour les joueurs 2, 3 et 4.</p><p>J'ai toujours un probl√®me, c'est que mes cookies ne s'envoient pas toujours et je n'arrive pas √† comprendre ce qui en est la cause. Je suis all√© voir avec Mr. Brucker et ce serait un probl√®me avec les fonctions asynchrone (le cookie met trop de temps √† s'envoyer et le code passe donc √† la suite sans l'envoyer). J'ai essay√© d'ajouter un then mais √ßa n'a pas r√©gl√© mon probl√®me.</p><h3 id="d%C3%A9ploiement-sur-l'ovh" tabindex="-1"><a class="header-anchor" href="#d%C3%A9ploiement-sur-l'ovh"></a> D√©ploiement sur l'ovh</h3><p>Pour d√©ployer son site sur l'ovh il faut tout d'abord suivre ces <a href="https://francoisbrucker.github.io/cours_informatique/cours/ops/ssh/">instructions</a> pour g√©n√©rer sa paire de cl√© et acc√©der √† son compte sur l'ovh.</p><p>(Il y a peut-√™tre quelques petites coquilles qui vont se glisser dans l'explication donc si quelque chose ne marche demandez √† Mr. Brucker il saura vous r√©pondre)</p><p>Puis, il faut ouvrir le fichier readme.txt pour trouver quel est le port associ√© √† son compte.</p><pre class="language-bash line-numbers"><code>

cat readme.txt


</code></pre><p>Il faut modifier le port dans le fichier <em>server.js</em> afin qu'il corresponde √† celui du fichier readme.txt.</p><p>Ensuit on ajoute son code (que l'on a mis sur github) dans le dossier node avec la commande :</p><pre class="language-bash line-numbers"><code>

git clone https://github.com/Timothee-Bermond/yams.git 


</code></pre><p>Ensuite on se place dans le dossier contenant notre code (yams pour moi), et on entre la commande :</p><pre class="language-bash line-numbers"><code>

node server.js


</code></pre><p>On peut maintenant acc√©der √† notre site √† l'url : <a href="mailto:node.mon_herbe@ovh1.ec-m.fr">node.mon_herbe@ovh1.ec-m.fr</a> (en replacant mon_herbe par votre herbe).</p><p>Seul b√©mol lorsque l'on ferme le shell, le server s'arr√™te et on n'y a plus acc√®s. Pour qu'il tourne m√™me lorsque le shell est ferm√© il faut se placer dans le dossier contenant notre code et taper la commande :</p><pre class="language-bash line-numbers"><code>

/usr/bin/screen -d -m -S node node server.js


</code></pre><p>Et voil√†, le site est d√©ploy√© !</p></article></main><footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-center items-center"><p class="text-center">¬©2025 <b><span style="font-family:Consolas,sans-serif">Do-<span style="color:#4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT</p></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},document.addEventListener("DOMContentLoaded",(()=>{MathJax.typeset()}))</script><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0})</script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script></body></html>