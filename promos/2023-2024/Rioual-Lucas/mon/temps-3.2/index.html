<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="index, follow"><link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2023-2024/Rioual-Lucas/mon/temps-3.2/"><meta name="description" content="Test"><meta property="og:description" content="Test"><meta name="twitter:description" content="Test"><meta name="author" content="Lucas Rioual"><meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, MON, javascript, jest, Express"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon"><link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png"><link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png"><link href="/assets/stylesheets/main.css" rel="stylesheet"><meta property="og:title" content="Test avec Jest"><meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2023-2024/Rioual-Lucas/mon/temps-3.2/"><meta property="og:type" content="website"><meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:title" content="Test avec Jest"><meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png"><meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2023-2024/Rioual-Lucas/mon/temps-3.2/"><title>Test avec Jest</title><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet"><link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script defer="">const storedTheme=localStorage.getItem("theme");function loadPrismTheme(e){const t=e?"prism-okaidia.min.css":"prism-solarizedlight.min.css",s=document.createElement("link");s.rel="stylesheet",s.id="prism-theme",s.href=`https://cdn.jsdelivr.net/npm/prismjs/themes/${t}`,s.onload=()=>{Prism.highlightAll()};const m=document.getElementById("prism-theme");m?document.head.replaceChild(s,m):document.head.appendChild(s)}function setMermaidTheme(e){const t=e?"dark":"forest";mermaid.initialize({securityLevel:"loose",theme:t,startOnLoad:!0})}function toggleDarkMode(){const e=document.documentElement.classList.contains("dark"),t=e?"light":"dark";localStorage.setItem("theme",t),document.documentElement.classList.toggle("dark",!e),loadPrismTheme(!e),setMermaidTheme(!e)}storedTheme?document.documentElement.classList.toggle("dark","dark"===storedTheme):document.documentElement.classList.toggle("dark",window.matchMedia("(prefers-color-scheme: dark)").matches);const isDark=document.documentElement.classList.contains("dark");loadPrismTheme(isDark),setMermaidTheme(isDark)</script></head><body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50"><header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-between items-center"><a class="mx-2" href="/">Home</a> <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current"><circle cx="12" cy="12" r="5"></circle><path d="M12 2V4" stroke-linecap="round"></path><path d="M12 20V22" stroke-linecap="round"></path><path d="M4 12L2 12" stroke-linecap="round"></path><path d="M22 12L20 12" stroke-linecap="round"></path><path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path><path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path><path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path><path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path></svg> <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block"><path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="flex items-center gap-4 sm:gap-6"><a class="" href="/cs">CS</a> <a class="" href="/pok">POK</a> <a class="" href="/mon">MON</a> <a class="" href="/projets">Projets</a> <a class="hidden sm:block" href="/promos">Promos</a> <a href="/search"><svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg> </a><a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank"><svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></div></header><main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body=""><article class="relative"><h1 class="mb-1">Test avec Jest</h1><div class="mb-4"><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Tags :</div><ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags"><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">MON</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">javascript</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">jest</li><li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">Express</li></ul><div class="hidden" data-pagefind-meta="Type" aria-hidden="true"><span data-pagefind-filter="Type">MON</span></div></div><div class="px-4 flex flex-wrap items-center"><div class="font-bold">Auteur :</div><ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs"><li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Lucas Rioual</li></ul></div><div class="absolute top-0 right-0"><span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">2023-2024</span></div></div><p class="mb-4 text-lg">Test</p><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path></svg><div class="pl-8 mr-8"><a href="/promos/2023-2024/Rioual-Lucas/">Lucas RIOUAL</a><span class="px-1">/</span><a href="/promos/2023-2024/Rioual-Lucas/mon/">MON de Lucas Rioual</a><span class="px-1">/</span><a href="/promos/2023-2024/Rioual-Lucas/mon/temps-3.2/">Test avec Jest</a></div></div><div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100 dark:border-pink-800 dark:bg-pink-950"><svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-pink-500 dark:stroke-pink-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg><div class="pl-8 mb-2 mr-8"><p><b>Pr√©requis</b></p></div><div class="pl-8 mr-8"><p><strong>Javascript</strong></p></div></div><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"></a> Introduction</h2><p>L‚Äôobjectif de ce MON est de me former sur les tests javascript. Je souhaite me concentrer sur cette th√©matique car c‚Äôest quelque chose qui est primordial pour faire du code professionnel.</p><p>Je vais m‚Äôattarder sur la bibloth√®que Jest qui permet de tester du code Javascript. Je vais utiliser le backend du projet Killer pour m‚Äôentrainer.</p><h2 id="tester-du-code-javascript" tabindex="-1"><a class="header-anchor" href="#tester-du-code-javascript"></a> Tester du code Javascript</h2><p>Je voulais savoir comment tester l‚ÄôAPI du projet Killer car pour l‚Äôinstant, pour tester les diff√©rentes fonctionnalit√©s, j‚Äôutilise l‚Äôinterface de l‚Äôapplication. C‚Äôest long √† tester une fonctionnalit√© mais surtout, il est difficile de tester une seule fonctionnalit√© √† la fois. L‚Äôobjectif est donc de pouvoir tester les diff√©rentes routes de l‚ÄôAPI et s‚Äôassurer que le r√©sultat renvoy√© est bien celui attendu.</p><p>J‚Äôai utilis√© ces deux tuto :</p><ul><li><a href="https://saniaalikhan224.medium.com/mastering-api-testing-with-jest-node-js-express-and-mongodb-a-step-by-step-guide-bcd5f72e0d26">https://saniaalikhan224.medium.com/mastering-api-testing-with-jest-node-js-express-and-mongodb-a-step-by-step-guide-bcd5f72e0d26</a></li><li><a href="https://www.freecodecamp.org/news/how-to-test-in-express-and-mongoose-apps/">https://www.freecodecamp.org/news/how-to-test-in-express-and-mongoose-apps/</a></li></ul><p>Cela permet de tester une application Express qui communique avec une base de donn√©e Mongo DB.</p><p>Voici comment installer les d√©pendances n√©cessaire :</p><pre class="language-bash line-numbers"><code>

npm install --save-dev jest supertest
npm install mongoose


</code></pre><ul><li>Jest : tester du code Javascript</li><li>Supertest : permet de tester des routes et des endpoints</li><li>Mongoose : communiquer avec la base de donn√©e</li></ul><p>Ensuite, le but est de tester mon application sans tout casser. En effet, les tests permettront d‚Äôint√©ragir avec la base de donn√©e. Cependant, lorsqu‚Äôon effectue des tests, il ne faut pas modifier la vrai base de donn√©e qui est utilis√© par l‚Äôapplication en production. Pour cela, on cr√©e un ficher .env qui stocke des variables d‚Äôenvironnement :</p><pre class="language-bash line-numbers"><code>

MONGODB_URI='url'
MONGODB_URI_TEST='url de test'


</code></pre><p>Comme √ßa on peut choisir quel url choisir n‚Äôimporte o√π dans l‚Äôapplication</p><p>Ensuite on rajoute un script dans package.json :</p><pre class="language-bash line-numbers"><code>

"scripts": {
    "test": "jest"
  },


</code></pre><h3 id="tester-une-route" tabindex="-1"><a class="header-anchor" href="#tester-une-route"></a> Tester une route</h3><p>Maintenant, je souhaite tester la route <strong>POST</strong> <code>/api/user/testUser</code> qui permet d‚Äôajouter un nouvel utilisateur dans la base de donn√©e avec le nom ‚ÄòtestUser‚Äô.</p><p>Voici le code que j‚Äôai qui permet de tester cette route :</p><pre class="language-jsx line-numbers"><code>


describe("User API", () => {
  beforeAll(async () => {
    await mongoose.connect(process.env.MONGODB_URI_TEST);
  });

  afterAll(async () => {
    await mongoose.connection.close();
  });

  beforeEach(async () => {
    await User.deleteMany({})
    await Game.deleteMany({});
  });
  describe("POST /user", () => {
    it("doit cr√©er un nouvel utilisateur", async () => {
      const response = await request(app)
        .post("/api/user/testUser")
        .send({ expoToken: "testToken" });
      expect(response.statusCode).toBe(200);
      expect(response.body).toHaveProperty("success", true);
      expect(response.body).toHaveProperty("userId");
    });
  });
});



</code></pre><p>Le code commence par d√©finir une suite de tests avec <strong><code>describe(&quot;User API&quot;, () =&gt; { ... })</code></strong>. Cette suite de tests contient plusieurs hooks et blocs de tests.</p><ul><li>Le premier hook est <strong><code>beforeAll(async () =&gt; { ... })</code></strong>, qui est ex√©cut√© une seule fois avant tous les tests de la suite. Dans ce hook, la connexion √† la base de donn√©es de test est √©tablie en utilisant <strong><code>mongoose.connect(process.env.MONGODB_URI_TEST)</code></strong>.</li><li>Le deuxi√®me hook est <strong><code>afterAll(async () =&gt; { ... })</code></strong>, qui est ex√©cut√© une seule fois apr√®s tous les tests de la suite. Dans ce hook, la connexion √† la base de donn√©es est ferm√©e en utilisant <strong><code>mongoose.connection.close()</code></strong>.</li><li>Le troisi√®me hook est <strong><code>beforeEach(async () =&gt; { ... })</code></strong>, qui est ex√©cut√© avant chaque test de la suite. Dans ce hook, toutes les collections <strong><code>User</code></strong> et <strong><code>Game</code></strong> sont supprim√©es √† l'aide de <strong><code>User.deleteMany({})</code></strong> et <strong><code>Game.deleteMany({})</code></strong>, respectivement.</li><li>Ensuite, il y a un bloc de tests imbriqu√© pour tester la cr√©ation d'un nouvel utilisateur en utilisant la m√©thode HTTP POST sur l'URL <strong><code>/api/user/testUser</code></strong>. Dans ce test, une requ√™te HTTP est envoy√©e √† l'application Node.js √† l'aide de <strong><code>request(app).post(&quot;/api/user/testUser&quot;).send({ expoToken: &quot;testToken&quot; })</code></strong>. La r√©ponse HTTP est ensuite v√©rifi√©e pour s'assurer que le code d'√©tat est 200, que la propri√©t√© <strong><code>success</code></strong> est d√©finie sur <strong><code>true</code></strong> et que la propri√©t√© <strong><code>userId</code></strong> existe dans le corps de la r√©ponse.</li></ul><p>Maintenant si on fait <code>npm run test</code> on a ce resultat :</p><pre class="language-bash line-numbers"><code>

PS D:\Programmation\Ecm\Killer-back> npm run test

> killer-back@1.0.0 test
> jest

 PASS  test/user.test.js
  User API
    POST /user
      ‚àö doit cr√©er un nouvel utilisateur (280 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        1.952 s, estimated 8 s
Ran all test suites.


</code></pre><h3 id="tester-la-modification-d%E2%80%99un-utilisateur" tabindex="-1"><a class="header-anchor" href="#tester-la-modification-d%E2%80%99un-utilisateur"></a> Tester la modification d‚Äôun utilisateur</h3><p>Ensuite, je souhaite tester la route PUT <code>/api/user/</code>{userId} qui permet de modifier le surnom d‚Äôun utilisateur. Le probl√®me, c‚Äôest qu‚Äôau d√©but des tests, ma base de donn√©e est vide. J‚Äôai donc cr√©e 3 utilisateurs de test que j‚Äô√©vite de supprimer √† la fin des test :</p><pre class="language-jsx line-numbers"><code>


const user1Id = "65fd4cbe4352edb5a9722609";
const user2Id = "65fd4cdb034e02d9b0920de8";
const user3Id = "65fd511875033da71380cc99";

describe("User API", () => {
  beforeAll(async () => {
    await mongoose.connect(process.env.MONGODB_URI_TEST);
  });

  afterAll(async () => {
    await mongoose.connection.close();
  });

  beforeEach(async () => {
    await User.deleteMany({
      _id: {
        $nin: [
          user1Id,
          user2Id,
          user3Id,

        ],
      },
    })
    await Game.deleteMany({});

  });

  describe("POST /user", () => {
    it("doit cr√©er un nouvel utilisateur", async () => {
      const response = await request(app)
        .post("/api/user/testUser")
        .send({ expoToken: "testToken" });
      expect(response.statusCode).toBe(200);
      expect(response.body).toHaveProperty("success", true);
      expect(response.body).toHaveProperty("userId");
    });
    it("modifier le surnom de l'utilisateur", async () => {
      const response = await request(app)
        .put(`/api/user/${user1Id}`)
        .send({ expoToken: "testToken", userName: "Tom" });
      expect(response.statusCode).toBe(200);
      expect(response.body).toHaveProperty("success", true);
      expect(response.body).toHaveProperty("userId");
    });
    it("modifie le surnom de l'utilisateur mais l'id n'existe pas dans la base de donn√©e", async () => {
      const response = await request(app)
        .put("/api/user/65f58e6326c2f024807a6376")
        .send({ expoToken: "testToken", userName: "Tom" });
      expect(response.statusCode).toBe(200);
      expect(response.body).toHaveProperty("success", true);
      expect(response.body).toHaveProperty("userId");
    });
  });
});


</code></pre><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"></a> Conclusion</h2><p>Il y a pleins d‚Äôautres routes √† tester pour s‚Äôassurer que l‚Äôapplication fonctionne bien. Cependant je n‚Äôai pas eu le temps de toutes les tester. J‚Äôai mis pas mal de temps √† faire fonctionner le premier test car j‚Äôavais des soucis pour me connecter √† la base de donn√©e. Je n‚Äôai pas eu le temps de passer les 10h sur ce MON. J‚Äôai pass√© environ 6h sur la documentation et les exemples que j‚Äôai pr√©sent√©.</p></article></main><footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700"><div class="max-w-[1000px] mx-auto px-4"><div class="min-h-[50px] flex justify-center items-center"><p class="text-center">¬©2025 <b><span style="font-family:Consolas,sans-serif">Do-<span style="color:#4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT</p></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},document.addEventListener("DOMContentLoaded",(()=>{MathJax.typeset()}))</script><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0})</script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script></body></html>