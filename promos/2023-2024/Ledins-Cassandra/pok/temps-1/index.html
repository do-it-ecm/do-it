<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="robots" content="index, follow">

        <link rel="canonical" href="https://do-it.aioli.ec-m.fr/promos/2023-2024/Ledins-Cassandra/pok/temps-1/">

        
        

        <meta name="description" content="Un site internet pour interagir avec un animal virtuel.">
        <meta property="og:description" content="Un site internet pour interagir avec un animal virtuel.">
        <meta name="twitter:description" content="Un site internet pour interagir avec un animal virtuel.">

        
            <meta name="author" content="Cassandra Ledins">
        
        <meta name="keywords" content="do-it, centrale, centrale m√©diterran√©e, ecm, POK">

        <link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/favicon.ico" type="image/x-icon">
        <link rel="icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png" type="image/png">
        <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/minimal.png">

        <link href="/assets/stylesheets/main.css" rel="stylesheet">

        <meta property="og:title" content="ChatClique">

        <meta property="og:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png">
        <meta property="og:url" content="https://do-it.aioli.ec-m.fr/promos/2023-2024/Ledins-Cassandra/pok/temps-1/">
        <meta property="og:type" content="website">

        <meta name="twitter:card" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png">
        <meta name="twitter:title" content="ChatClique">
        <meta name="twitter:image" content="https://raw.githubusercontent.com/do-it-ecm/do-it/main/src/assets/img/logo/intermediate-text.png">
        <meta name="twitter:url" content="https://do-it.aioli.ec-m.fr/promos/2023-2024/Ledins-Cassandra/pok/temps-1/">

        <title>ChatClique</title>

        <!-- Prismjs imports
                - Prism line numbers
                - Prism toolbar
        -->
        <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">
        <link id="prism-theme" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <!-- Mermaid import and initialization -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js "></script>

        <script defer="">
        // Check if a theme is stored in localStorage. If so, use it, otherwise fallback to the system preference.
        const storedTheme = localStorage.getItem('theme');
        if (storedTheme) {
            document.documentElement.classList.toggle("dark", storedTheme === "dark");
        } else {
            // Use system color scheme if there is no stored theme preference.
            document.documentElement.classList.toggle("dark", window.matchMedia("(prefers-color-scheme: dark)").matches);
        }

        function loadPrismTheme(isDarkMode) {
            const newTheme = isDarkMode ? 'prism-okaidia.min.css' : 'prism-solarizedlight.min.css';
            const newLink = document.createElement('link');
            newLink.rel = 'stylesheet';
            newLink.id = 'prism-theme';
            newLink.href = `https://cdn.jsdelivr.net/npm/prismjs/themes/${newTheme}`;

            newLink.onload = () => {
                // Reapply highlighting after the new theme loads
                Prism.highlightAll();
            };

            const existingLink = document.getElementById('prism-theme');
            if (existingLink) {
                document.head.replaceChild(newLink, existingLink);
            } else {
                document.head.appendChild(newLink);
            }
        }

        function setMermaidTheme(isDarkMode) {
            const theme = isDarkMode ? 'dark' : 'forest';
            mermaid.initialize({
                securityLevel: 'loose',
                theme,
                startOnLoad: true,
            });
        }

        // Toggle dark and light mode and update localStorage accordingly.
        function toggleDarkMode() {
            const dark = document.documentElement.classList.contains("dark");
            const newTheme = dark ? "light" : "dark";
            localStorage.setItem('theme', newTheme);
            document.documentElement.classList.toggle("dark", !dark);
            loadPrismTheme(!dark);
            setMermaidTheme(!dark);
        }

        // On initial load, ensure that Prism and Mermaid are initialized using the current theme.
        const isDark = document.documentElement.classList.contains("dark");
        loadPrismTheme(isDark);
        setMermaidTheme(isDark);
        </script>

    </head>

    <body data-prismjs-copy="üìã" data-prismjs-copy-error="‚ùå" data-prismjs-copy-success="‚úÖ" data-prismjs-copy-timeout="1000" class="bg-neutral-50 text-neutral-950 dark:bg-neutral-900 dark:text-neutral-50">
        <header class="fixed top-0 z-50 w-full border-b-2 border-gray-200 bg-white dark:bg-neutral-900 dark:border-neutral-700">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-between items-center">
                    <a class="mx-2" href="/">Home</a>
                    <button class="hidden sm:block text-neutral-950 dark:text-neutral-50 hover:bg-neutral-700 hover:text-neutral-50 hover:dark:bg-neutral-300 hover:dark:text-neutral-950 transition-colors p-2 rounded-full duration-800 ease-in-out" onclick="toggleDarkMode()">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 dark:hidden stroke-current">
                            <circle cx="12" cy="12" r="5"></circle>
                            <path d="M12 2V4" stroke-linecap="round"></path>
                            <path d="M12 20V22" stroke-linecap="round"></path>
                            <path d="M4 12L2 12" stroke-linecap="round"></path>
                            <path d="M22 12L20 12" stroke-linecap="round"></path>
                            <path d="M19.7778 4.22266L17.5558 6.25424" stroke-linecap="round"></path>
                            <path d="M4.22217 4.22266L6.44418 6.25424" stroke-linecap="round"></path>
                            <path d="M6.44434 17.5557L4.22211 19.7779" stroke-linecap="round"></path>
                            <path d="M19.7778 19.7773L17.5558 17.5551" stroke-linecap="round"></path>
                        </svg>
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-5 aspect-square fill-none aspect-square stroke-2 stroke-current hidden dark:block">
                            <path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                    <div class="flex items-center gap-4 sm:gap-6 ">
                        <a class="" href="/cs">CS</a>
                        <a class="" href="/pok">POK</a>
                        <a class="" href="/mon">MON</a>
                        <a class="" href="/projets">Projets</a>
                        <a class="hidden sm:block" href="/promos">Promos</a>
                        <a href="/search">
                            <svg class="h-5 aspect-square stroke-neutral-950 dark:stroke-neutral-300 fill-none stroke-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                            </svg>
                        </a>
                        <a class="hidden sm:block" href="https://github.com/do-it-ecm/do-it" target="_blank">
                            <svg class="h-5 aspect-square dark:stroke-neutral-300 dark:fill-neutral-300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <main class="mt-[66px] max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">ChatClique</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Tag : </div>
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Tags">POK</li>
                

            </ul>

            
            <div class="hidden" data-pagefind-meta="Type" aria-hidden="true">
                
                    
                        <span data-pagefind-filter="Type">POK</span>
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteur : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2 text-neutral-950" data-pagefind-filter="Auteurs">Cassandra Ledins</li>
                
            </ul>
        </div>
    

    
        <div class="absolute top-0 right-0">
            <span class="bg-purple-200 rounded-full px-3 py-1 mt-2 mr-2 text-neutral-950" data-pagefind-filter="Ann√©e">
                2023-2024
            </span>
        </div>
    
</div>

<p class="mb-4 text-lg">Un site internet pour interagir avec un animal virtuel.</p>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100 dark:border-purple-800 dark:bg-purple-950">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 fill-none stroke-2 stroke-purple-500 dark:stroke-purple-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/promos/2023-2024/Ledins-Cassandra/">Cassandra Ledins</a><span class="px-1">/</span><a href="/promos/2023-2024/Ledins-Cassandra/pok/">POK de Cassandra Ledins</a><span class="px-1">/</span><a href="/promos/2023-2024/Ledins-Cassandra/pok/temps-1/">ChatClique</a>

</div>
</div>




<p><strong>Tout dans ce POK a √©t√© r√©alis√© en HTML, JavaScript, CSS, Python, √† la main.</strong></p>
<h2 id="point-sprint-1" tabindex="-1"><a class="header-anchor" href="#point-sprint-1"></a> Point Sprint 1</h2>
<h3 id="ce-que-je-voulais-faire" tabindex="-1"><a class="header-anchor" href="#ce-que-je-voulais-faire"></a> Ce que je voulais faire</h3>
<p>Je n'avais pas bien compris qu'il fallait d√©couper les objectifs du POK en deux sprints, donc je n'avais pas en t√™te un objectif pour le sprint 1. Je savais en tout cas que j'allais d√©marrer par :</p>
<ul>
<li>mettre en place une API Flask</li>
<li>mettre en place une page de login</li>
<li>commencer le front pour la main page du jeu</li>
</ul>
<h3 id="ce-que-j'ai-fait" tabindex="-1"><a class="header-anchor" href="#ce-que-j'ai-fait"></a> Ce que j'ai fait</h3>
<p>La page de login du site est pr√™te et fonctionelle. Les appels sont fait √† une API faite avec Flask sur Python. J'avais dans l'id√©e d'int√©grer un syst√®me de chat avec son animal (int√©grer l'API ChatGPT). L'int√©gration de l'API √† l'air simple mais je ne me rends pas compte du temps de mise en place des prompts.</p>
<p>Donc pour l'instant on peut <strong>cr√©er un compte et se connecter</strong>.</p>
<p>En tout cas la partie graphique ne va pas m'int√©resser sur ce POK. J'ai g√©n√©r√© des images sur des sites de g√©n√©ration gratuite. La partie s√©curit√© non-plus, pour l'instant je stocke les donn√©es utilisateurs en clair.</p>
<p>Je pense impl√©menter quelques actions simples (cliquer sur un bouton pour nourrir/jouer). Stocker les donn√©es utilisateurs dans une petite base de donn√©es.</p>
<p>Puis ensuite impl√©menter le chatbot, du mieux que je peux.</p>
<p>Je n'ai pas pass√© 10h sur ce premier sprint, et je n'ai donc pas eu le temps d'avancer sur la main page.</p>
<img src="https://raw.githubusercontent.com/do-it-ecm/promo-2023-2024/refs/heads/main//Ledins-Cassandra/pok/temps-1/login.png">
<h2 id="sprint-2" tabindex="-1"><a class="header-anchor" href="#sprint-2"></a> Sprint 2</h2>
<h3 id="main-page" tabindex="-1"><a class="header-anchor" href="#main-page"></a> Main page</h3>
<p>Les prochains objectifs √©taient donc de construire la main page. J'ai commenc√© par √©tablir un lien de redirection, puis juste mettre une image d'un chat.</p>
<h3 id="fonction-de-discussion" tabindex="-1"><a class="header-anchor" href="#fonction-de-discussion"></a> Fonction de discussion</h3>
<p>J'ai essay√© de cr√©er un appel √† l'API de ChatGPT mais j'ai mis un peu de temps car j'ai l'impression que leur documentation n'est pas √† jour. J'ai d√ª d√©bugger pendant un moment avant de comprendre comment le faire marcher.</p>
<p>Maintenant que la premi√®re √©tape est r√©ussie, on veut que la page main puisse appeler √† mon API Flask, qui elle va appeler l'API ChatGPT. Et le r√©sultat sera retourn√© et montr√© en direct sur la page du jeu. Pour cela, on va cr√©er un champ d'input avec un bouton submit pour que l'utilisateur puisse entrer son message, avec un code javascript pour appeler mon API ensuite.</p>
<p>Voil√† √† quoi ressemble le <strong>prompt</strong> dans mon API Flask:</p>
<pre class="line-numbers"><code>

@app.route("/gpt-response", methods=['GET'])
def gptresponse():
    prompt = request.args.get('text')
    user = request.args.get('user')
    mood = mydatabase["cat_status"][mydatabase["user"].index(user)]
    if mood<3:
        mood='very angry'
    elif mood<6:
        mood="bored"
    elif mood<8:
        mood="satisfied"
    else:
        mood="very happy and playful"

    data = {
        "model": "gpt-3.5-turbo",
        "messages": [
            {
                "role": "system",
                "content": "we roleplay. you talk like a cat in short sentences. you are here to express your cat needs. right now you are "+mood
            },
            {
                "role": "user",
                "content": prompt
            }
            ],
        "max_tokens": 200,
        "n": 1,
        "stop": None,
        "temperature": 1
    }
    response = requests.post(url, headers=headers, data=json.dumps(data))
    response = response.json()
    print(response)
    return response['choices'][0]['message']


</code></pre><p>La temp√©rature, c'est le degr√© de cr√©ativit√© autoris√©. Entre 0 et 1, ici je l'ai mis √† 1 pour avoir des r√©ponses originales !
Un nombre max de token (longueur de r√©ponse), pour √©viter qu'il nous √©crive un roman et pour pas br√ªler tous mes cr√©dits d'un coup.</p>
<p>Pour l'instant, je ne cr√©√© pas de &quot;m√©moire&quot; au chat, c'est-√†-dire qu'apr√®s vous avoir r√©pondu, si vous renvoyez un message, il ne saura pas de quoi vous avez parl√© avant.</p>
<p>J'ai ajout√© un effet de display lettre par lettre, comme on peut retrouver dans l'API ChatGPT. Sauf que j'ai trich√©, je l'ai fait avec un random timeout() en JavaScript. Je voulais le faire en live avec l'option stream=True qu'on peut ajouter au prompt de ChatGPT pour r√©cup√©rer les infos de g√©n√©ration en direct, mais apr√®s quelques essais infructueux, parce que les exemples de la documentation ne marchaient pas pour moi, j'ai d√©cid√© de le faire √† la main.</p>
<h3 id="fonction-nourrir-et-caresser" tabindex="-1"><a class="header-anchor" href="#fonction-nourrir-et-caresser"></a> Fonction nourrir et caresser</h3>
<p>J'ai ajout√© deux boutons pour nourrir et caresser le chat. Les boutons font plusieurs choses quand on les clique (d√©j√† ils ont une animation en css javascript vraiment styl√©e, que j'ai all√®grement emprunt√© √† <a href="https://webdeasy.de/en/top-css-buttons-en/?utm_content=cmp-true">Nour Saud</a>).</p>
<p>Ils font aussi appara√Ætre un gif sur le chat, repr√©sentant l'action. Ils envoient aussi des donn√©es √† l'API qui met √† jour la base de donn√©es.</p>
<p>L'API met √† jour la base de donn√©es avec le nombre de fois que l'utilisateur a effectu√© les actions, l'humeur du chat, et une monnaie. J'aurais voulu ajouter des accesoires √† d√©bloquer avec la monnaie, les gifs sont d'ailleurs tous pr√™t, mais je n'ai pas eu le temps de l'impl√©menter.</p>
<p>On reconnait l'utilisateur gr√¢ce √† un cookie cr√©√© ou modifi√© sur la page de connexion.</p>
<img src="https://raw.githubusercontent.com/do-it-ecm/promo-2023-2024/refs/heads/main//Ledins-Cassandra/pok/temps-1/main.png">
<p>On voit ici que l'humeur est affich√©e √† gauche, sur 10 (donc l√† il est tr√®s content). Je lui ai racont√© une blague et il m'a r√©pondu qu'il avait rit. On voit aussi les boutons caresser et nourrir. On est pas sur un design de niveau GAFA encore. Mais l'utilisation est simple en tout cas.</p>
<h3 id="la-structure" tabindex="-1"><a class="header-anchor" href="#la-structure"></a> La structure</h3>
<p>On a donc 3 fichiers, l'<a href="http://app.py">app.py</a>, le template login.html et le template main.html (en plus des diff√©rentes images et font utilis√©es, toutes regroup√©es dans un fichier image).</p>
<img src="https://raw.githubusercontent.com/do-it-ecm/promo-2023-2024/refs/heads/main//Ledins-Cassandra/pok/temps-1/structure.png">
<p>Je n'ai pas fait de template css par mauvaise habitude de toujours tout mettre au m√™me endroit, apr√®s avoir eu des probl√®mes dans certains serveurs...</p>
<h2 id="le-code" tabindex="-1"><a class="header-anchor" href="#le-code"></a> Le code</h2>
<p>Tout le monde l'attend, et il est l√†. Disclaimer, les d√©veloppeurs parmi vous vont faire des crises cardiaques √† la vue de mon code. Mais a priori tout fonctionne correctement.</p>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block group-open:select-text">
<p><a href="http://app.py">app.py</a></p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2 cursor-auto select-text">
<pre class="language-python line-numbers"><code>

import flask
from flask import Flask, jsonify, after_this_request, abort, make_response
from flask import render_template, request, send_file
import re
import os
import sys
import pickle
from sqlitedict import SqliteDict
from flask_cors import CORS
from flask import Response
import traceback
import openai
import requests
import json

app = Flask(__name__)
CORS(app)

openai.api_key =                                          #ALLEZ CHERCHER VOTRE PROPRE CLE API DANS LES PARAMETRES DE VOTRE COMPTE OPEN AI!!
url = "https://api.openai.com/v1/chat/completions"
headers = {
    "Authorization": "Bearer " + openai.api_key,
    "Content-Type": "application/json"
}

mydatabase = SqliteDict("mydatabase.sqlite")

@app.route("/")
def init():
    return render_template("login.html")

@app.route("/getimage/<name>")
def getimage(name):
    return send_file("images/"+name)

@app.route("/login/<username>-<password>")
def login(username, password):
    value =(username[1:],password[1:])
    print(value)
    success = False
    user_info=mydatabase.get(username[1:])
    if user_info!=None:
        if password[1:]==user_info["password"]:
            success=True
    response = {"success" : success}
    print(response)
    return jsonify(response), {'Content-Type': 'application/json'}

@app.route("/signup/<username>-<password>")
def signup(username, password):
    value =(username[1:],password[1:])
    print(value)
    success = False
    if mydatabase.get(username[1:])==None:
        success = True
        mydatabase[username[1:]]={"password":password[1:], "cat_status":0, "money":0, "feed":0, "pet":0}
        mydatabase.commit()
    response = {"success" : success}
    print(response)
    return jsonify(response), {'Content-Type': 'application/json'}

@app.route("/gpt-response", methods=['GET'])
def gptresponse():
    prompt = request.args.get('text')
    user = request.args.get('user')
    mood = mydatabase[user]["cat_status"]
    if mood<3:
        mood='very angry'
    elif mood<6:
        mood="bored"
    elif mood<8:
        mood="satisfied"
    else:
        mood="very happy and playful"

    data = {
        "model": "gpt-3.5-turbo",
        "messages": [
            {
                "role": "system",
                "content": "we roleplay. you talk like a cat in short sentences. you are here to express your cat needs. right now you are "+mood
            },
            {
                "role": "user",
                "content": prompt
            }
            ],
        "max_tokens": 200,
        "n": 1,
        "stop": None,
        "temperature": 1
    }
    response = requests.post(url, headers=headers, data=json.dumps(data))
    response = response.json()
    print(response)
    return response['choices'][0]['message']

@app.route("/button-<action>", methods=['POST'])
def do(action):
    data = request.get_json()
    user = data.get('username')
    info=mydatabase[user]
    temp=info["cat_status"]
    if action=="feed" and temp!=0:
        mydatabase[user]={"password":info["password"], "cat_status":info["cat_status"]-1, "money":info["money"]+1, "feed":info["feed"]+1, "pet":info["pet"]}
        mydatabase.commit()
    elif action=="pet" and temp!=10:
        mydatabase[user]={"password":info["password"], "cat_status":info["cat_status"]+1, "money":info["money"]+1, "feed":info["feed"], "pet":info["pet"]+1}
        mydatabase.commit()
    return ('', 204)

@app.route("/getinfo-<column>", methods=['GET'])
def getinfo(column):
    if column=="password":
        return ('', 404)
    user = request.args.get('user')
    return jsonify(info=mydatabase[user][column])

@app.route("/session/<name>")
def session(name):
    return render_template("main.html")


if __name__ == '__main__':
    app.run(port=49130)


</name></column></action></password></username></password></username></name></code></pre></div>
</details>
</div>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block group-open:select-text">
<p>login.html</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2 cursor-auto select-text">
<pre class="language-html line-numbers"><code>

<!DOCTYPE html>
<html>
<head>
    <style>
    body{
        background-color: #2c2c2c;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-image: URL("getimage/test.jpg");
        background-position: center top;
        font-family: "Open Sans", sans-serif;
        color: #00353F;
        opacity: 0.8;
        margin-top: 3%;
        margin-left: 25%;
        margin-right: 25%;
    }

    input[type=text], input[type=password] {
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
    }

    button {
    background-color: #D46F4D;
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
    font-weight: bold;
    }
    button:hover {
    background-color: #E33A00;
    opacity: 1 !important;
    }

    .container {
    width: 50%;
    padding: 16px;
    margin: auto;
    vertical-align: middle;
    text-align: center;
    opacity: 1;
    }

    .vertical-center {
    margin: 0;
    top: 50%;
    left: 25%;
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
    }
    @font-face {
    font-family: fantasy;
    src: url("getimage/IMMORTAL.ttf");
    }

    h2 {
        position: center top;
        font-family: fantasy;
        color: white;
        text-align: center;
        padding-bottom: 200px;
        font-size:xx-large;
    }
    h3 {
        position: center bottom;
        font-family: fantasy;
        color: red;
        text-align: center;
        font-size:x-large;
        padding-top: 30px;
    }


    </style>

</head>
<body>
    <label for="title"><h2>ChatClique!</h2></label>
    <div class="container" display="inline-block">

        <div class="vertical-center">

        <label for="uname"><b>Username</b></label>
        <input type="text" id="username" placeholder="Enter Username" name="uname" required="">

        <label for="psw"><b>Password</b></label>
        <input type="password" id="password" placeholder="Enter Password" name="psw" required="">

        <button id="login">Login</button>

        
        <button id="signup">New ? Sign up</button>


        </div>
      </div>

    <div id="hiddenText" style="display: none;">
            <h3>No such credentials found in our server</h3>
        </div>
    <div id="hiddenText2" style="display: none;">
        <h3>Account created successfully. You can now login, meow !</h3>
    </div>
    <div id="hiddenText3" style="display: none;">
        <h3>Username taken. Please choose another one !</h3>
    </div>


        </body></html></code></pre></div>
      </details></div>

    <script type="text/javascript">
        document.getElementById("signup").addEventListener("click", function() {
            hiddenText.style.display = "none";
            hiddenText2.style.display = "none";
            hiddenText3.style.display = "none";
            const inputValueU = document.getElementById("username").value.toString();
            const inputValueP = document.getElementById("password").value.toString();

            fetch("http://localhost:49130/signup/U"+inputValueU+"-P"+inputValueP)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {

                    const apiResponse = data.success;
                    const hiddenText2 = document.getElementById("hiddenText2");
                    if (apiResponse) {
                        hiddenText2.style.display = "block";
                    } else {
                        hiddenText3.style.display = "block";
                    }
                })

        });

        document.getElementById("login").addEventListener("click", function() {
            hiddenText.style.display = "none";
            hiddenText2.style.display = "none";
            hiddenText3.style.display = "none";
            const inputValueU = document.getElementById("username").value.toString();
            const inputValueP = document.getElementById("password").value.toString();


            fetch("http://localhost:49130/login/U"+inputValueU+"-P"+inputValueP)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {

                    const apiResponse = data.success;
                    const hiddenText = document.getElementById("hiddenText");
                    if (apiResponse) {
                        document.cookie = "username=" + inputValueU;
                        window.location.href = "http://localhost:49130/session/"+apiResponse;
                    } else {
                        hiddenText.style.display = "block";
                    }
                })

        });
    </script>
</article></main></body>
</html>





<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100 cursor-pointer select-none dark:border-indigo-800 dark:bg-indigo-950">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block group-open:select-text">
<p>main.html</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 fill-none stroke-2 stroke-indigo-500 dark:stroke-indigo-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2 cursor-auto select-text">
<pre class="language-html line-numbers"><code>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        @font-face {
        font-family: lucidaconsole;
        src: url("getimage/LUCON.TTF");
        }

        body{
        background-color: #2c2c2c;
        color:bisque;
        font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-size: 2em;
        margin-left: 30%;
        margin-right: 25%;
        }

        #pet{

        font-family: 'Helvetica', 'Arial', sans-serif;
        display: inline-block;
        font-size: 1em !important;
        padding: 1em 2em;
        margin-left: 100px;
        margin-top: 20%;
        -webkit-appearance: none;
        appearance: none;
        background-color: #FF7D7A;
        color: black;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        position: absolute;
        transition: transform ease-in 0.1s, box-shadow ease-in 0.25s;
        box-shadow: 0 2px 25px rgba(255, 0, 130, 0.5);

        &:focus {
            outline: 0;
        }

        &:before, &:after{
            position: absolute;
            content: '';
            display: block;
            width: 140%;
            height: 100%;
            left: -20%;
            z-index: -1000;
            transition: all ease-in-out 0.5s;
            background-repeat: no-repeat;
        }

        &:before{
            display: none;
            top: -75%;
            background-image:
            radial-gradient(circle,#FF7D7A 20%, transparent 20%),
            radial-gradient(circle,  transparent 20%, #FF7D7A 20%, transparent 30%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle,#FF7D7A 20%, transparent 20%),
            radial-gradient(circle,  transparent 10%, #FF7D7A 15%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%);
        background-size: 10% 10%, 20% 20%, 15% 15%, 20% 20%, 18% 18%, 10% 10%, 15% 15%, 10% 10%, 18% 18%;
        background-position: 0% 80%, -5% 20%, 10% 40%, 20% 0%, 30% 30%, 22% 50%, 50% 50%, 65% 20%, 85% 30%;
        }

        &:after{
            display: none;
            bottom: -75%;
            background-image:
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle,  transparent 10%, #FF7D7A 15%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%),
            radial-gradient(circle, #FF7D7A 20%, transparent 20%);
            background-size: 15% 15%, 20% 20%, 18% 18%, 20% 20%, 15% 15%, 10% 10%, 20% 20%;
            background-position: 5% 90%, 10% 90%, 10% 90%, 15% 90%, 25% 90%, 25% 90%, 40% 90%, 55% 90%, 70% 90%;
        }

        &:active{
            transform: scale(0.9);
            background-color: darken(#FF7D7A, 5%);
            box-shadow: 0 2px 25px rgba(255, 0, 130, 0.2);
        }

        &.animate{
            &:before{
            display: block;
            animation: topBubbles ease-in-out 0.75s forwards;
            }
            &:after{
            display: block;
            animation: bottomBubbles ease-in-out 0.75s forwards;
            }
        }
        }

        @keyframes topBubbles {
        0%{
            background-position: 5% 90%, 10% 90%, 10% 90%, 15% 90%, 25% 90%, 25% 90%, 40% 90%, 55% 90%, 70% 90%;
        }
            50% {
            background-position: 0% 80%, 0% 20%, 10% 40%, 20% 0%, 30% 30%, 22% 50%, 50% 50%, 65% 20%, 90% 30%;}
        100% {
            background-position: 0% 70%, 0% 10%, 10% 30%, 20% -10%, 30% 20%, 22% 40%, 50% 40%, 65% 10%, 90% 20%;
        background-size: 0% 0%, 0% 0%,  0% 0%,  0% 0%,  0% 0%,  0% 0%;
        }
        }

        @keyframes bottomBubbles {
        0%{
            background-position: 10% -10%, 30% 10%, 55% -10%, 70% -10%, 85% -10%, 70% -10%, 70% 0%;
        }
        50% {
            background-position: 0% 80%, 20% 80%, 45% 60%, 60% 100%, 75% 70%, 95% 60%, 105% 0%;}
        100% {
            background-position: 0% 90%, 20% 90%, 45% 70%, 60% 110%, 75% 80%, 95% 70%, 110% 10%;
        background-size: 0% 0%, 0% 0%,  0% 0%,  0% 0%,  0% 0%,  0% 0%;
        }
        }

    button[name=feed]{
        margin-top: 30% !important;
    }

    #leftsideinfo{
        margin-left: -20% !important;
        position: absolute !important;
    }

    </style>
    <script>
        function getCookie(name) {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.indexOf(name + "=") === 0) {
                return cookie.substring(name.length + 1);
                }
            }
            return "";
            }

        var storedUsername = getCookie("username");

        </script>
    <title>ChatClique</title>
</head>
<body>
    <img id="catImage" src="https://raw.githubusercontent.com/do-it-ecm/do-it/refs/heads/main/src/getimage/cutiecat.jpg">
    <button id="pet" name="pet">Pet</button>
    <button id="pet" name="feed">Feed</button>
    <br>
    <div id="leftsideinfo">yes</div>
    <div id="result">Talk to me </div>
    <br>
    <input type="text" id="user_input" placeholder="Type something">
    <button id="submit_button">Submit</button>
    <script>
      var resultElement = $("#result");
      resultElement.text("Hello "+storedUsername);



      $(document).ready(function() {
        updateLeftSideInfo();
        $("#submit_button").click(function() {
          resultElement.text("...");
          var userInput = $("#user_input").val();
          $.ajax({
            type: "GET",
            url: "/gpt-response?text=" + userInput + "&user=" + storedUsername,
            success: function(response) {

              displayStreamingText(response.content);
            }
          });
        });
      });

      function displayStreamingText(text) {
        var resultElement = $("#result");
        $("#result").empty();
        var index = 0;

        function addNextCharacter() {
            if (index < text.length) {
            var randomDelay = Math.random() * 100;
            setTimeout(function() {
                resultElement.append(text.charAt(index));
                index++;
                addNextCharacter();
            }, randomDelay);
            }
        }
        addNextCharacter();
      }

      var animateButton = function(e) {

        e.preventDefault();
        e.target.classList.remove('animate');

        var name = e.target.getAttribute('name');

        fetch("/button-"+name, {
          method: 'POST',
          body: JSON.stringify({ username: storedUsername }),
          headers: {
            'Content-Type': 'application/json'
          }
        });
        updateLeftSideInfo();

        if (name === "pet") {
            replaceImage("/getimage/bigpet.gif");
        } else if (name === "feed") {
            replaceImage("/getimage/feedthecat.gif");
        }

        e.target.classList.add('animate');
        setTimeout(function() {
            e.target.classList.remove('animate');
            replaceImage("/getimage/cutiecat.jpg");
        }, 1200);
    };

    function updateLeftSideInfo() {
        fetch('/getinfo-cat_status?user='+storedUsername)
            .then(response => response.json())
            .then(data => {
                var info = data.info;
                document.getElementById('leftsideinfo').textContent = info;
            })
            .catch(error => {
                console.error('API request error:', error);
            });
    }


    function replaceImage(imageSrc) {
        var imageElement = document.getElementById("catImage");
        if (imageElement) {
            imageElement.src = imageSrc;
        }
    }

    var petButton = document.getElementsByName("pet")[0];
    var feedButton = document.getElementsByName("feed")[0];

    feedButton.addEventListener('click', animateButton, false);
    petButton.addEventListener('click', animateButton, false);

    </script>

</body>
</html>


</code></pre></div>
</details>
</div>
<h2 id="voyez-par-vous-m%C3%AAme" tabindex="-1"><a class="header-anchor" href="#voyez-par-vous-m%C3%AAme"></a> Voyez par vous-m√™me</h2>
<p>J'ai essay√© de lancer l'appli sur le serveur ovh de do-it mais cela n'a pas fonctionn√©. C'est peut-√™tre d√ª √† la gestion de Flask.</p>
<p>Voici donc une petite d√©mo du fonctionnement. Le score d'humeur est √† gauche. Le caresser le rend heureux, le nourrir le rend malheureux, pour des besoins de d√©monstration !!</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/X0wQnHDmt8I?si=o1d2ll1UJ6evGSzD" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
<h2 id="par-la-suite" tabindex="-1"><a class="header-anchor" href="#par-la-suite"></a> Par la suite</h2>
<p>Ca m'a beaucoup amus√©e de d√©velopper ce petit projet. Il y a un nombre incalculable de choses √† am√©liorer, que ce soit dans l'optimisation du chargement des gifs, de la base de donn√©e utilisateur, de l'augmentation de la m√©moire et des caract√©ristiques du chat (ajouter une barre de faim), on pourrait enregistrer des dates de derni√®re connexion et faire monter la barre de faim au fil du temps...</p>
<p>Ajouter des styles gr√¢ce √† la monnaie (j'ai d√©j√† une panoplie de gifs de ce m√™me chat d√©clin√© avec des accesoires). C'est quelque chose que j'aurais voulu ajouter mais o√π j'ai clairement pas eu le temps.</p>
<p>Je pense continuer √† l'am√©liorer dans mon temps libre, en esp√©rant pouvoir mettre √ßa sur l'ovh plus tard.</p>
<h2 id="sources-et-cr%C3%A9dits" tabindex="-1"><a class="header-anchor" href="#sources-et-cr%C3%A9dits"></a> Sources et cr√©dits</h2>
<ul>
<li><a href="https://webdeasy.de/en/top-css-buttons-en/?utm_content=cmp-true">le css des boutons</a></li>
<li><a href="https://www.pawlicy.com/blog/cat-photos-for-monday/">la photo du chat</a></li>
<li><a href="https://platform.openai.com/docs/api-reference">documentation openAI</a></li>
</ul>
<p>J'ai cr√©√© moi-m√™me les gifs.</p>





        

        <footer class="min-h-[50px] border-t-2 mt-4 border-gray-200 dark:border-neutral-700">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        ¬©2025 <b><span style="font-family: Consolas, sans-serif;">Do-<span style="color: #4a86e8">It</span></span></b> - D√©veloppement, Management et Gestion de projets en IT
                    </p>
                </div>
            </div>
        </footer>

        <!-- MathJax import and initialization -->
        <script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-svg-full.js" defer="">
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']], // Delimiters for inline math
                    displayMath: [['$$', '$$'], ['\\[', '\\]']] // Delimiters for block math
                },
                svg: {
                    fontCache: 'global' // Use global font cache for SVG output
                }
            };
            document.addEventListener('DOMContentLoaded', () => {
                MathJax.typeset(); // Ensures MathJax processes the content after the page loads
            });
        </script>

        <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/normalize-whitespace/prism-normalize-whitespace.min.js">
            Prism.plugins.NormalizeWhitespace.setDefaults({
                'remove-trailing': true,
                'remove-indent': true,
                'left-trim': true,
                'right-trim': true,
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/show-language/prism-show-language.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script>
    

